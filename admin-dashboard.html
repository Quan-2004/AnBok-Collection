<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - AnBok Collection</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üìö</text></svg>">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Firebase SDK -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
        import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
        import { getDatabase, ref, get, set, push, update, remove, onValue, off } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
        import { getStorage, ref as storageRef, uploadBytes, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-storage.js";

        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDYLKQprHcGWDUo4TNOvDzTqTbqUFG4FkA",
            authDomain: "anbok-collection.firebaseapp.com",
            databaseURL: "https://anbok-collection-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "anbok-collection",
            storageBucket: "anbok-collection.firebasestorage.app",
            messagingSenderId: "835844957818",
            appId: "1:835844957818:web:33fc3d03875d49fc5c3dc3",
            measurementId: "G-MS5FT355WW"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        const auth = getAuth(app);
        const database = getDatabase(app);
        const storage = getStorage(app);

        // Make Firebase services available globally
        window.firebase = {
            auth,
            database,
            storage,
            analytics
        };

        // Initialize authentication state listener
        onAuthStateChanged(auth, (user) => {
            if (user) {
                console.log('User is signed in:', user.email);
                // Check if user is admin
                checkUserRole(user.uid);
            } else {
                console.log('User is signed out');
                // Redirect to login if not authenticated
                if (window.location.pathname !== '/auth.html') {
                    window.location.href = 'auth.html';
                }
            }
        });

        // Check user role from database
        async function checkUserRole(userId) {
            try {
                const userRef = ref(database, `users/${userId}`);
                const snapshot = await get(userRef);
                if (snapshot.exists()) {
                    const userData = snapshot.val();
                    console.log('User data loaded:', userData);
                    
                    if (userData.role === 'admin' || userData.role === 'superAdmin') {
                        console.log('User has admin privileges');
                        // Store user data globally for use in dashboard
                        window.currentAdminUser = userData;
                        return true;
                    } else {
                        console.log('User does not have admin privileges');
                        alert('B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p trang admin!');
                        window.location.href = 'index.html';
                        return false;
                    }
                } else {
                    console.log('User data not found');
                    alert('Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi d√πng!');
                    window.location.href = 'index.html';
                    return false;
                }
            } catch (error) {
                console.error('Error checking user role:', error);
                alert('L·ªói khi ki·ªÉm tra quy·ªÅn ng∆∞·ªùi d√πng!');
                window.location.href = 'index.html';
                return false;
            }
        }
    </script>
    
    <!-- Custom CSS -->
    <style>
        :root {
            --sidebar-width: 280px;
            --topbar-height: 60px;
            --primary-color: #6f42c1;
            --secondary-color: #858796;
            --success-color: #28a745;
            --info-color: #17a2b8;
            --warning-color: #ffc107;
            --danger-color: #dc3545;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background-color: #f8f9fc;
        }

        /* Sidebar */
        #sidebar {
            width: var(--sidebar-width);
            height: 100vh;
            position: fixed;
            left: 0;
            top: 0;
            background: linear-gradient(180deg, var(--primary-color) 10%, #5a32a3 100%);
            color: white;
            transition: all 0.3s;
            z-index: 1000;
            overflow-y: auto;
        }

        #sidebar .sidebar-brand {
            height: var(--topbar-height);
            display: flex;
            align-items: center;
            padding: 1rem;
            font-size: 1.2rem;
            font-weight: 800;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        #sidebar .sidebar-brand i {
            color: #ffd700;
            margin-right: 0.75rem;
        }

        #sidebar .nav-item {
            padding: 0.25rem 1rem;
        }

        #sidebar .nav-link {
            color: rgba(255,255,255,0.8);
            display: flex;
            align-items: center;
            padding: 0.75rem 1rem;
            border-radius: 0.35rem;
            transition: all 0.3s;
        }

        #sidebar .nav-link:hover {
            background-color: rgba(255,255,255,0.1);
            color: white;
            transform: translateX(5px);
        }

        #sidebar .nav-link.active {
            background-color: rgba(255,255,255,0.2);
            color: white;
        }

        #sidebar .nav-link i {
            margin-right: 0.75rem;
            width: 20px;
            text-align: center;
        }

        /* Main Content */
        #content {
            margin-left: var(--sidebar-width);
            padding: 1.5rem;
        }

        /* Topbar */
        #topbar {
            height: var(--topbar-height);
            background: white;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58,59,69,0.15);
            display: flex;
            align-items: center;
            padding: 0 1.5rem;
            margin-bottom: 1.5rem;
            border-radius: 0.35rem;
        }

        /* Cards */
        .dashboard-card {
            border: none;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58,59,69,0.15);
            transition: transform 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
        }

        .dashboard-card .card-header {
            background-color: #f8f9fc;
            border-bottom: 1px solid #e3e6f0;
            font-weight: 700;
            color: var(--primary-color);
        }

        /* Charts */
        .chart-container {
            height: 320px;
        }

        /* Tables */
        .table-responsive {
            background: white;
            padding: 1.5rem;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58,59,69,0.15);
        }

        /* Stats Cards */
        .stat-card {
            border-left: 4px solid;
            border-radius: 0.35rem;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 0.5rem 2rem 0 rgba(58,59,69,0.2);
        }

        .stat-card-primary {
            border-left-color: var(--primary-color);
        }

        .stat-card-success {
            border-left-color: var(--success-color);
        }

        .stat-card-info {
            border-left-color: var(--info-color);
        }

        .stat-card-warning {
            border-left-color: var(--warning-color);
        }

        .stat-card-danger {
            border-left-color: var(--danger-color);
        }

        /* Quick Actions */
        .quick-actions {
            background: linear-gradient(135deg, var(--primary-color), #5a32a3);
            color: white;
            border-radius: 0.35rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .quick-action-btn {
            background: rgba(255,255,255,0.2);
            border: 1px solid rgba(255,255,255,0.3);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 0.35rem;
            transition: all 0.3s;
            text-decoration: none;
            display: inline-block;
            margin: 0.25rem;
        }

        .quick-action-btn:hover {
            background: rgba(255,255,255,0.3);
            color: white;
            transform: translateY(-2px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            #sidebar {
                transform: translateX(-100%);
            }
            
            #content {
                margin-left: 0;
            }
            
            .sidebar-open #sidebar {
                transform: translateX(0);
            }
        }

        /* Book Management Styles */
        .book-image {
            transition: transform 0.3s ease;
        }

        .book-image:hover {
            transform: scale(1.1);
        }

        /* ==================== FIREBASE AUTHENTICATION STYLES ==================== */
        
        .auth-status {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
            max-width: 300px;
        }

        .auth-status.authenticated {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            animation: slideInRight 0.3s ease;
        }

        .auth-status.unauthenticated {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            box-shadow: 0 0.5rem 1rem rgba(0,0,0,0.15);
            animation: slideInRight 0.3s ease;
        }

        .auth-status .status-icon {
            font-size: 1.5rem;
            margin-right: 0.5rem;
        }

        .auth-status .status-text {
            font-weight: 600;
        }

        .auth-status .status-details {
            font-size: 0.875rem;
            opacity: 0.9;
            margin-top: 0.25rem;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Error States */
        .error-message {
            background: linear-gradient(135deg, #dc3545, #fd7e14);
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,0.1);
        }

        .error-message .error-icon {
            font-size: 1.25rem;
            margin-right: 0.5rem;
        }

        /* Success States */
        .success-message {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
            box-shadow: 0 0.25rem 0.5rem rgba(0,0,0,0.1);
        }

        .success-message .success-icon {
            font-size: 1.25rem;
            margin-right: 0.5rem;
        }

        .book-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .book-description {
            font-size: 0.875rem;
            color: #6c757d;
            line-height: 1.4;
        }

        .filter-section {
            background: linear-gradient(135deg, #f8f9fc, #e9ecef);
            border-radius: 0.35rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .table-hover tbody tr:hover {
            background-color: rgba(111, 66, 193, 0.05);
            transform: translateY(-1px);
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .btn-group-sm .btn {
            padding: 0.25rem 0.5rem;
            font-size: 0.875rem;
            border-radius: 0.2rem;
        }

        .pagination .page-link {
            color: var(--primary-color);
            border-color: #e3e6f0;
        }

        .pagination .page-item.active .page-link {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .pagination .page-link:hover {
            color: var(--primary-color);
            background-color: #e3e6f0;
            border-color: #e3e6f0;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), #5a32a3);
            color: white;
            border-bottom: none;
        }

        .modal-header .btn-close {
            filter: invert(1);
        }

        .form-label {
            font-weight: 600;
            color: #495057;
        }

        .form-control:focus,
        .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.2rem rgba(111, 66, 193, 0.25);
        }

        .alert {
            border: none;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58,59,69,0.15);
        }

        .alert-success {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .alert-info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1);
            color: white;
        }

        .alert-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14);
            color: white;
        }

        .alert-danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c);
            color: white;
        }

        /* Status badges */
        .badge {
            font-size: 0.75rem;
            padding: 0.5rem 0.75rem;
            border-radius: 0.375rem;
        }

        /* Category badges */
        .badge.bg-primary {
            background: linear-gradient(135deg, #6f42c1, #5a32a3) !important;
        }

        .badge.bg-success {
            background: linear-gradient(135deg, #28a745, #20c997) !important;
        }

        .badge.bg-info {
            background: linear-gradient(135deg, #17a2b8, #6f42c1) !important;
        }

        .badge.bg-warning {
            background: linear-gradient(135deg, #ffc107, #fd7e14) !important;
        }

        .badge.bg-danger {
            background: linear-gradient(135deg, #dc3545, #e83e8c) !important;
        }

        /* Search and filter improvements */
        .input-group .form-control:focus {
            z-index: 3;
        }

        .input-group .btn-outline-secondary:hover {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        /* Table improvements */
        .table th {
            border-top: none;
            font-weight: 700;
            color: var(--primary-color);
            text-transform: uppercase;
            font-size: 0.75rem;
            letter-spacing: 0.5px;
        }

        .table td {
            vertical-align: middle;
            border-top: 1px solid #e3e6f0;
        }

        /* Quick action buttons */
        .quick-action-btn.book-management {
            background: linear-gradient(135deg, var(--primary-color), #5a32a3);
            border: none;
            color: white;
            font-weight: 600;
        }

        .quick-action-btn.book-management:hover {
            background: linear-gradient(135deg, #5a32a3, var(--primary-color));
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(111, 66, 193, 0.4);
        }

        /* Author Management Styles */
        .author-image {
            transition: transform 0.3s ease;
            cursor: pointer;
        }

        .author-image:hover {
            transform: scale(1.1);
        }

        .author-name {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
        }

        .author-pen-name {
            font-size: 0.875rem;
            font-style: italic;
            margin-bottom: 0.25rem;
        }

        .author-email, .author-phone {
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }

        .quick-action-btn.author-management {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
        }

        .quick-action-btn.author-management:hover {
            background: linear-gradient(135deg, #218838, #1e7e34);
            color: white;
        }

        /* Order Management Styles */
        .order-status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }

        .order-table th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }

        .order-table tbody tr:hover {
            background-color: #f8f9fa;
            cursor: pointer;
        }

        .order-checkbox {
            cursor: pointer;
        }

        .order-actions .btn {
            margin: 0 2px;
        }

        .order-details-section {
            background-color: #f8f9fa;
            padding: 1rem;
            border-radius: 0.375rem;
            margin-bottom: 1rem;
        }

        .order-history-item {
            border-left: 3px solid #007bff;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }

        .order-history-item:last-child {
            margin-bottom: 0;
        }

        .order-stats-card {
            transition: transform 0.2s ease-in-out;
        }

        .order-stats-card:hover {
            transform: translateY(-2px);
        }

        .order-filter-bar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 0.5rem;
        }

        .order-filter-bar .form-control,
        .order-filter-bar .form-select {
            border: none;
            background-color: rgba(255, 255, 255, 0.9);
        }

        .order-filter-bar .btn {
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .order-filter-bar .btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .order-table-container {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .order-pagination .page-link {
            color: #007bff;
            border: 1px solid #dee2e6;
        }

        .order-pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
        }

        .order-pagination .page-link:hover {
            background-color: #e9ecef;
        }

        .order-modal .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .order-modal .modal-header .btn-close {
            filter: invert(1);
        }

        .order-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .order-item-row {
            background-color: #f8f9fa;
            border-radius: 0.375rem;
            padding: 0.75rem;
            margin-bottom: 0.5rem;
        }

        .order-item-row:last-child {
            margin-bottom: 0;
        }

        .order-summary-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .order-summary-card h5 {
            color: white;
            margin-bottom: 1rem;
        }

        .order-summary-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
        }

        .order-summary-stat {
            text-align: center;
            padding: 0.5rem;
            background-color: rgba(255, 255, 255, 0.1);
            border-radius: 0.375rem;
        }

        .order-summary-stat .number {
            font-size: 1.5rem;
            font-weight: bold;
            display: block;
        }

        .order-summary-stat .label {
            font-size: 0.875rem;
            opacity: 0.9;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .order-filter-bar .row > div {
                margin-bottom: 1rem;
            }
            
            .order-table-container {
                overflow-x: auto;
            }
            
            .order-actions .btn {
                margin: 0 1px;
                padding: 0.25rem 0.5rem;
                font-size: 0.875rem;
            }
            
            .order-info-grid {
                grid-template-columns: 1fr;
            }
            
            .order-summary-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 576px) {
            .order-stats-card {
                margin-bottom: 1rem;
            }
            
            .order-filter-bar .btn-group {
                flex-direction: column;
            }
            
            .order-filter-bar .btn-group .btn {
                margin-bottom: 0.5rem;
            }
            
            .order-summary-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Animation Effects */
        .order-table tbody tr {
            transition: all 0.2s ease-in-out;
        }

        .order-table tbody tr:hover {
            transform: scale(1.01);
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .order-stats-card {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .order-filter-bar {
            animation: slideInDown 0.5s ease-out;
        }

        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Loading States */
        .order-loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 2rem;
            color: #6c757d;
        }

        .order-loading .spinner-border {
            margin-right: 0.5rem;
        }

        /* Empty State */
        .order-empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6c757d;
        }

        .order-empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        .order-empty-state h5 {
            margin-bottom: 0.5rem;
            color: #495057;
        }

        .order-empty-state p {
            margin-bottom: 1.5rem;
        }

        /* Status Color Variations */
        .status-pending { color: #ffc107; }
        .status-processing { color: #17a2b8; }
        .status-shipping { color: #007bff; }
        .status-delivered { color: #28a745; }
        .status-completed { color: #28a745; }
        .status-cancelled { color: #dc3545; }
        .status-returned { color: #6c757d; }

        /* Payment Method Icons */
        .payment-method-icon {
            margin-right: 0.5rem;
        }

        .payment-cash { color: #28a745; }
        .payment-bank { color: #007bff; }
        .payment-card { color: #6f42c1; }
        .payment-vnpay { color: #fd7e14; }
        .payment-momo { color: #e83e8c; }

        /* Story Management Styles */
        .story-status-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
        }

        .story-table th {
            background-color: #f8f9fa;
            border-bottom: 2px solid #dee2e6;
            font-weight: 600;
            color: #495057;
        }

        .story-table tbody tr:hover {
            background-color: #f8f9fa;
            cursor: pointer;
        }

        .story-checkbox {
            cursor: pointer;
        }

        .story-actions .btn {
            margin: 0 2px;
        }

        .story-image {
            width: 40px;
            height: 50px;
            object-fit: cover;
            border-radius: 0.375rem;
        }

        .story-title {
            font-weight: 600;
            color: #007bff;
            margin-bottom: 0.25rem;
        }

        .story-id {
            font-size: 0.75rem;
            color: #6c757d;
        }

        .story-stats-card {
            transition: transform 0.2s ease-in-out;
            border: none;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .story-stats-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        }

        .story-filter-bar {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
            border-radius: 0.5rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .story-filter-bar .form-control,
        .story-filter-bar .form-select {
            border: none;
            background-color: rgba(255, 255, 255, 0.9);
        }

        .story-filter-bar .btn {
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
        }

        .story-filter-bar .btn:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .story-table-container {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border-radius: 0.5rem;
            overflow: hidden;
        }

        .story-pagination .page-link {
            color: #007bff;
            border: 1px solid #dee2e6;
        }

        .story-pagination .page-item.active .page-link {
            background-color: #007bff;
            border-color: #007bff;
            color: white;
        }

        .story-pagination .page-link:hover {
            background-color: #e9ecef;
        }

        .story-modal .modal-header {
            background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            color: white;
        }

        .story-modal .modal-header .btn-close {
            filter: invert(1);
        }

        .story-details-image {
            max-width: 200px;
            border-radius: 0.5rem;
            box-shadow: 0 0.25rem 0.5rem rgba(0, 0, 0, 0.1);
        }

        .story-stat-box {
            border: 1px solid #dee2e6;
            border-radius: 0.375rem;
            padding: 1rem;
            text-align: center;
            transition: all 0.2s ease-in-out;
        }

        .story-stat-box:hover {
            border-color: #007bff;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .story-stat-number {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }

        .story-stat-label {
            font-size: 0.875rem;
            color: #6c757d;
        }

        .story-rating {
            color: #ffc107;
        }

        .story-rating .fas.fa-star-half-alt {
            color: #ffc107;
        }

        .story-rating .fas.fa-star.text-muted {
            color: #dee2e6;
        }

        .story-tags {
            display: inline-block;
            background-color: #e9ecef;
            color: #495057;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            font-size: 0.75rem;
            margin: 0.125rem;
        }

        .story-bulk-actions {
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
        }

        .story-bulk-actions .btn {
            margin-right: 0.5rem;
        }

        .story-search-highlight {
            background-color: #fff3cd;
            padding: 0.125rem 0.25rem;
            border-radius: 0.25rem;
        }

        /* Responsive Design for Story Management */
        @media (max-width: 768px) {
            .story-filter-bar .row > div {
                margin-bottom: 1rem;
            }
            
            .story-table-container {
                overflow-x: auto;
            }
            
            .story-actions .btn {
                margin: 0 1px;
                padding: 0.25rem 0.5rem;
                font-size: 0.875rem;
            }
            
            .story-stats-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .story-details-modal .modal-dialog {
                margin: 0.5rem;
            }
        }

        @media (max-width: 576px) {
            .story-stats-grid {
                grid-template-columns: 1fr;
            }
            
            .story-bulk-actions .btn {
                display: block;
                width: 100%;
                margin-bottom: 0.5rem;
            }
        }

        /* ==================== NEWS MANAGEMENT STYLES ==================== */
        
        .news-image {
            transition: transform 0.3s ease;
            border-radius: 0.375rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .news-image:hover {
            transform: scale(1.05);
        }

        .news-title {
            font-weight: 600;
            color: var(--primary-color);
            margin-bottom: 0.25rem;
            line-height: 1.3;
        }

        .news-content-preview {
            font-size: 0.875rem;
            color: #6c757d;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .news-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .news-filter-section {
            background: linear-gradient(135deg, #f8f9fc, #e9ecef);
            border-radius: 0.35rem;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .news-table-container {
            background: white;
            border-radius: 0.35rem;
            box-shadow: 0 0.15rem 1.75rem 0 rgba(58,59,69,0.15);
            overflow: hidden;
        }

        .news-table-header {
            background: linear-gradient(135deg, var(--primary-color), #5a32a3);
            color: white;
            padding: 1rem 1.5rem;
        }

        .news-bulk-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            flex-wrap: wrap;
        }

        .news-bulk-actions .btn {
            margin: 0;
        }

        .news-pagination {
            padding: 1rem 1.5rem;
            background: #f8f9fc;
            border-top: 1px solid #e3e6f0;
        }

        .news-modal .modal-body {
            max-height: 70vh;
            overflow-y: auto;
        }

        .news-form-row {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 1.5rem;
        }

        @media (max-width: 768px) {
            .news-form-row {
                grid-template-columns: 1fr;
            }
            
            .news-stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            }
            
            .news-bulk-actions {
                flex-direction: column;
                align-items: stretch;
            }
            
            .news-bulk-actions .btn {
                width: 100%;
            }
        }
    </style>
</head>
<body>

    <!-- Sidebar -->
    <nav id="sidebar">
        <div class="sidebar-brand">
            <i class="fas fa-book-open"></i>
            AnBok Library
        </div>
        <div class="nav flex-column">
            <div class="nav-item">
                <a href="#" class="nav-link active" onclick="showDashboard()">
                    <i class="fas fa-fw fa-tachometer-alt"></i>
                    Dashboard
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showBookManagement()">
                    <i class="fas fa-fw fa-book"></i>
                    Qu·∫£n l√Ω s√°ch
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showStoryManagement()">
                    <i class="fas fa-fw fa-book-open"></i>
                    Qu·∫£n l√Ω truy·ªán
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showAuthorManagement()">
                    <i class="fas fa-fw fa-user-edit"></i>
                    Qu·∫£n l√Ω t√°c gi·∫£
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showMemberManagement()">
                    <i class="fas fa-fw fa-users"></i>
                    Qu·∫£n l√Ω h·ªôi vi√™n
                </a>
            </div>
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showOrderManagement()">
                    <i class="fas fa-fw fa-shopping-cart"></i>
                    Qu·∫£n l√Ω ƒë∆°n h√†ng
                </a>
            </div>
       
            <div class="nav-item">
                <a href="#" class="nav-link" onclick="showNewsManagement()">
                    <i class="fas fa-fw fa-newspaper"></i>
                    Qu·∫£n l√Ω tin t·ª©c
                </a>
            </div>

        </div>
    </nav>

    <!-- Main Content -->
    <div id="content">
        <!-- Topbar -->
        <div id="topbar">
            <button class="btn btn-link d-md-none rounded-circle me-3" id="sidebarToggle">
                <i class="fas fa-bars"></i>
            </button>
            <div class="d-none d-sm-inline-block form-inline me-auto">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="T√¨m ki·∫øm s√°ch, t√°c gi·∫£, th√†nh vi√™n...">
                    <button class="btn btn-primary">
                        <i class="fas fa-search fa-sm"></i>
                    </button>
                </div>
            </div>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                        <span class="d-none d-lg-inline text-gray-600 small me-2" id="userDisplayName">Admin</span>
                        <img class="img-profile rounded-circle" id="userProfileImage" src="https://startbootstrap.github.io/startbootstrap-sb-admin-2/img/undraw_profile.svg" style="height: 32px;">
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="#"><i class="fas fa-user fa-sm fa-fw me-2 text-gray-400"></i>H·ªì s∆°</a></li>
                        <li><a class="dropdown-item" href="#"><i class="fas fa-cogs fa-sm fa-fw me-2 text-gray-400"></i>C√†i ƒë·∫∑t</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="#" onclick="signOutUser()"><i class="fas fa-sign-out-alt fa-sm fa-fw me-2 text-gray-400"></i>ƒêƒÉng xu·∫•t</a></li>
                    </ul>
                </li>
            </ul>
        </div>

        <!-- Quick Actions -->
        <div class="quick-actions">
            <h5 class="mb-3"><i class="fas fa-bolt me-2"></i>Thao t√°c nhanh</h5>
            <a href="#" class="quick-action-btn"><i class="fas fa-plus me-2"></i>Th√™m s√°ch m·ªõi</a>
            <a href="#" class="quick-action-btn author-management" onclick="openAddAuthorModal()"><i class="fas fa-user-plus me-2"></i>Th√™m t√°c gi·∫£</a>
            <a href="#" class="quick-action-btn"><i class="fas fa-user-check me-2"></i>Duy·ªát th√†nh vi√™n</a>
            <a href="#" class="quick-action-btn"><i class="fas fa-file-invoice me-2"></i>Xem b√°o c√°o</a>
        </div>

        <!-- Dashboard Content -->
        <div class="container-fluid" id="dashboardContent">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Dashboard Th∆∞ vi·ªán AnBok</h1>
                <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm">
                    <i class="fas fa-download fa-sm text-white-50"></i> Xu·∫•t b√°o c√°o
                </a>
            </div>

            <!-- Stats Cards Row -->
            <div class="row">
                <!-- Total Books Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-primary h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        T·ªïng s·ªë s√°ch</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">2,847</div>
                                    <div class="text-xs text-success"><i class="fas fa-arrow-up"></i> 12% so v·ªõi th√°ng tr∆∞·ªõc</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-book fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Active Members Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-success h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Th√†nh vi√™n ho·∫°t ƒë·ªông</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">1,234</div>
                                    <div class="text-xs text-success"><i class="fas fa-arrow-up"></i> 8% so v·ªõi th√°ng tr∆∞·ªõc</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-users fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Monthly Revenue Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-info h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        Doanh thu th√°ng</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">45,200,000ƒë</div>
                                    <div class="text-xs text-success"><i class="fas fa-arrow-up"></i> 15% so v·ªõi th√°ng tr∆∞·ªõc</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Pending Orders Card -->
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-warning h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        ƒê∆°n h√†ng ch·ªù x·ª≠ l√Ω</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800">23</div>
                                    <div class="text-xs text-warning"><i class="fas fa-clock"></i> C·∫ßn x·ª≠ l√Ω g·∫•p</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row">
                <!-- Revenue Chart -->
                <div class="col-xl-8 col-lg-7">
                    <div class="card dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold"><i class="fas fa-chart-line me-2"></i>Bi·ªÉu ƒë·ªì doanh thu theo th√°ng</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="revenueChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Book Categories Pie Chart -->
                <div class="col-xl-4 col-lg-5">
                    <div class="card dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold"><i class="fas fa-chart-pie me-2"></i>Ph√¢n lo·∫°i s√°ch theo th·ªÉ lo·∫°i</h6>
                        </div>
                        <div class="card-body">
                            <div class="chart-container">
                                <canvas id="bookCategoriesChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activities Row -->
            <div class="row">
                <!-- Recent Orders -->
                <div class="col-xl-6 col-lg-6">
                    <div class="card dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold"><i class="fas fa-shopping-cart me-2"></i>ƒê∆°n h√†ng g·∫ßn ƒë√¢y</h6>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>M√£ ƒë∆°n</th>
                                            <th>Kh√°ch h√†ng</th>
                                            <th>S·ªë ti·ªÅn</th>
                                            <th>Tr·∫°ng th√°i</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>#ORD001</td>
                                            <td>Nguy·ªÖn VƒÉn A</td>
                                            <td>150,000ƒë</td>
                                            <td><span class="badge bg-success">Ho√†n th√†nh</span></td>
                                        </tr>
                                        <tr>
                                            <td>#ORD002</td>
                                            <td>Tr·∫ßn Th·ªã B</td>
                                            <td>89,000ƒë</td>
                                            <td><span class="badge bg-warning">ƒêang x·ª≠ l√Ω</span></td>
                                        </tr>
                                        <tr>
                                            <td>#ORD003</td>
                                            <td>L√™ VƒÉn C</td>
                                            <td>200,000ƒë</td>
                                            <td><span class="badge bg-info">ƒêang giao</span></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Books Added -->
                <div class="col-xl-6 col-lg-6">
                    <div class="card dashboard-card mb-4">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold"><i class="fas fa-book me-2"></i>S√°ch m·ªõi th√™m g·∫ßn ƒë√¢y</h6>
                        </div>
                        <div class="card-body">
                            <div class="list-group list-group-flush">
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">ƒê·∫Øc Nh√¢n T√¢m</h6>
                                        <small class="text-muted">T√°c gi·∫£: Dale Carnegie</small>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">M·ªõi</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">Nh√† Gi·∫£ Kim</h6>
                                        <small class="text-muted">T√°c gi·∫£: Paulo Coelho</small>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">M·ªõi</span>
                                </div>
                                <div class="list-group-item d-flex justify-content-between align-items-center">
                                    <div>
                                        <h6 class="mb-1">Tu·ªïi Tr·∫ª ƒê√°ng Gi√° Bao Nhi√™u</h6>
                                        <small class="text-muted">T√°c gi·∫£: Rosie Nguy·ªÖn</small>
                                    </div>
                                    <span class="badge bg-primary rounded-pill">M·ªõi</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- System Status Row -->
            <div class="row">
                <div class="col-12">
                    <div class="card dashboard-card">
                        <div class="card-header">
                            <h6 class="m-0 font-weight-bold"><i class="fas fa-server me-2"></i>Tr·∫°ng th√°i h·ªá th·ªëng</h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3 text-center">
                                    <div class="border rounded p-3">
                                        <i class="fas fa-database fa-2x text-success mb-2"></i>
                                        <h6>Database</h6>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="border rounded p-3">
                                        <i class="fas fa-fire fa-2x text-success mb-2"></i>
                                        <h6>Firebase</h6>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="border rounded p-3">
                                        <i class="fas fa-cloud fa-2x text-success mb-2"></i>
                                        <h6>Cloud Storage</h6>
                                        <span class="badge bg-success">Online</span>
                                    </div>
                                </div>
                                <div class="col-md-3 text-center">
                                    <div class="border rounded p-3">
                                        <i class="fas fa-shield-alt fa-2x text-success mb-2"></i>
                                        <h6>Security</h6>
                                        <span class="badge bg-success">Active</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Book Management Content -->
        <div class="container-fluid" id="bookManagementContent" style="display: none;">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Qu·∫£n l√Ω s√°ch</h1>
                <button class="btn btn-primary" onclick="openAddBookModal()">
                    <i class="fas fa-plus fa-sm text-white-50"></i> Th√™m s√°ch m·ªõi
                </button>
            </div>

            <!-- Search and Filter Bar -->
            <div class="card dashboard-card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchBook" placeholder="T√¨m ki·∫øm s√°ch...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="categoryFilter">
                                <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                                <option value="van-hoc">VƒÉn h·ªçc</option>
                                <option value="kinh-te">Kinh t·∫ø</option>
                                <option value="khoa-hoc">Khoa h·ªçc</option>
                                <option value="giao-duc">Gi√°o d·ª•c</option>
                                <option value="khac">Kh√°c</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="statusFilter">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="available">C√≥ s·∫µn</option>
                                <option value="borrowed">ƒê√£ m∆∞·ª£n</option>
                                <option value="maintenance">B·∫£o tr√¨</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-primary w-100" onclick="applyFilters()">
                                <i class="fas fa-filter"></i> L·ªçc
                            </button>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-outline-success" onclick="exportBooks()" title="Xu·∫•t danh s√°ch s√°ch">
                                    <i class="fas fa-download"></i> Xu·∫•t
                                </button>
                                <button class="btn btn-outline-warning" onclick="bulkEdit()" title="Ch·ªânh s·ª≠a h√†ng lo·∫°t">
                                    <i class="fas fa-edit"></i> H√†ng lo·∫°t
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Books Table -->
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-list me-2"></i>Danh s√°ch s√°ch
                        <span class="badge bg-primary ms-2" id="totalBooks">0</span>
                    </h6>
                    <div class="d-flex align-items-center">
                        <label class="form-check-label me-2">
                            <input type="checkbox" class="form-check-input" id="selectAllBooks" onchange="toggleSelectAll()">
                            Ch·ªçn t·∫•t c·∫£
                        </label>
                        <span class="badge bg-info ms-2" id="selectedCount">0</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="booksTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" class="form-check-input" id="headerCheckbox" onchange="toggleSelectAll()">
                                    </th>
                                    <th>M√£ s√°ch</th>
                                    <th>H√¨nh ·∫£nh</th>
                                    <th>T√™n s√°ch</th>
                                    <th>T√°c gi·∫£</th>
                                    <th>Th·ªÉ lo·∫°i</th>
                                    <th>Gi√°</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="booksTableBody">
                                <!-- Books will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Book pagination">
                        <ul class="pagination justify-content-center" id="pagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Author Management Content -->
        <div class="container-fluid" id="authorManagementContent" style="display: none;">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Qu·∫£n l√Ω t√°c gi·∫£</h1>
                <button class="btn btn-primary" onclick="openAddAuthorModal()">
                    <i class="fas fa-plus fa-sm text-white-50"></i> Th√™m t√°c gi·∫£ m·ªõi
                </button>
            </div>

            <!-- Search and Filter Bar -->
            <div class="card dashboard-card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchAuthor" placeholder="T√¨m ki·∫øm t√°c gi·∫£...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="authorStatusFilter">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                                <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                                <option value="pending">Ch·ªù duy·ªát</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="authorCategoryFilter">
                                <option value="">T·∫•t c·∫£ lƒ©nh v·ª±c</option>
                                <option value="van-hoc">VƒÉn h·ªçc</option>
                                <option value="kinh-te">Kinh t·∫ø</option>
                                <option value="khoa-hoc">Khoa h·ªçc</option>
                                <option value="giao-duc">Gi√°o d·ª•c</option>
                                <option value="khac">Kh√°c</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-primary w-100" onclick="applyAuthorFilters()">
                                <i class="fas fa-filter"></i> L·ªçc
                            </button>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-outline-success" onclick="exportAuthors()" title="Xu·∫•t danh s√°ch t√°c gi·∫£">
                                    <i class="fas fa-download"></i> Xu·∫•t
                                </button>
                                <button class="btn btn-outline-warning" onclick="bulkAuthorEdit()" title="Ch·ªânh s·ª≠a h√†ng lo·∫°t">
                                    <i class="fas fa-edit"></i> H√†ng lo·∫°t
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Authors Table -->
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-user-edit me-2"></i>Danh s√°ch t√°c gi·∫£
                        <span class="badge bg-primary ms-2" id="totalAuthors">0</span>
                    </h6>
                    <div class="d-flex align-items-center">
                        <label class="form-check-label me-2">
                            <input type="checkbox" class="form-check-input" id="selectAllAuthors" onchange="toggleSelectAllAuthors()">
                            Ch·ªçn t·∫•t c·∫£
                        </label>
                        <span class="badge bg-info ms-2" id="selectedAuthorCount">0</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="authorsTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" class="form-check-input" id="authorHeaderCheckbox" onchange="toggleSelectAllAuthors()">
                                    </th>
                                    <th>M√£ t√°c gi·∫£</th>
                                    <th>H√¨nh ·∫£nh</th>
                                    <th>Th√¥ng tin t√°c gi·∫£</th>
                                    <th>Lƒ©nh v·ª±c</th>
                                    <th>S·ªë s√°ch</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="authorsTableBody">
                                <!-- Authors will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Author pagination">
                        <ul class="pagination justify-content-center" id="authorPagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Member Management Content -->
        <div class="container-fluid" id="memberManagementContent" style="display: none;">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Qu·∫£n l√Ω h·ªôi vi√™n</h1>
                <button class="btn btn-primary" onclick="openAddMemberModal()">
                    <i class="fas fa-plus fa-sm text-white-50"></i> Th√™m h·ªôi vi√™n m·ªõi
                </button>
            </div>

            <!-- Search and Filter Bar -->
            <div class="card dashboard-card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchMember" placeholder="T√¨m ki·∫øm h·ªôi vi√™n...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="memberStatusFilter">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                                <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                                <option value="pending">Ch·ªù duy·ªát</option>
                                <option value="suspended">T·∫°m kh√≥a</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="memberTypeFilter">
                                <option value="">T·∫•t c·∫£ lo·∫°i h·ªôi vi√™n</option>
                                <option value="regular">H·ªôi vi√™n th∆∞·ªùng</option>
                                <option value="premium">H·ªôi vi√™n cao c·∫•p</option>
                                <option value="vip">H·ªôi vi√™n VIP</option>
                                <option value="student">H·ªôi vi√™n sinh vi√™n</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <button class="btn btn-outline-primary w-100" onclick="applyMemberFilters()">
                                <i class="fas fa-filter"></i> L·ªçc
                            </button>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-outline-success" onclick="exportMembers()" title="Xu·∫•t danh s√°ch h·ªôi vi√™n">
                                    <i class="fas fa-download"></i> Xu·∫•t
                                </button>
                                <button class="btn btn-outline-warning" onclick="bulkMemberEdit()" title="Ch·ªânh s·ª≠a h√†ng lo·∫°t">
                                    <i class="fas fa-edit"></i> H√†ng lo·∫°t
                                </button>
                                <button class="btn btn-outline-info" onclick="sendBulkNotification()" title="G·ª≠i th√¥ng b√°o h√†ng lo·∫°t">
                                    <i class="fas fa-bell"></i> Th√¥ng b√°o
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Members Table -->
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-users me-2"></i>Danh s√°ch h·ªôi vi√™n
                        <span class="badge bg-primary ms-2" id="totalMembers">0</span>
                    </h6>
                    <div class="d-flex align-items-center">
                        <label class="form-check-label me-2">
                            <input type="checkbox" class="form-check-input" id="selectAllMembers" onchange="toggleSelectAllMembers()">
                            Ch·ªçn t·∫•t c·∫£
                        </label>
                        <span class="badge bg-info ms-2" id="selectedMemberCount">0</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="membersTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" class="form-check-input" id="memberHeaderCheckbox" onchange="toggleSelectAllMembers()">
                                    </th>
                                    <th>M√£ h·ªôi vi√™n</th>
                                    <th>H√¨nh ·∫£nh</th>
                                    <th>Th√¥ng tin h·ªôi vi√™n</th>
                                    <th>Lo·∫°i h·ªôi vi√™n</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y tham gia</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="membersTableBody">
                                <!-- Members will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Member pagination">
                        <ul class="pagination justify-content-center" id="memberPagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Story Management Content -->
        <div class="container-fluid" id="storyManagementContent" style="display: none;">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Qu·∫£n l√Ω truy·ªán</h1>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" onclick="openAddStoryModal()">
                        <i class="fas fa-plus fa-sm text-white-50"></i> Th√™m truy·ªán m·ªõi
                    </button>
                    <button class="btn btn-success" onclick="exportStories()">
                        <i class="fas fa-download fa-sm text-white-50"></i> Xu·∫•t b√°o c√°o
                    </button>
                    <button class="btn btn-info" onclick="openBulkStoryUpdateModal()">
                        <i class="fas fa-edit fa-sm text-white-50"></i> C·∫≠p nh·∫≠t h√†ng lo·∫°t
                    </button>
                </div>
            </div>

            <!-- Story Statistics Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-primary h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        T·ªïng s·ªë truy·ªán</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalStoriesCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-book-open fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-success h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Truy·ªán ho√†n th√†nh</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="completedStoriesCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-warning h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        ƒêang c·∫≠p nh·∫≠t</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="ongoingStoriesCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-clock fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-info h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        T·ªïng l∆∞·ª£t ƒë·ªçc</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalReadsCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-eye fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="card dashboard-card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchStory" placeholder="T√¨m ki·∫øm truy·ªán...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="storyStatusFilter">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="ongoing">ƒêang c·∫≠p nh·∫≠t</option>
                                <option value="completed">Ho√†n th√†nh</option>
                                <option value="paused">T·∫°m d·ª´ng</option>
                                <option value="cancelled">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="storyCategoryFilter">
                                <option value="">T·∫•t c·∫£ th·ªÉ lo·∫°i</option>
                                <option value="tien-hiep">Ti√™n hi·ªáp</option>
                                <option value="kiem-hiep">Ki·∫øm hi·ªáp</option>
                                <option value="ngon-tinh">Ng√¥n t√¨nh</option>
                                <option value="truyen-teen">Truy·ªán teen</option>
                                <option value="truyen-kinh-di">Kinh d·ªã</option>
                                <option value="truyen-hai">H√†i h∆∞·ªõc</option>
                                <option value="truyen-doi">ƒê·ªùi th∆∞·ªùng</option>
                                <option value="khac">Kh√°c</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="storyRatingFilter">
                                <option value="">T·∫•t c·∫£ ƒë√°nh gi√°</option>
                                <option value="5">5 sao</option>
                                <option value="4">4 sao tr·ªü l√™n</option>
                                <option value="3">3 sao tr·ªü l√™n</option>
                                <option value="2">2 sao tr·ªü l√™n</option>
                                <option value="1">1 sao tr·ªü l√™n</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-outline-primary" onclick="applyStoryFilters()">
                                    <i class="fas fa-filter"></i> L·ªçc
                                </button>
                                <button class="btn btn-outline-secondary" onclick="resetStoryFilters()">
                                    <i class="fas fa-undo"></i> L√†m m·ªõi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stories Table -->
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-list me-2"></i>Danh s√°ch truy·ªán
                        <span class="badge bg-primary ms-2" id="filteredStoriesCount">0</span>
                    </h6>
                    <div class="d-flex align-items-center">
                        <label class="form-check-label me-2">
                            <input type="checkbox" class="form-check-input" id="selectAllStories" onchange="toggleSelectAllStories()">
                            Ch·ªçn t·∫•t c·∫£
                        </label>
                        <span class="badge bg-info ms-2" id="selectedStoryCount">0</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="storiesTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" class="form-check-input" id="storyHeaderCheckbox" onchange="toggleSelectAllStories()">
                                    </th>
                                    <th>M√£ truy·ªán</th>
                                    <th>H√¨nh ·∫£nh</th>
                                    <th>Th√¥ng tin truy·ªán</th>
                                    <th>T√°c gi·∫£</th>
                                    <th>Th·ªÉ lo·∫°i</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>ƒê√°nh gi√°</th>
                                    <th>L∆∞·ª£t ƒë·ªçc</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="storiesTableBody">
                                <!-- Stories will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Story pagination">
                        <ul class="pagination justify-content-center" id="storyPagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- Order Management Content -->
        <div class="container-fluid" id="orderManagementContent" style="display: none;">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Qu·∫£n l√Ω ƒë∆°n h√†ng</h1>
                <div class="d-flex gap-2">
                    <button class="btn btn-success" onclick="exportOrders()">
                        <i class="fas fa-download fa-sm text-white-50"></i> Xu·∫•t b√°o c√°o
                    </button>
                    <button class="btn btn-info" onclick="openBulkOrderUpdateModal()">
                        <i class="fas fa-edit fa-sm text-white-50"></i> C·∫≠p nh·∫≠t h√†ng lo·∫°t
                    </button>
                </div>
            </div>

            <!-- Order Statistics Cards -->
            <div class="row mb-4">
                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-primary h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                        T·ªïng ƒë∆°n h√†ng</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalOrdersCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-shopping-cart fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-warning h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                        Ch·ªù x·ª≠ l√Ω</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="pendingOrdersCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-clock fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-info h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                        ƒêang giao</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="shippingOrdersCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-truck fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-md-6 mb-4">
                    <div class="card dashboard-card stat-card stat-card-success h-100 py-2">
                        <div class="card-body">
                            <div class="row no-gutters align-items-center">
                                <div class="col mr-2">
                                    <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                        Ho√†n th√†nh</div>
                                    <div class="h5 mb-0 font-weight-bold text-gray-800" id="completedOrdersCount">0</div>
                                </div>
                                <div class="col-auto">
                                    <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="card dashboard-card mb-4">
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="input-group">
                                <input type="text" class="form-control" id="searchOrder" placeholder="T√¨m ki·∫øm ƒë∆°n h√†ng...">
                                <button class="btn btn-outline-secondary" type="button">
                                    <i class="fas fa-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="orderStatusFilter">
                                <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                                <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
                                <option value="processing">ƒêang x·ª≠ l√Ω</option>
                                <option value="shipping">ƒêang giao</option>
                                <option value="delivered">ƒê√£ giao</option>
                                <option value="completed">Ho√†n th√†nh</option>
                                <option value="cancelled">ƒê√£ h·ªßy</option>
                                <option value="returned">ƒê√£ tr·∫£</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="orderDateFilter">
                                <option value="">T·∫•t c·∫£ ng√†y</option>
                                <option value="today">H√¥m nay</option>
                                <option value="yesterday">H√¥m qua</option>
                                <option value="week">Tu·∫ßn n√†y</option>
                                <option value="month">Th√°ng n√†y</option>
                                <option value="custom">T√πy ch·ªçn</option>
                            </select>
                        </div>
                        <div class="col-md-2">
                            <select class="form-select" id="orderPaymentFilter">
                                <option value="">T·∫•t c·∫£ thanh to√°n</option>
                                <option value="cash">Ti·ªÅn m·∫∑t</option>
                                <option value="bank_transfer">Chuy·ªÉn kho·∫£n</option>
                                <option value="credit_card">Th·∫ª t√≠n d·ª•ng</option>
                                <option value="vnpay">VNPay</option>
                                <option value="momo">MoMo</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <div class="btn-group w-100" role="group">
                                <button class="btn btn-outline-primary" onclick="applyOrderFilters()">
                                    <i class="fas fa-filter"></i> L·ªçc
                                </button>
                                <button class="btn btn-outline-secondary" onclick="resetOrderFilters()">
                                    <i class="fas fa-undo"></i> L√†m m·ªõi
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Orders Table -->
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-list me-2"></i>Danh s√°ch ƒë∆°n h√†ng
                        <span class="badge bg-primary ms-2" id="filteredOrdersCount">0</span>
                    </h6>
                    <div class="d-flex align-items-center">
                        <label class="form-check-label me-2">
                            <input type="checkbox" class="form-check-input" id="selectAllOrders" onchange="toggleSelectAllOrders()">
                            Ch·ªçn t·∫•t c·∫£
                        </label>
                        <span class="badge bg-info ms-2" id="selectedOrderCount">0</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="ordersTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" class="form-check-input" id="orderHeaderCheckbox" onchange="toggleSelectAllOrders()">
                                    </th>
                                    <th>M√£ ƒë∆°n h√†ng</th>
                                    <th>Kh√°ch h√†ng</th>
                                    <th>S·∫£n ph·∫©m</th>
                                    <th>T·ªïng ti·ªÅn</th>
                                    <th>Ph∆∞∆°ng th·ª©c TT</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y ƒë·∫∑t</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="ordersTableBody">
                                <!-- Orders will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="Order pagination">
                        <ul class="pagination justify-content-center" id="orderPagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </nav>
                </div>
            </div>
        </div>

        <!-- News Management Content -->
        <div class="container-fluid" id="newsManagementContent" style="display: none;">
            <!-- Page Heading -->
            <div class="d-sm-flex align-items-center justify-content-between mb-4">
                <h1 class="h3 mb-0 text-gray-800">Qu·∫£n l√Ω tin t·ª©c</h1>
                <div class="d-flex gap-2">
                    <button class="btn btn-primary" onclick="openAddNewsModal()">
                        <i class="fas fa-plus fa-sm text-white-50"></i> Th√™m tin t·ª©c m·ªõi
                    </button>
                    <button class="btn btn-success" onclick="exportNews()">
                        <i class="fas fa-download fa-sm text-white-50"></i> Xu·∫•t b√°o c√°o
                    </button>
                    <button class="btn btn-info" onclick="openBulkNewsUpdateModal()">
                        <i class="fas fa-edit fa-sm text-white-50"></i> C·∫≠p nh·∫≠t h√†ng lo·∫°t
                    </button>
                </div>
            </div>

            <!-- News Statistics Cards -->
            <div class="news-stats-grid">
                <div class="card dashboard-card stat-card stat-card-primary h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                    T·ªïng s·ªë tin t·ª©c</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalNewsCount">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-newspaper fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card dashboard-card stat-card stat-card-success h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                    Tin t·ª©c ƒë√£ xu·∫•t b·∫£n</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="publishedNewsCount">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-check-circle fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card dashboard-card stat-card stat-card-warning h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                    Tin t·ª©c ch·ªù duy·ªát</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="pendingNewsCount">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-clock fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="card dashboard-card stat-card stat-card-info h-100 py-2">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                    T·ªïng l∆∞·ª£t xem</div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800" id="totalNewsViews">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="fas fa-eye fa-2x text-gray-300"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Search and Filter Bar -->
            <div class="news-filter-section">
                <div class="row">
                    <div class="col-md-3">
                        <div class="input-group">
                            <input type="text" class="form-control" id="searchNews" placeholder="T√¨m ki·∫øm tin t·ª©c...">
                            <button class="btn btn-outline-secondary" type="button">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="newsStatusFilter">
                            <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                            <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
                            <option value="draft">B·∫£n nh√°p</option>
                            <option value="pending">Ch·ªù duy·ªát</option>
                            <option value="archived">ƒê√£ l∆∞u tr·ªØ</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="newsCategoryFilter">
                            <option value="">T·∫•t c·∫£ danh m·ª•c</option>
                            <option value="tin-tuc">Tin t·ª©c</option>
                            <option value="su-kien">S·ª± ki·ªán</option>
                            <option value="khuyen-mai">Khuy·∫øn m√£i</option>
                            <option value="gioi-thieu">Gi·ªõi thi·ªáu</option>
                            <option value="huong-dan">H∆∞·ªõng d·∫´n</option>
                            <option value="khac">Kh√°c</option>
                        </select>
                    </div>
                    <div class="col-md-2">
                        <select class="form-select" id="newsAuthorFilter">
                            <option value="">T·∫•t c·∫£ t√°c gi·∫£</option>
                            <option value="admin">Admin</option>
                            <option value="editor">Bi√™n t·∫≠p vi√™n</option>
                            <option value="author">T√°c gi·∫£</option>
                        </select>
                    </div>
                    <div class="col-md-3">
                        <div class="btn-group w-100" role="group">
                            <button class="btn btn-outline-primary" onclick="applyNewsFilters()">
                                <i class="fas fa-filter"></i> L·ªçc
                            </button>
                            <button class="btn btn-outline-secondary" onclick="resetNewsFilters()">
                                <i class="fas fa-undo"></i> L√†m m·ªõi
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- News Table -->
            <div class="card dashboard-card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h6 class="m-0 font-weight-bold">
                        <i class="fas fa-list me-2"></i>Danh s√°ch tin t·ª©c
                        <span class="badge bg-primary ms-2" id="filteredNewsCount">0</span>
                    </h6>
                    <div class="d-flex align-items-center">
                        <label class="form-check-label me-2">
                            <input type="checkbox" class="form-check-input" id="selectAllNews" onchange="toggleSelectAllNews()">
                            Ch·ªçn t·∫•t c·∫£
                        </label>
                        <span class="badge bg-info ms-2" id="selectedNewsCount">0</span>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover" id="newsTable">
                            <thead class="table-light">
                                <tr>
                                    <th width="50">
                                        <input type="checkbox" class="form-check-input" id="newsHeaderCheckbox" onchange="toggleSelectAllNews()">
                                    </th>
                                    <th>M√£ tin t·ª©c</th>
                                    <th>H√¨nh ·∫£nh</th>
                                    <th>Ti√™u ƒë·ªÅ tin t·ª©c</th>
                                    <th>Danh m·ª•c</th>
                                    <th>T√°c gi·∫£</th>
                                    <th>Tr·∫°ng th√°i</th>
                                    <th>Ng√†y ƒëƒÉng</th>
                                    <th>L∆∞·ª£t xem</th>
                                    <th>Thao t√°c</th>
                                </tr>
                            </thead>
                            <tbody id="newsTableBody">
                                <!-- News will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                    
                    <!-- Pagination -->
                    <nav aria-label="News pagination">
                        <ul class="pagination justify-content-center" id="newsPagination">
                            <!-- Pagination will be generated here -->
                        </ul>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Details Modal -->
        <div class="modal fade" id="orderDetailsModal" tabindex="-1" aria-labelledby="orderDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="orderDetailsModalLabel">Chi ti·∫øt ƒë∆°n h√†ng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3"><i class="fas fa-user me-2"></i>Th√¥ng tin kh√°ch h√†ng</h6>
                                <div id="customerInfo">
                                    <!-- Customer info will be populated here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3"><i class="fas fa-shopping-cart me-2"></i>Th√¥ng tin ƒë∆°n h√†ng</h6>
                                <div id="orderInfo">
                                    <!-- Order info will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <h6 class="text-primary mb-3"><i class="fas fa-list me-2"></i>Chi ti·∫øt s·∫£n ph·∫©m</h6>
                        <div class="table-responsive">
                            <table class="table table-bordered" id="orderItemsTable">
                                <thead class="table-light">
                                    <tr>
                                        <th>S·∫£n ph·∫©m</th>
                                        <th>Gi√°</th>
                                        <th>S·ªë l∆∞·ª£ng</th>
                                        <th>Th√†nh ti·ªÅn</th>
                                    </tr>
                                </thead>
                                <tbody id="orderItemsTableBody">
                                    <!-- Order items will be populated here -->
                                </tbody>
                            </table>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3"><i class="fas fa-truck me-2"></i>Th√¥ng tin giao h√†ng</h6>
                                <div id="shippingInfo">
                                    <!-- Shipping info will be populated here -->
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h6 class="text-primary mb-3"><i class="fas fa-credit-card me-2"></i>Th√¥ng tin thanh to√°n</h6>
                                <div id="paymentInfo">
                                    <!-- Payment info will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <h6 class="text-primary mb-3"><i class="fas fa-history me-2"></i>L·ªãch s·ª≠ c·∫≠p nh·∫≠t</h6>
                        <div id="orderHistory">
                            <!-- Order history will be populated here -->
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                        <button type="button" class="btn btn-primary" onclick="openEditOrderModal()">
                            <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                        </button>
                        <button type="button" class="btn btn-success" onclick="updateOrderStatus()">
                            <i class="fas fa-check"></i> C·∫≠p nh·∫≠t tr·∫°ng th√°i
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Edit Order Modal -->
        <div class="modal fade" id="editOrderModal" tabindex="-1" aria-labelledby="editOrderModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="editOrderModalLabel">Ch·ªânh s·ª≠a ƒë∆°n h√†ng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="editOrderForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="editOrderStatus" class="form-label">Tr·∫°ng th√°i ƒë∆°n h√†ng *</label>
                                        <select class="form-select" id="editOrderStatus" required>
                                            <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
                                            <option value="processing">ƒêang x·ª≠ l√Ω</option>
                                            <option value="shipping">ƒêang giao</option>
                                            <option value="delivered">ƒê√£ giao</option>
                                            <option value="completed">Ho√†n th√†nh</option>
                                            <option value="cancelled">ƒê√£ h·ªßy</option>
                                            <option value="returned">ƒê√£ tr·∫£</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editOrderPaymentStatus" class="form-label">Tr·∫°ng th√°i thanh to√°n</label>
                                        <select class="form-select" id="editOrderPaymentStatus">
                                            <option value="pending">Ch·ªù thanh to√°n</option>
                                            <option value="paid">ƒê√£ thanh to√°n</option>
                                            <option value="failed">Thanh to√°n th·∫•t b·∫°i</option>
                                            <option value="refunded">ƒê√£ ho√†n ti·ªÅn</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="editOrderShippingMethod" class="form-label">Ph∆∞∆°ng th·ª©c giao h√†ng</label>
                                        <select class="form-select" id="editOrderShippingMethod">
                                            <option value="standard">Giao h√†ng ti√™u chu·∫©n</option>
                                            <option value="express">Giao h√†ng nhanh</option>
                                            <option value="pickup">Nh·∫≠n t·∫°i c·ª≠a h√†ng</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="editOrderTrackingNumber" class="form-label">M√£ v·∫≠n ƒë∆°n</label>
                                        <input type="text" class="form-control" id="editOrderTrackingNumber" placeholder="Nh·∫≠p m√£ v·∫≠n ƒë∆°n">
                                    </div>
                                    <div class="mb-3">
                                        <label for="editOrderEstimatedDelivery" class="form-label">Ng√†y giao h√†ng d·ª± ki·∫øn</label>
                                        <input type="date" class="form-control" id="editOrderEstimatedDelivery">
                                    </div>
                                    <div class="mb-3">
                                        <label for="editOrderNotes" class="form-label">Ghi ch√∫</label>
                                        <textarea class="form-control" id="editOrderNotes" rows="3" placeholder="Ghi ch√∫ v·ªÅ ƒë∆°n h√†ng"></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-primary" id="saveOrderChangesBtn">L∆∞u thay ƒë·ªïi</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Add/Edit Story Modal -->
        <div class="modal fade" id="storyModal" tabindex="-1" aria-labelledby="storyModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="storyModalLabel">Th√™m truy·ªán m·ªõi</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <form id="storyForm">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="storyTitle" class="form-label">T√™n truy·ªán *</label>
                                        <input type="text" class="form-control" id="storyTitle" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyAuthor" class="form-label">T√°c gi·∫£ *</label>
                                        <input type="text" class="form-control" id="storyAuthor" required>
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyCategory" class="form-label">Th·ªÉ lo·∫°i *</label>
                                        <select class="form-select" id="storyCategory" required>
                                            <option value="">Ch·ªçn th·ªÉ lo·∫°i</option>
                                            <option value="tien-hiep">Ti√™n hi·ªáp</option>
                                            <option value="kiem-hiep">Ki·∫øm hi·ªáp</option>
                                            <option value="ngon-tinh">Ng√¥n t√¨nh</option>
                                            <option value="truyen-teen">Truy·ªán teen</option>
                                            <option value="truyen-kinh-di">Kinh d·ªã</option>
                                            <option value="truyen-hai">H√†i h∆∞·ªõc</option>
                                            <option value="truyen-doi">ƒê·ªùi th∆∞·ªùng</option>
                                            <option value="khac">Kh√°c</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyStatus" class="form-label">Tr·∫°ng th√°i *</label>
                                        <select class="form-select" id="storyStatus" required>
                                            <option value="ongoing">ƒêang c·∫≠p nh·∫≠t</option>
                                            <option value="completed">Ho√†n th√†nh</option>
                                            <option value="paused">T·∫°m d·ª´ng</option>
                                            <option value="cancelled">ƒê√£ h·ªßy</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyTotalChapters" class="form-label">T·ªïng s·ªë ch∆∞∆°ng</label>
                                        <input type="number" class="form-control" id="storyTotalChapters" min="1" placeholder="ƒê·ªÉ tr·ªëng n·∫øu ch∆∞a x√°c ƒë·ªãnh">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="storyCurrentChapters" class="form-label">S·ªë ch∆∞∆°ng hi·ªán t·∫°i</label>
                                        <input type="number" class="form-control" id="storyCurrentChapters" min="0" value="0">
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyRating" class="form-label">ƒê√°nh gi√°</label>
                                        <select class="form-select" id="storyRating">
                                            <option value="0">Ch∆∞a ƒë√°nh gi√°</option>
                                            <option value="1">1 sao</option>
                                            <option value="2">2 sao</option>
                                            <option value="3">3 sao</option>
                                            <option value="4">4 sao</option>
                                            <option value="5">5 sao</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyImage" class="form-label">H√¨nh ·∫£nh b√¨a</label>
                                        <input type="file" class="form-control" id="storyImage" accept="image/*">
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyTags" class="form-label">Tags</label>
                                        <input type="text" class="form-control" id="storyTags" placeholder="Tag1, Tag2, Tag3...">
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyLanguage" class="form-label">Ng√¥n ng·ªØ</label>
                                        <select class="form-select" id="storyLanguage">
                                            <option value="vietnamese">Ti·∫øng Vi·ªát</option>
                                            <option value="english">Ti·∫øng Anh</option>
                                            <option value="chinese">Ti·∫øng Trung</option>
                                            <option value="korean">Ti·∫øng H√†n</option>
                                            <option value="japanese">Ti·∫øng Nh·∫≠t</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label for="storyDescription" class="form-label">M√¥ t·∫£ truy·ªán *</label>
                                <textarea class="form-control" id="storyDescription" rows="4" required placeholder="M√¥ t·∫£ ng·∫Øn g·ªçn v·ªÅ n·ªôi dung truy·ªán..."></textarea>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="storySource" class="form-label">Ngu·ªìn g·ªëc</label>
                                        <input type="text" class="form-control" id="storySource" placeholder="Truy·ªán g·ªëc, Fanfiction...">
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyPublishDate" class="form-label">Ng√†y b·∫Øt ƒë·∫ßu ƒëƒÉng</label>
                                        <input type="date" class="form-control" id="storyPublishDate">
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label for="storyUpdateFrequency" class="form-label">T·∫ßn su·∫•t c·∫≠p nh·∫≠t</label>
                                        <select class="form-select" id="storyUpdateFrequency">
                                            <option value="">Kh√¥ng x√°c ƒë·ªãnh</option>
                                            <option value="daily">H√†ng ng√†y</option>
                                            <option value="weekly">H√†ng tu·∫ßn</option>
                                            <option value="monthly">H√†ng th√°ng</option>
                                            <option value="irregular">Kh√¥ng ƒë·ªÅu</option>
                                        </select>
                                    </div>
                                    <div class="mb-3">
                                        <label for="storyIsAdult" class="form-label">N·ªôi dung</label>
                                        <select class="form-select" id="storyIsAdult">
                                            <option value="false">Ph√π h·ª£p m·ªçi l·ª©a tu·ªïi</option>
                                            <option value="true">18+ (Ng∆∞·ªùi l·ªõn)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-primary" id="saveStoryBtn">L∆∞u truy·ªán</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Story Details Modal -->
        <div class="modal fade" id="storyDetailsModal" tabindex="-1" aria-labelledby="storyDetailsModalLabel" aria-hidden="true">
            <div class="modal-dialog modal-xl">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="storyDetailsModalLabel">Chi ti·∫øt truy·ªán</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="row">
                            <div class="col-md-4 text-center">
                                <img id="storyDetailImage" src="" alt="H√¨nh ·∫£nh truy·ªán" class="img-fluid rounded mb-3" style="max-width: 200px;">
                                <div class="badge fs-6 p-2 mb-2" id="storyDetailStatus"></div>
                                <div class="badge bg-primary fs-6 p-2" id="storyDetailCategory"></div>
                            </div>
                            <div class="col-md-8">
                                <h4 class="text-primary" id="storyDetailTitle"></h4>
                                <div class="row">
                                    <div class="col-md-6">
                                        <p><strong>T√°c gi·∫£:</strong> <span id="storyDetailAuthor"></span></p>
                                        <p><strong>Th·ªÉ lo·∫°i:</strong> <span id="storyDetailCategoryText"></span></p>
                                        <p><strong>Tr·∫°ng th√°i:</strong> <span id="storyDetailStatusText"></span></p>
                                        <p><strong>Ng√¥n ng·ªØ:</strong> <span id="storyDetailLanguage"></span></p>
                                    </div>
                                    <div class="col-md-6">
                                        <p><strong>S·ªë ch∆∞∆°ng:</strong> <span id="storyDetailChapters"></span></p>
                                        <p><strong>ƒê√°nh gi√°:</strong> <span id="storyDetailRating"></span></p>
                                        <p><strong>L∆∞·ª£t ƒë·ªçc:</strong> <span id="storyDetailReads"></span></p>
                                        <p><strong>Ng√†y ƒëƒÉng:</strong> <span id="storyDetailPublishDate"></span></p>
                                    </div>
                                </div>
                                <p><strong>M√¥ t·∫£:</strong> <span id="storyDetailDescription"></span></p>
                                <p><strong>Tags:</strong> <span id="storyDetailTags"></span></p>
                                <p><strong>Ngu·ªìn g·ªëc:</strong> <span id="storyDetailSource"></span></p>
                            </div>
                        </div>
                        
                        <!-- Story Statistics -->
                        <hr>
                        <h6 class="text-primary mb-3"><i class="fas fa-chart-bar me-2"></i>Th·ªëng k√™ truy·ªán</h6>
                        <div class="row text-center">
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <h4 class="text-primary" id="storyDetailTotalChapters">0</h4>
                                    <small class="text-muted">T·ªïng ch∆∞∆°ng</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <h4 class="text-success" id="storyDetailCompletedChapters">0</h4>
                                    <small class="text-muted">Ch∆∞∆°ng ho√†n th√†nh</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <h4 class="text-warning" id="storyDetailPendingChapters">0</h4>
                                    <small class="text-muted">Ch∆∞∆°ng ch·ªù ƒëƒÉng</small>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="border rounded p-3">
                                    <h4 class="text-info" id="storyDetailTotalViews">0</h4>
                                    <small class="text-muted">T·ªïng l∆∞·ª£t xem</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                        <button type="button" class="btn btn-primary" id="editStoryFromDetailsBtn">
                            <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Delete Story Confirmation Modal -->
        <div class="modal fade" id="deleteStoryModal" tabindex="-1" aria-labelledby="deleteStoryModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteStoryModalLabel">X√°c nh·∫≠n x√≥a truy·ªán</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a truy·ªán "<span id="deleteStoryTitle"></span>"?</p>
                        <p class="text-danger">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>L∆∞u √Ω:</strong> N·∫øu truy·ªán n√†y c√≥ ch∆∞∆°ng ho·∫∑c b√¨nh lu·∫≠n, vi·ªác x√≥a c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn d·ªØ li·ªáu h·ªá th·ªëng.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteStoryBtn">X√≥a truy·ªán</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Story Update Modal -->
        <div class="modal fade" id="bulkStoryUpdateModal" tabindex="-1" aria-labelledby="bulkStoryUpdateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="bulkStoryUpdateModalLabel">C·∫≠p nh·∫≠t h√†ng lo·∫°t</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">C·∫≠p nh·∫≠t cho: <span id="selectedStoriesCount" class="badge bg-primary"></span> truy·ªán</span></label>
                        </div>
                        <div class="mb-3">
                            <label for="bulkStoryStatus" class="form-label">Tr·∫°ng th√°i m·ªõi</label>
                            <select class="form-select" id="bulkStoryStatus">
                                <option value="">Ch·ªçn tr·∫°ng th√°i</option>
                                <option value="ongoing">ƒêang c·∫≠p nh·∫≠t</option>
                                <option value="completed">Ho√†n th√†nh</option>
                                <option value="paused">T·∫°m d·ª´ng</option>
                                <option value="cancelled">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="bulkStoryCategory" class="form-label">Th·ªÉ lo·∫°i m·ªõi</label>
                            <select class="form-select" id="bulkStoryCategory">
                                <option value="">Ch·ªçn th·ªÉ lo·∫°i</option>
                                <option value="tien-hiep">Ti√™n hi·ªáp</option>
                                <option value="kiem-hiep">Ki·∫øm hi·ªáp</option>
                                <option value="ngon-tinh">Ng√¥n t√¨nh</option>
                                <option value="truyen-teen">Truy·ªán teen</option>
                                <option value="truyen-kinh-di">Kinh d·ªã</option>
                                <option value="truyen-hai">H√†i h∆∞·ªõc</option>
                                <option value="truyen-doi">ƒê·ªùi th∆∞·ªùng</option>
                                <option value="khac">Kh√°c</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="bulkStoryNotes" class="form-label">Ghi ch√∫ c·∫≠p nh·∫≠t</label>
                            <textarea class="form-control" id="bulkStoryNotes" rows="3" placeholder="Ghi ch√∫ cho vi·ªác c·∫≠p nh·∫≠t h√†ng lo·∫°t"></textarea>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>L∆∞u √Ω:</strong> H√†nh ƒë·ªông n√†y s·∫Ω c·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c truy·ªán ƒë√£ ch·ªçn c√πng m·ªôt l√∫c.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-primary" id="confirmBulkStoryUpdateBtn">C·∫≠p nh·∫≠t h√†ng lo·∫°t</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Bulk Order Update Modal -->
        <div class="modal fade" id="bulkOrderUpdateModal" tabindex="-1" aria-labelledby="bulkOrderUpdateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="bulkOrderUpdateModalLabel">C·∫≠p nh·∫≠t h√†ng lo·∫°t</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label class="form-label">C·∫≠p nh·∫≠t cho: <span id="selectedOrdersCount" class="badge bg-primary"></span> ƒë∆°n h√†ng</span></label>
                        </div>
                        <div class="mb-3">
                            <label for="bulkOrderStatus" class="form-label">Tr·∫°ng th√°i m·ªõi</label>
                            <select class="form-select" id="bulkOrderStatus">
                                <option value="">Ch·ªçn tr·∫°ng th√°i</option>
                                <option value="processing">ƒêang x·ª≠ l√Ω</option>
                                <option value="shipping">ƒêang giao</option>
                                <option value="delivered">ƒê√£ giao</option>
                                <option value="completed">Ho√†n th√†nh</option>
                                <option value="cancelled">ƒê√£ h·ªßy</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="bulkOrderNotes" class="form-label">Ghi ch√∫ c·∫≠p nh·∫≠t</label>
                            <textarea class="form-control" id="bulkOrderNotes" rows="3" placeholder="Ghi ch√∫ cho vi·ªác c·∫≠p nh·∫≠t h√†ng lo·∫°t"></textarea>
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>L∆∞u √Ω:</strong> H√†nh ƒë·ªông n√†y s·∫Ω c·∫≠p nh·∫≠t t·∫•t c·∫£ c√°c ƒë∆°n h√†ng ƒë√£ ch·ªçn c√πng m·ªôt l√∫c.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-primary" id="confirmBulkUpdateBtn">C·∫≠p nh·∫≠t h√†ng lo·∫°t</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Order Status Update Modal -->
        <div class="modal fade" id="orderStatusUpdateModal" tabindex="-1" aria-labelledby="orderStatusUpdateModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="orderStatusUpdateModalLabel">C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="orderStatusUpdate" class="form-label">Tr·∫°ng th√°i m·ªõi *</label>
                            <select class="form-select" id="orderStatusUpdate" required>
                                <option value="">Ch·ªçn tr·∫°ng th√°i</option>
                                <option value="pending">Ch·ªù x·ª≠ l√Ω</option>
                                <option value="processing">ƒêang x·ª≠ l√Ω</option>
                                <option value="shipping">ƒêang giao</option>
                                <option value="delivered">ƒê√£ giao</option>
                                <option value="completed">Ho√†n th√†nh</option>
                                <option value="cancelled">ƒê√£ h·ªßy</option>
                                <option value="returned">ƒê√£ tr·∫£</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="orderStatusNotes" class="form-label">Ghi ch√∫ c·∫≠p nh·∫≠t</label>
                            <textarea class="form-control" id="orderStatusNotes" rows="3" placeholder="Ghi ch√∫ v·ªÅ vi·ªác thay ƒë·ªïi tr·∫°ng th√°i"></textarea>
                        </div>
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="sendCustomerNotification">
                                <label class="form-check-label" for="sendCustomerNotification">
                                    G·ª≠i th√¥ng b√°o cho kh√°ch h√†ng
                                </label>
                            </div>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                        <button type="button" class="btn btn-primary" id="confirmStatusUpdateBtn">C·∫≠p nh·∫≠t tr·∫°ng th√°i</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Book Modal -->
    <div class="modal fade" id="bookModal" tabindex="-1" aria-labelledby="bookModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bookModalLabel">Th√™m s√°ch m·ªõi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="bookForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="bookTitle" class="form-label">T√™n s√°ch *</label>
                                    <input type="text" class="form-control" id="bookTitle" required>
                                </div>
                                <div class="mb-3">
                                    <label for="bookAuthor" class="form-label">T√°c gi·∫£ *</label>
                                    <input type="text" class="form-control" id="bookAuthor" required>
                                </div>
                                <div class="mb-3">
                                    <label for="bookCategory" class="form-label">Th·ªÉ lo·∫°i *</label>
                                    <select class="form-select" id="bookCategory" required>
                                        <option value="">Ch·ªçn th·ªÉ lo·∫°i</option>
                                        <option value="van-hoc">VƒÉn h·ªçc</option>
                                        <option value="kinh-te">Kinh t·∫ø</option>
                                        <option value="khoa-hoc">Khoa h·ªçc</option>
                                        <option value="giao-duc">Gi√°o d·ª•c</option>
                                        <option value="khac">Kh√°c</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="bookPrice" class="form-label">Gi√° (VNƒê) *</label>
                                    <input type="number" class="form-control" id="bookPrice" required min="0">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="bookQuantity" class="form-label">S·ªë l∆∞·ª£ng *</label>
                                    <input type="number" class="form-control" id="bookQuantity" required min="1">
                                </div>
                                <div class="mb-3">
                                    <label for="bookStatus" class="form-label">Tr·∫°ng th√°i *</label>
                                    <select class="form-select" id="bookStatus" required>
                                        <option value="available">C√≥ s·∫µn</option>
                                        <option value="borrowed">ƒê√£ m∆∞·ª£n</option>
                                        <option value="maintenance">B·∫£o tr√¨</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="bookImage" class="form-label">H√¨nh ·∫£nh</label>
                                    <input type="file" class="form-control" id="bookImage" accept="image/*">
                                </div>
                                <div class="mb-3">
                                    <label for="bookDescription" class="form-label">M√¥ t·∫£</label>
                                    <textarea class="form-control" id="bookDescription" rows="3"></textarea>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="bookIsbn" class="form-label">ISBN</label>
                            <input type="text" class="form-control" id="bookIsbn">
                        </div>
                        <div class="mb-3">
                            <label for="bookPublisher" class="form-label">Nh√† xu·∫•t b·∫£n</label>
                            <input type="text" class="form-control" id="bookPublisher">
                        </div>
                        <div class="mb-3">
                            <label for="bookPublishYear" class="form-label">NƒÉm xu·∫•t b·∫£n</label>
                            <input type="number" class="form-control" id="bookPublishYear" min="1900" max="2024">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="saveBookBtn">L∆∞u s√°ch</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div class="modal fade" id="deleteBookModal" tabindex="-1" aria-labelledby="deleteBookModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteBookModalLabel">X√°c nh·∫≠n x√≥a s√°ch</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s√°ch "<span id="deleteBookTitle"></span>"?</p>
                    <p class="text-danger">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteBtn">X√≥a s√°ch</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Author Modal -->
    <div class="modal fade" id="authorModal" tabindex="-1" aria-labelledby="authorModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="authorModalLabel">Th√™m t√°c gi·∫£ m·ªõi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="authorForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorName" class="form-label">H·ªç v√† t√™n *</label>
                                    <input type="text" class="form-control" id="authorName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="authorPenName" class="form-label">B√∫t danh</label>
                                    <input type="text" class="form-control" id="authorPenName">
                                </div>
                                <div class="mb-3">
                                    <label for="authorCategory" class="form-label">Lƒ©nh v·ª±c ch√≠nh *</label>
                                    <select class="form-select" id="authorCategory" required>
                                        <option value="">Ch·ªçn lƒ©nh v·ª±c</option>
                                        <option value="van-hoc">VƒÉn h·ªçc</option>
                                        <option value="kinh-te">Kinh t·∫ø</option>
                                        <option value="khoa-hoc">Khoa h·ªçc</option>
                                        <option value="giao-duc">Gi√°o d·ª•c</option>
                                        <option value="khac">Kh√°c</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="authorEmail" class="form-label">Email *</label>
                                    <input type="email" class="form-control" id="authorEmail" required>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorPhone" class="form-label">S·ªë ƒëi·ªán tho·∫°i</label>
                                    <input type="tel" class="form-control" id="authorPhone">
                                </div>
                                <div class="mb-3">
                                    <label for="authorStatus" class="form-label">Tr·∫°ng th√°i *</label>
                                    <select class="form-select" id="authorStatus" required>
                                        <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                                        <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                                        <option value="pending">Ch·ªù duy·ªát</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="authorImage" class="form-label">H√¨nh ·∫£nh</label>
                                    <input type="file" class="form-control" id="authorImage" accept="image/*">
                                </div>
                                <div class="mb-3">
                                    <label for="authorBirthYear" class="form-label">NƒÉm sinh</label>
                                    <input type="number" class="form-control" id="authorBirthYear" min="1900" max="2024">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="authorBio" class="form-label">Ti·ªÉu s·ª≠</label>
                            <textarea class="form-control" id="authorBio" rows="4"></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="authorAddress" class="form-label">ƒê·ªãa ch·ªâ</label>
                            <textarea class="form-control" id="authorAddress" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorWebsite" class="form-label">Website</label>
                                    <input type="url" class="form-control" id="authorWebsite">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="authorSocialMedia" class="form-label">M·∫°ng x√£ h·ªôi</label>
                                    <input type="text" class="form-control" id="authorSocialMedia" placeholder="Facebook, Twitter, Instagram...">
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="saveAuthorBtn">L∆∞u t√°c gi·∫£</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Author Confirmation Modal -->
    <div class="modal fade" id="deleteAuthorModal" tabindex="-1" aria-labelledby="deleteAuthorModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteAuthorModalLabel">X√°c nh·∫≠n x√≥a t√°c gi·∫£</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a t√°c gi·∫£ "<span id="deleteAuthorName"></span>"?</p>
                    <p class="text-danger">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>L∆∞u √Ω:</strong> N·∫øu t√°c gi·∫£ n√†y c√≥ s√°ch trong h·ªá th·ªëng, vi·ªác x√≥a c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn d·ªØ li·ªáu s√°ch.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteAuthorBtn">X√≥a t√°c gi·∫£</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Member Modal -->
    <div class="modal fade" id="memberModal" tabindex="-1" aria-labelledby="memberModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="memberModalLabel">Th√™m h·ªôi vi√™n m·ªõi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="memberForm">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="memberFullName" class="form-label">H·ªç v√† t√™n *</label>
                                    <input type="text" class="form-control" id="memberFullName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="memberEmail" class="form-label">Email *</label>
                                    <input type="email" class="form-control" id="memberEmail" required>
                                </div>
                                <div class="mb-3">
                                    <label for="memberPhone" class="form-label">S·ªë ƒëi·ªán tho·∫°i *</label>
                                    <input type="tel" class="form-control" id="memberPhone" required>
                                </div>
                                <div class="mb-3">
                                    <label for="memberDateOfBirth" class="form-label">Ng√†y sinh</label>
                                    <input type="date" class="form-control" id="memberDateOfBirth">
                                </div>
                                <div class="mb-3">
                                    <label for="memberGender" class="form-label">Gi·ªõi t√≠nh</label>
                                    <select class="form-select" id="memberGender">
                                        <option value="">Ch·ªçn gi·ªõi t√≠nh</option>
                                        <option value="male">Nam</option>
                                        <option value="female">N·ªØ</option>
                                        <option value="other">Kh√°c</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="memberType" class="form-label">Lo·∫°i h·ªôi vi√™n *</label>
                                    <select class="form-select" id="memberType" required>
                                        <option value="">Ch·ªçn lo·∫°i h·ªôi vi√™n</option>
                                        <option value="regular">H·ªôi vi√™n th∆∞·ªùng</option>
                                        <option value="premium">H·ªôi vi√™n cao c·∫•p</option>
                                        <option value="vip">H·ªôi vi√™n VIP</option>
                                        <option value="student">H·ªôi vi√™n sinh vi√™n</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="memberStatus" class="form-label">Tr·∫°ng th√°i *</label>
                                    <select class="form-select" id="memberStatus" required>
                                        <option value="active">ƒêang ho·∫°t ƒë·ªông</option>
                                        <option value="inactive">Kh√¥ng ho·∫°t ƒë·ªông</option>
                                        <option value="pending">Ch·ªù duy·ªát</option>
                                        <option value="suspended">T·∫°m kh√≥a</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="memberImage" class="form-label">H√¨nh ·∫£nh</label>
                                    <input type="file" class="form-control" id="memberImage" accept="image/*">
                                </div>
                                <div class="mb-3">
                                    <label for="memberIDCard" class="form-label">S·ªë CMND/CCCD</label>
                                    <input type="text" class="form-control" id="memberIDCard" placeholder="123456789012">
                                </div>
                                <div class="mb-3">
                                    <label for="memberJoinDate" class="form-label">Ng√†y tham gia</label>
                                    <input type="date" class="form-control" id="memberJoinDate">
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="memberAddress" class="form-label">ƒê·ªãa ch·ªâ</label>
                            <textarea class="form-control" id="memberAddress" rows="2"></textarea>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="memberOccupation" class="form-label">Ngh·ªÅ nghi·ªáp</label>
                                    <input type="text" class="form-control" id="memberOccupation" placeholder="Sinh vi√™n, Nh√¢n vi√™n vƒÉn ph√≤ng...">
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="mb-3">
                                    <label for="memberEducation" class="form-label">Tr√¨nh ƒë·ªô h·ªçc v·∫•n</label>
                                    <select class="form-select" id="memberEducation">
                                        <option value="">Ch·ªçn tr√¨nh ƒë·ªô</option>
                                        <option value="high-school">Trung h·ªçc ph·ªï th√¥ng</option>
                                        <option value="college">Cao ƒë·∫≥ng</option>
                                        <option value="university">ƒê·∫°i h·ªçc</option>
                                        <option value="postgraduate">Sau ƒë·∫°i h·ªçc</option>
                                        <option value="other">Kh√°c</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label for="memberInterests" class="form-label">S·ªü th√≠ch ƒë·ªçc s√°ch</label>
                            <textarea class="form-control" id="memberInterests" rows="2" placeholder="VƒÉn h·ªçc, Kinh t·∫ø, Khoa h·ªçc..."></textarea>
                        </div>
                        <div class="mb-3">
                            <label for="memberNotes" class="form-label">Ghi ch√∫</label>
                            <textarea class="form-control" id="memberNotes" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="saveMemberBtn">L∆∞u h·ªôi vi√™n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete Member Confirmation Modal -->
    <div class="modal fade" id="deleteMemberModal" tabindex="-1" aria-labelledby="deleteMemberModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteMemberModalLabel">X√°c nh·∫≠n x√≥a h·ªôi vi√™n</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a h·ªôi vi√™n "<span id="deleteMemberName"></span>"?</p>
                    <p class="text-danger">H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</p>
                    <div class="alert alert-warning">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>L∆∞u √Ω:</strong> N·∫øu h·ªôi vi√™n n√†y c√≥ l·ªãch s·ª≠ m∆∞·ª£n s√°ch ho·∫∑c giao d·ªãch, vi·ªác x√≥a c√≥ th·ªÉ ·∫£nh h∆∞·ªüng ƒë·∫øn d·ªØ li·ªáu h·ªá th·ªëng.
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteMemberBtn">X√≥a h·ªôi vi√™n</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Member Details Modal -->
    <div class="modal fade" id="memberDetailsModal" tabindex="-1" aria-labelledby="memberDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="memberDetailsModalLabel">Chi ti·∫øt h·ªôi vi√™n</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <img id="memberDetailImage" src="" alt="H√¨nh ·∫£nh h·ªôi vi√™n" class="img-fluid rounded mb-3" style="max-width: 200px;">
                            <div class="badge fs-6 p-2 mb-2" id="memberDetailStatus"></div>
                            <div class="badge bg-primary fs-6 p-2" id="memberDetailType"></div>
                        </div>
                        <div class="col-md-8">
                            <h4 class="text-primary" id="memberDetailName"></h4>
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong>Email:</strong> <span id="memberDetailEmail"></span></p>
                                    <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="memberDetailPhone"></span></p>
                                    <p><strong>Ng√†y sinh:</strong> <span id="memberDetailDOB"></span></p>
                                    <p><strong>Gi·ªõi t√≠nh:</strong> <span id="memberDetailGender"></span></p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong>Ng√†y tham gia:</strong> <span id="memberDetailJoinDate"></span></p>
                                    <p><strong>Ngh·ªÅ nghi·ªáp:</strong> <span id="memberDetailOccupation"></span></p>
                                    <p><strong>Tr√¨nh ƒë·ªô:</strong> <span id="memberDetailEducation"></span></p>
                                    <p><strong>CMND/CCCD:</strong> <span id="memberDetailIDCard"></span></p>
                                </div>
                            </div>
                            <p><strong>ƒê·ªãa ch·ªâ:</strong> <span id="memberDetailAddress"></span></p>
                            <p><strong>S·ªü th√≠ch:</strong> <span id="memberDetailInterests"></span></p>
                            <p><strong>Ghi ch√∫:</strong> <span id="memberDetailNotes"></span></p>
                        </div>
                    </div>
                    
                    <!-- Member Statistics -->
                    <hr>
                    <h6 class="text-primary mb-3"><i class="fas fa-chart-bar me-2"></i>Th·ªëng k√™ ho·∫°t ƒë·ªông</h6>
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-primary" id="memberTotalBooks">0</h4>
                                <small class="text-muted">S√°ch ƒë√£ m∆∞·ª£n</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-success" id="memberReturnedBooks">0</h4>
                                <small class="text-muted">S√°ch ƒë√£ tr·∫£</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-warning" id="memberOverdueBooks">0</h4>
                                <small class="text-muted">S√°ch qu√° h·∫°n</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <h4 class="text-info" id="memberTotalSpent">0ƒë</h4>
                                <small class="text-muted">T·ªïng chi ti√™u</small>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                    <button type="button" class="btn btn-primary" id="editMemberFromDetailsBtn">
                        <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk Notification Modal -->
    <div class="modal fade" id="bulkNotificationModal" tabindex="-1" aria-labelledby="bulkNotificationModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bulkNotificationModalLabel">G·ª≠i th√¥ng b√°o h√†ng lo·∫°t</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">G·ª≠i ƒë·∫øn: <span id="selectedMembersCount" class="badge bg-primary"></span> h·ªôi vi√™n</span></label>
                    </div>
                    <div class="mb-3">
                        <label for="notificationTitle" class="form-label">Ti√™u ƒë·ªÅ th√¥ng b√°o *</label>
                        <input type="text" class="form-control" id="notificationTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="notificationMessage" class="form-label">N·ªôi dung th√¥ng b√°o *</label>
                        <textarea class="form-control" id="notificationMessage" rows="4" required></textarea>
                    </div>
                    <div class="mb-3">
                        <label for="notificationType" class="form-label">Lo·∫°i th√¥ng b√°o</label>
                        <select class="form-select" id="notificationType">
                            <option value="info">Th√¥ng tin</option>
                            <option value="warning">C·∫£nh b√°o</option>
                            <option value="success">Th√†nh c√¥ng</option>
                            <option value="danger">Quan tr·ªçng</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sendEmailNotification">
                            <label class="form-check-label" for="sendEmailNotification">
                                G·ª≠i qua email
                            </label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="sendSMSNotification">
                            <label class="form-check-label" for="sendSMSNotification">
                                G·ª≠i qua SMS
                            </label>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="sendBulkNotificationBtn">G·ª≠i th√¥ng b√°o</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS and dependencies -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- Custom Scripts -->
    <script>
        // Global variables
        let currentBooks = [];
        let filteredBooks = [];
        let currentPage = 1;
        let booksPerPage = 10;
        let editingBookId = null;

        // Load books from Firebase
        async function loadBooksFromFirebase() {
            try {
                if (!window.firebase || !window.firebase.database) {
                    console.warn('Firebase not available, returning empty array');
                    return [];
                }
                
                const booksRef = ref(window.firebase.database, 'Books');
                const snapshot = await get(booksRef);
                
                if (snapshot.exists()) {
                    const booksData = snapshot.val();
                    const booksArray = Object.keys(booksData).map(key => ({
                        id: key,
                        ...booksData[key]
                    }));
                    console.log('Books loaded from Firebase:', booksArray.length, 'items');
                    return booksArray;
                } else {
                    console.log('No books found in Firebase');
                    return [];
                }
            } catch (error) {
                console.error('Error loading books from Firebase:', error);
                return [];
            }
        }

        // Initialize dashboard
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOMContentLoaded event fired');
            
            // Initialize books from Firebase
            try {
                currentBooks = await loadBooksFromFirebase();
                filteredBooks = [...currentBooks];
                updateTotalBooksCount();
                renderBooksTable();
                console.log('Books initialized from Firebase:', currentBooks.length);
            } catch (error) {
                console.error('Error initializing books:', error);
                currentBooks = [];
                filteredBooks = [];
            }
            
            // Initialize authors from Firebase
            try {
                currentAuthors = await loadAuthorsFromFirebase();
                filteredAuthors = [...currentAuthors];
                updateTotalAuthorsCount();
                renderAuthorsTable();
                console.log('Authors initialized from Firebase:', currentAuthors.length);
            } catch (error) {
                console.error('Error initializing authors:', error);
                currentAuthors = [];
                filteredAuthors = [];
            }
            
            // Initialize members from Firebase
            try {
                currentMembers = await loadMembersFromFirebase();
                filteredMembers = [...currentMembers];
                updateTotalMembersCount();
                renderMembersTable();
                console.log('Members initialized from Firebase:', currentMembers.length);
            } catch (error) {
                console.error('Error initializing members:', error);
                currentMembers = [];
                filteredMembers = [];
            }
            
            // Initialize orders from Firebase
            try {
                currentOrders = await loadOrdersFromFirebase();
                filteredOrders = [...currentOrders];
                updateTotalOrdersCount();
                renderOrdersTable();
                console.log('Orders initialized from Firebase:', currentOrders.length);
            } catch (error) {
                console.error('Error initializing orders:', error);
                currentOrders = [];
                filteredOrders = [];
            }
            
            // Initialize stories from Firebase
            try {
                currentStories = await loadStoriesFromFirebase();
                filteredStories = [...currentStories];
                updateTotalStoriesCount();
                renderStoriesTable();
                console.log('Stories initialized from Firebase:', currentStories.length);
            } catch (error) {
                console.error('Error initializing stories:', error);
                currentStories = [];
                filteredStories = [];
            }
            
            // Initialize news from Firebase
            try {
                currentNews = await loadNewsFromFirebase();
                filteredNews = [...currentNews];
                updateTotalNewsCount();
                renderNewsTable();
                console.log('News initialized from Firebase:', currentNews.length);
            } catch (error) {
                console.error('Error initializing news:', error);
                currentNews = [];
                filteredNews = [];
            }
            
            setupEventListeners();
            
            // Show dashboard by default
            showDashboard();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Search functionality
            document.getElementById('searchBook').addEventListener('input', function(e) {
                const searchTerm = e.target.value.toLowerCase();
                filterBooks(searchTerm);
            });

            // Save book button
            document.getElementById('saveBookBtn').addEventListener('click', saveBook);

            // Confirm delete button
            document.getElementById('confirmDeleteBtn').addEventListener('click', confirmDeleteBook);

            // Category and status filter changes
            document.getElementById('categoryFilter').addEventListener('change', applyFilters);
            document.getElementById('statusFilter').addEventListener('change', applyFilters);
            
            // Member search functionality
            const searchMemberInput = document.getElementById('searchMember');
            if (searchMemberInput) {
                searchMemberInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    filterMembers(searchTerm);
                });
            }
            
            // Member management buttons
            const saveMemberBtn = document.getElementById('saveMemberBtn');
            if (saveMemberBtn) {
                saveMemberBtn.addEventListener('click', saveMember);
            }
            
            const confirmDeleteMemberBtn = document.getElementById('confirmDeleteMemberBtn');
            if (confirmDeleteMemberBtn) {
                confirmDeleteMemberBtn.addEventListener('click', confirmDeleteMember);
            }
        }

        // Navigation functions
        function showBookManagement() {
            hideAllContent();
            document.getElementById('bookManagementContent').style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('#sidebar .nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector('#sidebar .nav-link[onclick="showBookManagement()"]').classList.add('active');
        }

        function showDashboard() {
            hideAllContent();
            document.getElementById('dashboardContent').style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('#sidebar .nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector('#sidebar .nav-link:first-child').classList.add('active');
        }

        // Bulk operations
        function toggleSelectAll() {
            const headerCheckbox = document.getElementById('headerCheckbox');
            const selectAllCheckbox = document.getElementById('selectAllBooks');
            const bookCheckboxes = document.querySelectorAll('.book-checkbox');
            
            const isChecked = headerCheckbox.checked;
            selectAllCheckbox.checked = isChecked;
            
            bookCheckboxes.forEach(checkbox => {
                checkbox.checked = isChecked;
            });
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const selectedCheckboxes = document.querySelectorAll('.book-checkbox:checked');
            const selectedCount = document.getElementById('selectedCount');
            selectedCount.textContent = selectedCheckboxes.length;
        }

        function getSelectedBookIds() {
            const selectedCheckboxes = document.querySelectorAll('.book-checkbox:checked');
            return Array.from(selectedCheckboxes).map(checkbox => checkbox.value);
        }

        function bulkEdit() {
            const selectedIds = getSelectedBookIds();
            if (selectedIds.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt cu·ªën s√°ch ƒë·ªÉ ch·ªânh s·ª≠a!', 'warning');
                return;
            }
            
            showNotification(`ƒê√£ ch·ªçn ${selectedIds.length} cu·ªën s√°ch ƒë·ªÉ ch·ªânh s·ª≠a h√†ng lo·∫°t`, 'info');
            // TODO: Implement bulk edit modal
        }

        function exportBooks() {
            const booksToExport = filteredBooks.length > 0 ? filteredBooks : currentBooks;
            
            // Create CSV content
            const headers = ['M√£ s√°ch', 'T√™n s√°ch', 'T√°c gi·∫£', 'Th·ªÉ lo·∫°i', 'Gi√°', 'S·ªë l∆∞·ª£ng', 'Tr·∫°ng th√°i', 'ISBN', 'Nh√† xu·∫•t b·∫£n', 'NƒÉm xu·∫•t b·∫£n'];
            const csvContent = [
                headers.join(','),
                ...booksToExport.map(book => [
                    book.id,
                    `"${book.title}"`,
                    `"${book.author}"`,
                    getCategoryName(book.category),
                    book.price,
                    book.quantity,
                    getStatusName(book.status),
                    book.isbn || '',
                    `"${book.publisher || ''}"`,
                    book.publishYear || ''
                ].join(','))
            ].join('\n');

            // Create and download file
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `danh_sach_sach_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Xu·∫•t danh s√°ch s√°ch th√†nh c√¥ng!', 'success');
        }

        // Book management functions
        function openAddBookModal() {
            editingBookId = null;
            document.getElementById('bookModalLabel').textContent = 'Th√™m s√°ch m·ªõi';
            document.getElementById('bookForm').reset();
            document.getElementById('saveBookBtn').textContent = 'L∆∞u s√°ch';
            
            const modal = new bootstrap.Modal(document.getElementById('bookModal'));
            modal.show();
        }

        function openEditBookModal(bookId) {
            const book = currentBooks.find(b => b.id === bookId);
            if (!book) return;

            editingBookId = bookId;
            document.getElementById('bookModalLabel').textContent = 'Ch·ªânh s·ª≠a s√°ch';
            document.getElementById('saveBookBtn').textContent = 'C·∫≠p nh·∫≠t s√°ch';

            // Fill form with book data
            document.getElementById('bookTitle').value = book.title;
            document.getElementById('bookAuthor').value = book.author;
            document.getElementById('bookCategory').value = book.category;
            document.getElementById('bookPrice').value = book.price;
            document.getElementById('bookQuantity').value = book.quantity;
            document.getElementById('bookStatus').value = book.status;
            document.getElementById('bookDescription').value = book.description || '';
            document.getElementById('bookIsbn').value = book.isbn || '';
            document.getElementById('bookPublisher').value = book.publisher || '';
            document.getElementById('bookPublishYear').value = book.publishYear || '';

            const modal = new bootstrap.Modal(document.getElementById('bookModal'));
            modal.show();
        }

        function saveBook() {
            const form = document.getElementById('bookForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const bookData = {
                title: document.getElementById('bookTitle').value.trim(),
                author: document.getElementById('bookAuthor').value.trim(),
                category: document.getElementById('bookCategory').value,
                price: parseInt(document.getElementById('bookPrice').value),
                quantity: parseInt(document.getElementById('bookQuantity').value),
                status: document.getElementById('bookStatus').value,
                description: document.getElementById('bookDescription').value.trim(),
                isbn: document.getElementById('bookIsbn').value.trim(),
                publisher: document.getElementById('bookPublisher').value.trim(),
                publishYear: document.getElementById('bookPublishYear').value ? parseInt(document.getElementById('bookPublishYear').value) : null,
                image: 'images/books/img-01.jpg' // Default image
            };

            // Validation
            if (bookData.price < 0) {
                showNotification('Gi√° s√°ch kh√¥ng th·ªÉ √¢m!', 'danger');
                return;
            }

            if (bookData.quantity < 0) {
                showNotification('S·ªë l∆∞·ª£ng s√°ch kh√¥ng th·ªÉ √¢m!', 'danger');
                return;
            }

            if (bookData.publishYear && (bookData.publishYear < 1900 || bookData.publishYear > new Date().getFullYear())) {
                showNotification('NƒÉm xu·∫•t b·∫£n kh√¥ng h·ª£p l·ªá!', 'danger');
                return;
            }

            if (editingBookId) {
                // Update existing book
                const index = currentBooks.findIndex(b => b.id === editingBookId);
                if (index !== -1) {
                    currentBooks[index] = { ...currentBooks[index], ...bookData };
                    showNotification('C·∫≠p nh·∫≠t s√°ch th√†nh c√¥ng!', 'success');
                }
            } else {
                // Add new book
                const newId = 'BK' + String(currentBooks.length + 1).padStart(3, '0');
                const newBook = { ...bookData, id: newId };
                currentBooks.push(newBook);
                showNotification('Th√™m s√°ch th√†nh c√¥ng!', 'success');
            }

            // Update filtered books and re-render
            filterBooks(document.getElementById('searchBook').value);
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('bookModal'));
            modal.hide();
        }

        function deleteBook(bookId) {
            const book = currentBooks.find(b => b.id === bookId);
            if (!book) return;

            editingBookId = bookId; // Set the editing book ID for deletion
            document.getElementById('deleteBookTitle').textContent = book.title;
            const deleteModal = new bootstrap.Modal(document.getElementById('deleteBookModal'));
            deleteModal.show();
        }

        function confirmDeleteBook() {
            if (!editingBookId) return;

            const index = currentBooks.findIndex(b => b.id === editingBookId);
            if (index !== -1) {
                currentBooks.splice(index, 1);
                showNotification('X√≥a s√°ch th√†nh c√¥ng!', 'success');
                
                // Update filtered books and re-render
                filterBooks(document.getElementById('searchBook').value);
                
                // Reset editing book ID
                editingBookId = null;
            }

            // Close modal
            const deleteModal = bootstrap.Modal.getInstance(document.getElementById('deleteBookModal'));
            deleteModal.hide();
        }

        // Filter and search functions
        function filterBooks(searchTerm = '') {
            const categoryFilter = document.getElementById('categoryFilter').value;
            const statusFilter = document.getElementById('statusFilter').value;

            filteredBooks = currentBooks.filter(book => {
                const matchesSearch = book.title.toLowerCase().includes(searchTerm) ||
                                    book.author.toLowerCase().includes(searchTerm) ||
                                    (book.isbn && book.isbn.toLowerCase().includes(searchTerm));
                
                const matchesCategory = !categoryFilter || book.category === categoryFilter;
                const matchesStatus = !statusFilter || book.status === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            currentPage = 1;
            updateTotalBooksCount();
            renderBooksTable();
        }

        function applyFilters() {
            filterBooks(document.getElementById('searchBook').value);
        }

        // Render functions
        function renderBooksTable() {
            const tbody = document.getElementById('booksTableBody');
            const startIndex = (currentPage - 1) * booksPerPage;
            const endIndex = startIndex + booksPerPage;
            const booksToShow = filteredBooks.slice(startIndex, endIndex);

            if (booksToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-4">
                            <div class="text-muted">
                                <i class="fas fa-search fa-3x mb-3"></i>
                                <h5>Kh√¥ng t√¨m th·∫•y s√°ch n√†o</h5>
                                <p>H√£y th·ª≠ thay ƒë·ªïi t·ª´ kh√≥a t√¨m ki·∫øm ho·∫∑c b·ªô l·ªçc</p>
                            </div>
                        </td>
                    </tr>
                `;
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            tbody.innerHTML = booksToShow.map(book => `
                <tr>
                    <td>
                        <input type="checkbox" class="form-check-input book-checkbox" value="${book.id}" onchange="updateSelectedCount()">
                    </td>
                    <td><strong>${book.id}</strong></td>
                    <td>
                        <img src="${book.image}" alt="${book.title}" 
                             class="book-image"
                             style="width: 50px; height: 70px; object-fit: cover; border-radius: 4px; cursor: pointer;"
                             onclick="previewBookImage('${book.image}', '${book.title}')">
                    </td>
                    <td>
                        <div>
                            <div class="book-title">${book.title}</div>
                            ${book.description ? `<div class="book-description">${book.description.substring(0, 50)}...</div>` : ''}
                        </div>
                    </td>
                    <td><strong>${book.author}</strong></td>
                    <td>
                        <span class="badge bg-${getCategoryColor(book.category)}">
                            ${getCategoryName(book.category)}
                        </span>
                    </td>
                    <td><strong>${formatPrice(book.price)}</strong></td>
                    <td>
                        <span class="badge bg-${book.quantity > 10 ? 'success' : book.quantity > 5 ? 'warning' : 'danger'}">
                            ${book.quantity}
                        </span>
                    </td>
                    <td>
                        <span class="badge bg-${getStatusColor(book.status)}">
                            ${getStatusName(book.status)}
                        </span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" onclick="openEditBookModal('${book.id}')" 
                                    title="Ch·ªânh s·ª≠a s√°ch">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteBook('${book.id}')" 
                                    title="X√≥a s√°ch">
                                <i class="fas fa-trash"></i>
                            </button>
                            <button class="btn btn-outline-info" onclick="viewBookDetails('${book.id}')" 
                                    title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            renderPagination();
            updateSelectedCount();
        }

        function renderPagination() {
            const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';

            // Previous button
            paginationHTML += `
                <li class="page-item ${currentPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage - 1})">Tr∆∞·ªõc</a>
                </li>
            `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }

            // Next button
            paginationHTML += `
                <li class="page-item ${currentPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changePage(${currentPage + 1})">Sau</a>
                </li>
            `;

            pagination.innerHTML = paginationHTML;
        }

        function changePage(page) {
            const totalPages = Math.ceil(filteredBooks.length / booksPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentPage = page;
            renderBooksTable();
        }

        // Utility functions
        function updateTotalBooksCount() {
            document.getElementById('totalBooks').textContent = filteredBooks.length;
        }

        function getCategoryColor(category) {
            const colors = {
                'van-hoc': 'primary',
                'kinh-te': 'success',
                'khoa-hoc': 'info',
                'giao-duc': 'warning',
                'khac': 'secondary'
            };
            return colors[category] || 'secondary';
        }

        function getCategoryName(category) {
            const names = {
                'van-hoc': 'VƒÉn h·ªçc',
                'kinh-te': 'Kinh t·∫ø',
                'khoa-hoc': 'Khoa h·ªçc',
                'giao-duc': 'Gi√°o d·ª•c',
                'khac': 'Kh√°c'
            };
            return names[category] || 'Kh√°c';
        }

        function getStatusColor(status) {
            const colors = {
                'available': 'success',
                'borrowed': 'warning',
                'maintenance': 'danger'
            };
            return colors[status] || 'secondary';
        }

        function getStatusName(status) {
            const names = {
                'available': 'C√≥ s·∫µn',
                'borrowed': 'ƒê√£ m∆∞·ª£n',
                'maintenance': 'B·∫£o tr√¨'
            };
            return names[status] || 'Kh√¥ng x√°c ƒë·ªãnh';
        }

        function formatPrice(price) {
            return new Intl.NumberFormat('vi-VN', {
                style: 'currency',
                currency: 'VND'
            }).format(price);
        }

        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;

            document.body.appendChild(notification);

            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 3000);
        }

        // Sidebar Toggle for Mobile
        document.getElementById('sidebarToggle').addEventListener('click', function() {
            document.body.classList.toggle('sidebar-open');
        });

        // Revenue Chart
        const revenueChart = new Chart(document.getElementById('revenueChart'), {
            type: 'line',
            data: {
                labels: ['T1', 'T2', 'T3', 'T4', 'T5', 'T6', 'T7', 'T8', 'T9', 'T10', 'T11', 'T12'],
                datasets: [{
                    label: 'Doanh thu (tri·ªáu ƒë·ªìng)',
                    data: [32, 28, 35, 42, 38, 45, 52, 48, 55, 50, 47, 45.2],
                    borderColor: '#6f42c1',
                    backgroundColor: 'rgba(111, 66, 193, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                    legend: {
                        display: true,
                        position: 'top'
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            callback: function(value) {
                                return value + 'M';
                            }
                        }
                    }
                }
            }
        });

        // Book Categories Chart
        const bookCategoriesChart = new Chart(document.getElementById('bookCategoriesChart'), {
            type: 'doughnut',
            data: {
                labels: ['VƒÉn h·ªçc', 'Kinh t·∫ø', 'Khoa h·ªçc', 'Gi√°o d·ª•c', 'Kh√°c'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#6f42c1',
                        '#28a745', 
                        '#17a2b8',
                        '#ffc107',
                        '#dc3545'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                maintainAspectRatio: false,
                responsive: true,
                plugins: {
                    legend: {
                        position: 'bottom',
                        labels: {
                            padding: 20,
                            usePointStyle: true
                        }
                    }
                }
            }
        });

        // Auto refresh data every 30 seconds
        setInterval(function() {
            // Here you would typically fetch new data from your API
            console.log('Refreshing dashboard data...');
        }, 30000);

        // Author Management Variables
        let currentAuthors = [];
        let filteredAuthors = [];
        let currentAuthorPage = 1;
        let authorsPerPage = 10;
        let editingAuthorId = null;

        // Load authors from Firebase
        async function loadAuthorsFromFirebase() {
            try {
                if (!window.firebase || !window.firebase.database) {
                    console.warn('Firebase not available, returning empty array');
                    return [];
                }
                
                const authorsRef = ref(window.firebase.database, 'Authors');
                const snapshot = await get(authorsRef);
                
                if (snapshot.exists()) {
                    const authorsData = snapshot.val();
                    const authorsArray = Object.keys(authorsData).map(key => ({
                        id: key,
                        ...authorsData[key]
                    }));
                    console.log('Authors loaded from Firebase:', authorsArray.length, 'items');
                    return authorsArray;
                } else {
                    console.log('No authors found in Firebase');
                    return [];
                }
            } catch (error) {
                console.error('Error loading authors from Firebase:', error);
                return [];
            }
        }

        // Additional utility functions
        function previewBookImage(imageSrc, title) {
            // Create image preview modal
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">H√¨nh ·∫£nh: ${title}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${imageSrc}" alt="${title}" class="img-fluid" style="max-height: 500px;">
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        function viewBookDetails(bookId) {
            const book = currentBooks.find(b => b.id === bookId);
            if (!book) return;

            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Chi ti·∫øt s√°ch: ${book.title}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <img src="${book.image}" alt="${book.title}" class="img-fluid rounded mb-3">
                                    <div class="badge bg-${getStatusColor(book.status)} fs-6 p-2">
                                        ${getStatusName(book.status)}
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <h4 class="text-primary">${book.title}</h4>
                                    <p class="text-muted">T√°c gi·∫£: <strong>${book.author}</strong></p>
                                    <p class="text-muted">Th·ªÉ lo·∫°i: <span class="badge bg-${getCategoryColor(book.category)}">${getCategoryName(book.category)}</span></p>
                                    <p class="text-muted">Gi√°: <strong>${formatPrice(book.price)}</strong></p>
                                    <p class="text-muted">S·ªë l∆∞·ª£ng: <strong>${book.quantity}</strong></p>
                                    ${book.isbn ? `<p class="text-muted">ISBN: <strong>${book.isbn}</strong></p>` : ''}
                                    ${book.publisher ? `<p class="text-muted">Nh√† xu·∫•t b·∫£n: <strong>${book.publisher}</strong></p>` : ''}
                                    ${book.publishYear ? `<p class="text-muted">NƒÉm xu·∫•t b·∫£n: <strong>${book.publishYear}</strong></p>` : ''}
                                    ${book.description ? `<hr><p class="text-muted"><strong>M√¥ t·∫£:</strong><br>${book.description}</p>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                            <button type="button" class="btn btn-primary" onclick="openEditBookModal('${book.id}')" data-bs-dismiss="modal">
                                <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        // Author Management Functions
        function showAuthorManagement() {
            hideAllContent();
            document.getElementById('authorManagementContent').style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            event.target.classList.add('active');
            
            // Load authors if not already loaded
            if (currentAuthors.length === 0) {
                loadAuthors();
            }
        }

        function loadAuthors() {
            // Authors are loaded from Firebase in the main initialization
            if (currentAuthors.length === 0) {
                console.log('No authors available');
                return;
            }
            renderAuthorsTable();
            updateTotalAuthorsCount();
        }

        function openAddAuthorModal() {
            editingAuthorId = null;
            document.getElementById('authorModalLabel').textContent = 'Th√™m t√°c gi·∫£ m·ªõi';
            document.getElementById('authorForm').reset();
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('authorModal'));
            modal.show();
        }

        function openEditAuthorModal(authorId) {
            const author = currentAuthors.find(a => a.id === authorId);
            if (!author) return;

            editingAuthorId = authorId;
            document.getElementById('authorModalLabel').textContent = 'Ch·ªânh s·ª≠a t√°c gi·∫£';
            
            // Populate form fields
            document.getElementById('authorName').value = author.name;
            document.getElementById('authorPenName').value = author.penName || '';
            document.getElementById('authorCategory').value = author.category;
            document.getElementById('authorEmail').value = author.email;
            document.getElementById('authorPhone').value = author.phone || '';
            document.getElementById('authorStatus').value = author.status;
            document.getElementById('authorBirthYear').value = author.birthYear || '';
            document.getElementById('authorBio').value = author.bio || '';
            document.getElementById('authorAddress').value = author.address || '';
            document.getElementById('authorWebsite').value = author.website || '';
            document.getElementById('authorSocialMedia').value = author.socialMedia || '';
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('authorModal'));
            modal.show();
        }

        function saveAuthor() {
            // Get form values
            const name = document.getElementById('authorName').value.trim();
            const penName = document.getElementById('authorPenName').value.trim();
            const category = document.getElementById('authorCategory').value;
            const email = document.getElementById('authorEmail').value.trim();
            const phone = document.getElementById('authorPhone').value.trim();
            const status = document.getElementById('authorStatus').value;
            const birthYear = document.getElementById('authorBirthYear').value;
            const bio = document.getElementById('authorBio').value.trim();
            const address = document.getElementById('authorAddress').value.trim();
            const website = document.getElementById('authorWebsite').value.trim();
            const socialMedia = document.getElementById('authorSocialMedia').value.trim();

            // Validation
            if (!name || !category || !email || !status) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!', 'warning');
                return;
            }

            if (email && !isValidEmail(email)) {
                showNotification('Email kh√¥ng h·ª£p l·ªá!', 'warning');
                return;
            }

            if (birthYear && (birthYear < 1900 || birthYear > 2024)) {
                showNotification('NƒÉm sinh ph·∫£i trong kho·∫£ng 1900-2024!', 'warning');
                return;
            }

            if (editingAuthorId) {
                // Update existing author
                const index = currentAuthors.findIndex(a => a.id === editingAuthorId);
                if (index !== -1) {
                    currentAuthors[index] = {
                        ...currentAuthors[index],
                        name, penName, category, email, phone, status, birthYear, bio, address, website, socialMedia
                    };
                    showNotification('C·∫≠p nh·∫≠t t√°c gi·∫£ th√†nh c√¥ng!', 'success');
                }
            } else {
                // Add new author
                const newAuthor = {
                    id: 'A' + String(currentAuthors.length + 1).padStart(3, '0'),
                    name, penName, category, email, phone, status, 
                    image: 'images/author/placeholder.jpg',
                    birthYear: birthYear || null, bio, address, website, socialMedia,
                    bookCount: 0
                };
                currentAuthors.push(newAuthor);
                showNotification('Th√™m t√°c gi·∫£ th√†nh c√¥ng!', 'success');
            }

            // Update filtered authors and re-render
            filteredAuthors = [...currentAuthors];
            renderAuthorsTable();
            updateTotalAuthorsCount();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('authorModal'));
            modal.hide();
            
            editingAuthorId = null;
        }

        function deleteAuthor(authorId) {
            const author = currentAuthors.find(a => a.id === authorId);
            if (!author) return;

            editingAuthorId = authorId;
            document.getElementById('deleteAuthorName').textContent = author.name;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteAuthorModal'));
            modal.show();
        }

        function confirmDeleteAuthor() {
            if (editingAuthorId) {
                currentAuthors = currentAuthors.filter(a => a.id !== editingAuthorId);
                filteredAuthors = [...currentAuthors];
                renderAuthorsTable();
                updateTotalAuthorsCount();
                showNotification('X√≥a t√°c gi·∫£ th√†nh c√¥ng!', 'success');
                
                editingAuthorId = null;
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteAuthorModal'));
                modal.hide();
            }
        }

        function filterAuthors(searchTerm) {
            if (!searchTerm) {
                filteredAuthors = [...currentAuthors];
            } else {
                filteredAuthors = currentAuthors.filter(author => {
                    const matchesSearch = 
                        author.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        (author.penName && author.penName.toLowerCase().includes(searchTerm.toLowerCase())) ||
                        author.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        (author.bio && author.bio.toLowerCase().includes(searchTerm.toLowerCase()));
                    
                    return matchesSearch;
                });
            }
            
            currentAuthorPage = 1;
            renderAuthorsTable();
        }

        function applyAuthorFilters() {
            const searchTerm = document.getElementById('searchAuthor').value;
            const statusFilter = document.getElementById('authorStatusFilter').value;
            const categoryFilter = document.getElementById('authorCategoryFilter').value;

            filteredAuthors = currentAuthors.filter(author => {
                let matchesSearch = true;
                let matchesStatus = true;
                let matchesCategory = true;

                if (searchTerm) {
                    matchesSearch = 
                        author.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        (author.penName && author.penName.toLowerCase().includes(searchTerm.toLowerCase())) ||
                        author.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        (author.bio && author.bio.toLowerCase().includes(searchTerm.toLowerCase()));
                }

                if (statusFilter) {
                    matchesStatus = author.status === statusFilter;
                }

                if (categoryFilter) {
                    matchesCategory = author.category === categoryFilter;
                }

                return matchesSearch && matchesStatus && matchesCategory;
            });

            currentAuthorPage = 1;
            renderAuthorsTable();
        }

        function renderAuthorsTable() {
            const tbody = document.getElementById('authorsTableBody');
            const startIndex = (currentAuthorPage - 1) * authorsPerPage;
            const endIndex = startIndex + authorsPerPage;
            const authorsToShow = filteredAuthors.slice(startIndex, endIndex);

            if (authorsToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="8" class="text-center py-4">
                            <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Kh√¥ng t√¨m th·∫•y t√°c gi·∫£ n√†o</p>
                        </td>
                    </tr>
                `;
                document.getElementById('authorPagination').innerHTML = '';
                return;
            }

            tbody.innerHTML = authorsToShow.map(author => `
                <tr>
                    <td>
                        <input type="checkbox" class="form-check-input author-checkbox" value="${author.id}" onchange="updateSelectedAuthorCount()">
                    </td>
                    <td><strong>${author.id}</strong></td>
                    <td>
                        <img src="${author.image}" alt="${author.name}" class="author-image rounded" style="width: 50px; height: 50px; object-fit: cover;" onclick="previewAuthorImage('${author.image}', '${author.name}')">
                    </td>
                    <td>
                        <div class="author-name">${author.name}</div>
                        ${author.penName ? `<div class="author-pen-name text-muted">B√∫t danh: ${author.penName}</div>` : ''}
                        <div class="author-email text-muted">${author.email}</div>
                        ${author.phone ? `<div class="author-phone text-muted">${author.phone}</div>` : ''}
                    </td>
                    <td>
                        <span class="badge bg-${getAuthorCategoryColor(author.category)}">${getAuthorCategoryName(author.category)}</span>
                    </td>
                    <td>
                        <span class="badge bg-info">${author.bookCount}</span>
                    </td>
                    <td>
                        <span class="badge bg-${getAuthorStatusColor(author.status)}">${getAuthorStatusName(author.status)}</span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" onclick="viewAuthorDetails('${author.id}')" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning" onclick="openEditAuthorModal('${author.id}')" title="Ch·ªânh s·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteAuthor('${author.id}')" title="X√≥a">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            renderAuthorPagination();
            updateSelectedAuthorCount();
        }

        function renderAuthorPagination() {
            const totalPages = Math.ceil(filteredAuthors.length / authorsPerPage);
            const pagination = document.getElementById('authorPagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentAuthorPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeAuthorPage(${currentAuthorPage - 1})">Tr∆∞·ªõc</a>
                </li>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentAuthorPage - 2 && i <= currentAuthorPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentAuthorPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changeAuthorPage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentAuthorPage - 3 || i === currentAuthorPage + 3) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${currentAuthorPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeAuthorPage(${currentAuthorPage + 1})">Sau</a>
                </li>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        function changeAuthorPage(page) {
            const totalPages = Math.ceil(filteredAuthors.length / authorsPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentAuthorPage = page;
            renderAuthorsTable();
        }

        function toggleSelectAllAuthors() {
            const selectAll = document.getElementById('selectAllAuthors');
            const checkboxes = document.querySelectorAll('.author-checkbox');
            const headerCheckbox = document.getElementById('authorHeaderCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            headerCheckbox.checked = selectAll.checked;
            updateSelectedAuthorCount();
        }

        function updateSelectedAuthorCount() {
            const selectedCheckboxes = document.querySelectorAll('.author-checkbox:checked');
            document.getElementById('selectedAuthorCount').textContent = selectedCheckboxes.length;
        }

        function getSelectedAuthorIds() {
            const selectedCheckboxes = document.querySelectorAll('.author-checkbox:checked');
            return Array.from(selectedCheckboxes).map(checkbox => checkbox.value);
        }

        function bulkAuthorEdit() {
            const selectedIds = getSelectedAuthorIds();
            if (selectedIds.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt t√°c gi·∫£!', 'warning');
                return;
            }
            
            showNotification(`ƒê√£ ch·ªçn ${selectedIds.length} t√°c gi·∫£ ƒë·ªÉ ch·ªânh s·ª≠a h√†ng lo·∫°t`, 'info');
            // TODO: Implement bulk edit functionality
        }

        function exportAuthors() {
            if (filteredAuthors.length === 0) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!', 'warning');
                return;
            }

            const csvContent = [
                ['M√£ t√°c gi·∫£', 'H·ªç v√† t√™n', 'B√∫t danh', 'Lƒ©nh v·ª±c', 'Email', 'S·ªë ƒëi·ªán tho·∫°i', 'Tr·∫°ng th√°i', 'S·ªë s√°ch'],
                ...filteredAuthors.map(author => [
                    author.id,
                    author.name,
                    author.penName || '',
                    getAuthorCategoryName(author.category),
                    author.email,
                    author.phone || '',
                    getAuthorStatusName(author.status),
                    author.bookCount
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `danh_sach_tac_gia_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Xu·∫•t danh s√°ch t√°c gi·∫£ th√†nh c√¥ng!', 'success');
        }

        function updateTotalAuthorsCount() {
            document.getElementById('totalAuthors').textContent = filteredAuthors.length;
        }

        function getAuthorCategoryColor(category) {
            const colors = {
                'van-hoc': 'primary',
                'kinh-te': 'success',
                'khoa-hoc': 'info',
                'giao-duc': 'warning',
                'khac': 'secondary'
            };
            return colors[category] || 'secondary';
        }

        function getAuthorCategoryName(category) {
            const names = {
                'van-hoc': 'VƒÉn h·ªçc',
                'kinh-te': 'Kinh t·∫ø',
                'khoa-hoc': 'Khoa h·ªçc',
                'giao-duc': 'Gi√°o d·ª•c',
                'khac': 'Kh√°c'
            };
            return names[category] || 'Kh√°c';
        }

        function getAuthorStatusColor(status) {
            const colors = {
                'active': 'success',
                'inactive': 'secondary',
                'pending': 'warning'
            };
            return colors[status] || 'secondary';
        }

        function getAuthorStatusName(status) {
            const names = {
                'active': 'ƒêang ho·∫°t ƒë·ªông',
                'inactive': 'Kh√¥ng ho·∫°t ƒë·ªông',
                'pending': 'Ch·ªù duy·ªát'
            };
            return names[status] || 'Kh√¥ng x√°c ƒë·ªãnh';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function previewAuthorImage(imageSrc, name) {
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">H√¨nh ·∫£nh: ${name}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${imageSrc}" alt="${name}" class="img-fluid" style="max-height: 500px;">
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        function viewAuthorDetails(authorId) {
            const author = currentAuthors.find(a => a.id === authorId);
            if (!author) return;

            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Chi ti·∫øt t√°c gi·∫£: ${author.name}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <img src="${author.image}" alt="${author.name}" class="img-fluid rounded mb-3">
                                    <div class="badge bg-${getAuthorStatusColor(author.status)} fs-6 p-2">
                                        ${getAuthorStatusName(author.status)}
                                    </div>
                                </div>
                                <div class="col-md-8">
                                    <h4 class="text-primary">${author.name}</h4>
                                    ${author.penName ? `<p class="text-muted">B√∫t danh: <strong>${author.penName}</strong></p>` : ''}
                                    <p class="text-muted">Lƒ©nh v·ª±c: <span class="badge bg-${getAuthorCategoryColor(author.category)}">${getAuthorCategoryName(author.category)}</span></p>
                                    <p class="text-muted">Email: <strong>${author.email}</strong></p>
                                    ${author.phone ? `<p class="text-muted">S·ªë ƒëi·ªán tho·∫°i: <strong>${author.phone}</strong></p>` : ''}
                                    ${author.birthYear ? `<p class="text-muted">NƒÉm sinh: <strong>${author.birthYear}</strong></p>` : ''}
                                    ${author.address ? `<p class="text-muted">ƒê·ªãa ch·ªâ: <strong>${author.address}</strong></p>` : ''}
                                    ${author.website ? `<p class="text-muted">Website: <strong><a href="${author.website}" target="_blank">${author.website}</a></strong></p>` : ''}
                                    ${author.socialMedia ? `<p class="text-muted">M·∫°ng x√£ h·ªôi: <strong>${author.socialMedia}</strong></p>` : ''}
                                    <p class="text-muted">S·ªë s√°ch: <strong>${author.bookCount}</strong></p>
                                    ${author.bio ? `<hr><p class="text-muted"><strong>Ti·ªÉu s·ª≠:</strong><br>${author.bio}</p>` : ''}
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                            <button type="button" class="btn btn-primary" onclick="openEditAuthorModal('${author.id}')" data-bs-dismiss="modal">
                                <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                            </button>
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        // Setup event listeners for author management
        document.addEventListener('DOMContentLoaded', function() {
            // Existing event listeners...
            
            // Author management event listeners
            document.getElementById('searchAuthor').addEventListener('input', function() {
                filterAuthors(this.value);
            });
            
            document.getElementById('saveAuthorBtn').addEventListener('click', saveAuthor);
            document.getElementById('confirmDeleteAuthorBtn').addEventListener('click', confirmDeleteAuthor);
        });

        // Member Management Variables
        let currentMembers = [];
        let filteredMembers = [];
        let currentMemberPage = 1;
        let membersPerPage = 10;
        let editingMemberId = null;

        // Load members from Firebase
        async function loadMembersFromFirebase() {
            try {
                if (!window.firebase || !window.firebase.database) {
                    console.warn('Firebase not available, returning empty array');
                    return [];
                }
                
                const membersRef = ref(window.firebase.database, 'Members');
                const snapshot = await get(membersRef);
                
                if (snapshot.exists()) {
                    const membersData = snapshot.val();
                    const membersArray = Object.keys(membersData).map(key => ({
                        id: key,
                        ...membersData[key]
                    }));
                    console.log('Members loaded from Firebase:', membersArray.length, 'items');
                    return membersArray;
                } else {
                    console.log('No members found in Firebase');
                    return [];
                }
            } catch (error) {
                console.error('Error loading members from Firebase:', error);
                return [];
            }
        }

        // Additional utility functions
        function previewMemberImage(imageSrc, name) {
            // Create image preview modal
            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-lg">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">H√¨nh ·∫£nh: ${name}</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body text-center">
                            <img src="${imageSrc}" alt="${name}" class="img-fluid" style="max-height: 500px;">
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        function viewMemberDetails(memberId) {
            const member = currentMembers.find(m => m.id === memberId);
            if (!member) return;

            const modal = document.createElement('div');
            modal.className = 'modal fade';
            modal.innerHTML = `
                <div class="modal-dialog modal-xl">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title">Chi ti·∫øt h·ªôi vi√™n</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col-md-4 text-center">
                                    <img src="${member.image}" alt="${member.fullName}" class="img-fluid rounded mb-3" style="max-width: 200px;">
                                    <div class="badge fs-6 p-2 mb-2" id="memberDetailStatus"></div>
                                    <div class="badge bg-primary fs-6 p-2" id="memberDetailType"></div>
                                </div>
                                <div class="col-md-8">
                                    <h4 class="text-primary" id="memberDetailName"></h4>
                                    <div class="row">
                                        <div class="col-md-6">
                                            <p><strong>Email:</strong> <span id="memberDetailEmail"></span></p>
                                            <p><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> <span id="memberDetailPhone"></span></p>
                                            <p><strong>Ng√†y sinh:</strong> <span id="memberDetailDOB"></span></p>
                                            <p><strong>Gi·ªõi t√≠nh:</strong> <span id="memberDetailGender"></span></p>
                                        </div>
                                        <div class="col-md-6">
                                            <p><strong>Ng√†y tham gia:</strong> <span id="memberDetailJoinDate"></span></p>
                                            <p><strong>Ngh·ªÅ nghi·ªáp:</strong> <span id="memberDetailOccupation"></span></p>
                                            <p><strong>Tr√¨nh ƒë·ªô:</strong> <span id="memberDetailEducation"></span></p>
                                            <p><strong>CMND/CCCD:</strong> <span id="memberDetailIDCard"></span></p>
                                        </div>
                                    </div>
                                    <p><strong>ƒê·ªãa ch·ªâ:</strong> <span id="memberDetailAddress"></span></p>
                                    <p><strong>S·ªü th√≠ch:</strong> <span id="memberDetailInterests"></span></p>
                                    <p><strong>Ghi ch√∫:</strong> <span id="memberDetailNotes"></span></p>
                                </div>
                            </div>
                            
                            <!-- Member Statistics -->
                            <hr>
                            <h6 class="text-primary mb-3"><i class="fas fa-chart-bar me-2"></i>Th·ªëng k√™ ho·∫°t ƒë·ªông</h6>
                            <div class="row text-center">
                                <div class="col-md-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-primary" id="memberTotalBooks">0</h4>
                                        <small class="text-muted">S√°ch ƒë√£ m∆∞·ª£n</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-success" id="memberReturnedBooks">0</h4>
                                        <small class="text-muted">S√°ch ƒë√£ tr·∫£</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-warning" id="memberOverdueBooks">0</h4>
                                        <small class="text-muted">S√°ch qu√° h·∫°n</small>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="border rounded p-3">
                                        <h4 class="text-info" id="memberTotalSpent">0ƒë</h4>
                                        <small class="text-muted">T·ªïng chi ti√™u</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                            <button type="button" class="btn btn-primary" id="editMemberFromDetailsBtn">
                                <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                            </button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            const bsModal = new bootstrap.Modal(modal);
            bsModal.show();
            
            modal.addEventListener('hidden.bs.modal', function() {
                document.body.removeChild(modal);
            });
        }

        // Member Management Functions
        function showMemberManagement() {
            console.log('showMemberManagement called');
            
            // Hide all content first
            hideAllContent();
            
            // Show member management content
            const memberManagementContent = document.getElementById('memberManagementContent');
            if (memberManagementContent) {
                memberManagementContent.style.display = 'block';
                console.log('Member management content shown');
            } else {
                console.error('memberManagementContent not found');
            }
            
            // Update sidebar active state
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const memberLink = document.querySelector('a[onclick="showMemberManagement()"]');
            if (memberLink) memberLink.classList.add('active');
            
            // Initialize member management
            initMemberManagement();
        }

        // Initialize Member Management
        function initMemberManagement() {
            loadMembers();
            setupMemberEventListeners();
            updateTotalMembersCount();
        }

        // Setup Member Event Listeners
        function setupMemberEventListeners() {
            // Search functionality
            const searchMemberInput = document.getElementById('searchMember');
            if (searchMemberInput) {
                searchMemberInput.addEventListener('input', function(e) {
                    const searchTerm = e.target.value.toLowerCase();
                    filterMembers(searchTerm);
                });
            }
            
            // Status filter
            const memberStatusFilter = document.getElementById('memberStatusFilter');
            if (memberStatusFilter) {
                memberStatusFilter.addEventListener('change', applyMemberFilters);
            }
            
            // Type filter
            const memberTypeFilter = document.getElementById('memberTypeFilter');
            if (memberTypeFilter) {
                memberTypeFilter.addEventListener('change', applyMemberFilters);
            }
        }

        function showOrderManagement() {
            console.log('showOrderManagement called');
            
            // Hide all content first
            hideAllContent();
            
            // Show order management content
            const orderManagementContent = document.getElementById('orderManagementContent');
            if (orderManagementContent) {
                orderManagementContent.style.display = 'block';
                console.log('Order management content shown');
            } else {
                console.error('orderManagementContent not found');
            }
            
            // Update sidebar active state
            document.querySelectorAll('.nav-link').forEach(link => link.classList.remove('active'));
            const orderLink = document.querySelector('a[onclick="showOrderManagement()"]');
            if (orderLink) orderLink.classList.add('active');
            
            // Initialize order management
            initOrderManagement();
        }

        function loadMembers() {
            console.log('loadMembers called');
            
            // Members are loaded from Firebase in the main initialization
            if (currentMembers.length === 0) {
                console.log('No members available');
                return;
            }
            
            console.log('currentMembers loaded:', currentMembers.length);
            console.log('filteredMembers loaded:', filteredMembers.length);
            
            renderMembersTable();
            updateTotalMembersCount();
        }

        function openAddMemberModal() {
            editingMemberId = null;
            document.getElementById('memberModalLabel').textContent = 'Th√™m h·ªôi vi√™n m·ªõi';
            document.getElementById('memberForm').reset();
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('memberModal'));
            modal.show();
        }

        function openEditMemberModal(memberId) {
            const member = currentMembers.find(m => m.id === memberId);
            if (!member) return;

            editingMemberId = memberId;
            document.getElementById('memberModalLabel').textContent = 'Ch·ªânh s·ª≠a h·ªôi vi√™n';
            
            // Populate form fields
            document.getElementById('memberFullName').value = member.fullName;
            document.getElementById('memberEmail').value = member.email;
            document.getElementById('memberPhone').value = member.phone;
            document.getElementById('memberDateOfBirth').value = member.dateOfBirth;
            document.getElementById('memberGender').value = member.gender;
            document.getElementById('memberType').value = member.type;
            document.getElementById('memberStatus').value = member.status;
            document.getElementById('memberImage').value = member.image;
            document.getElementById('memberAddress').value = member.address;
            document.getElementById('memberOccupation').value = member.occupation;
            document.getElementById('memberEducation').value = member.education;
            document.getElementById('memberInterests').value = member.interests;
            document.getElementById('memberNotes').value = member.notes;
            document.getElementById('memberJoinDate').value = member.joinDate;
            document.getElementById('memberIDCard').value = member.idCard;
            
            // Show the modal
            const modal = new bootstrap.Modal(document.getElementById('memberModal'));
            modal.show();
        }

        function saveMember() {
            // Get form values
            const fullName = document.getElementById('memberFullName').value.trim();
            const email = document.getElementById('memberEmail').value.trim();
            const phone = document.getElementById('memberPhone').value.trim();
            const dateOfBirth = document.getElementById('memberDateOfBirth').value;
            const gender = document.getElementById('memberGender').value;
            const type = document.getElementById('memberType').value;
            const status = document.getElementById('memberStatus').value;
            const image = document.getElementById('memberImage').value;
            const address = document.getElementById('memberAddress').value.trim();
            const occupation = document.getElementById('memberOccupation').value.trim();
            const education = document.getElementById('memberEducation').value;
            const interests = document.getElementById('memberInterests').value.trim();
            const notes = document.getElementById('memberNotes').value.trim();
            const joinDate = document.getElementById('memberJoinDate').value;
            const idCard = document.getElementById('memberIDCard').value.trim();

            // Validation
            if (!fullName || !email || !phone || !dateOfBirth || !gender || !type || !status || !image || !address || !occupation || !education || !interests || !notes || !joinDate || !idCard) {
                showNotification('Vui l√≤ng ƒëi·ªÅn ƒë·∫ßy ƒë·ªß th√¥ng tin b·∫Øt bu·ªôc!', 'warning');
                return;
            }

            if (email && !isValidEmail(email)) {
                showNotification('Email kh√¥ng h·ª£p l·ªá!', 'warning');
                return;
            }

            if (editingMemberId) {
                // Update existing member
                const index = currentMembers.findIndex(m => m.id === editingMemberId);
                if (index !== -1) {
                    currentMembers[index] = {
                        ...currentMembers[index],
                        fullName, email, phone, dateOfBirth, gender, type, status, image, address, occupation, education, interests, notes, joinDate, idCard
                    };
                    showNotification('C·∫≠p nh·∫≠t h·ªôi vi√™n th√†nh c√¥ng!', 'success');
                }
            } else {
                // Add new member
                const newMember = {
                    id: 'M' + String(currentMembers.length + 1).padStart(3, '0'),
                    fullName, email, phone, dateOfBirth, gender, type, status, 
                    image: 'images/member/placeholder.jpg',
                    address, occupation, education, interests, notes, joinDate, idCard,
                    totalBooks: 0,
                    returnedBooks: 0,
                    overdueBooks: 0,
                    totalSpent: 0
                };
                currentMembers.push(newMember);
                showNotification('Th√™m h·ªôi vi√™n th√†nh c√¥ng!', 'success');
            }

            // Update filtered members and re-render
            filteredMembers = [...currentMembers];
            renderMembersTable();
            updateTotalMembersCount();
            
            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('memberModal'));
            modal.hide();
            
            editingMemberId = null;
        }

        function deleteMember(memberId) {
            const member = currentMembers.find(m => m.id === memberId);
            if (!member) return;

            editingMemberId = memberId;
            document.getElementById('deleteMemberName').textContent = member.fullName;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteMemberModal'));
            modal.show();
        }

        function confirmDeleteMember() {
            if (editingMemberId) {
                currentMembers = currentMembers.filter(m => m.id !== editingMemberId);
                filteredMembers = [...currentMembers];
                renderMembersTable();
                updateTotalMembersCount();
                showNotification('X√≥a h·ªôi vi√™n th√†nh c√¥ng!', 'success');
                
                editingMemberId = null;
                
                const modal = bootstrap.Modal.getInstance(document.getElementById('deleteMemberModal'));
                modal.hide();
            }
        }

        function filterMembers(searchTerm) {
            if (!searchTerm) {
                filteredMembers = [...currentMembers];
            } else {
                filteredMembers = currentMembers.filter(member => {
                    const matchesSearch = 
                        member.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.phone.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.address.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.occupation.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.education.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.interests.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.notes.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.joinDate.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.idCard.toLowerCase().includes(searchTerm.toLowerCase());
                    
                    return matchesSearch;
                });
            }
            
            currentMemberPage = 1;
            renderMembersTable();
        }

        function applyMemberFilters() {
            const searchTerm = document.getElementById('searchMember').value;
            const statusFilter = document.getElementById('memberStatusFilter').value;
            const typeFilter = document.getElementById('memberTypeFilter').value;

            filteredMembers = currentMembers.filter(member => {
                let matchesSearch = true;
                let matchesStatus = true;
                let matchesType = true;

                if (searchTerm) {
                    matchesSearch = 
                        member.fullName.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.email.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.phone.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.address.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.occupation.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.education.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.interests.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.notes.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.joinDate.toLowerCase().includes(searchTerm.toLowerCase()) ||
                        member.idCard.toLowerCase().includes(searchTerm.toLowerCase());
                }

                if (statusFilter) {
                    matchesStatus = member.status === statusFilter;
                }

                if (typeFilter) {
                    matchesType = member.type === typeFilter;
                }

                return matchesSearch && matchesStatus && matchesType;
            });

            currentMemberPage = 1;
            renderMembersTable();
        }

        function renderMembersTable() {
            console.log('renderMembersTable called');
            
            const tbody = document.getElementById('membersTableBody');
            if (!tbody) {
                console.error('membersTableBody not found');
                return;
            }
            
            console.log('tbody found:', tbody);
            
            const startIndex = (currentMemberPage - 1) * membersPerPage;
            const endIndex = startIndex + membersPerPage;
            const membersToShow = filteredMembers.slice(startIndex, endIndex);
            
            console.log('membersToShow:', membersToShow);

            if (membersToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-4">
                            <i class="fas fa-user-slash fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Kh√¥ng t√¨m th·∫•y h·ªôi vi√™n n√†o</p>
                        </td>
                    </tr>
                `;
                document.getElementById('memberPagination').innerHTML = '';
                return;
            }

            tbody.innerHTML = membersToShow.map(member => `
                <tr>
                    <td>
                        <input type="checkbox" class="form-check-input member-checkbox" value="${member.id}" onchange="updateSelectedMemberCount()">
                    </td>
                    <td><strong>${member.id}</strong></td>
                    <td>
                        <img src="${member.image}" alt="${member.fullName}" class="img-fluid rounded" style="width: 50px; height: 50px; object-fit: cover;" onclick="previewMemberImage('${member.image}', '${member.fullName}')">
                    </td>
                    <td>
                        <div class="member-name">${member.fullName}</div>
                        <div class="member-email text-muted">${member.email}</div>
                        ${member.phone ? `<div class="member-phone text-muted">${member.phone}</div>` : ''}
                    </td>
                    <td>
                        <span class="badge bg-${getMemberTypeColor(member.type)}">${getMemberTypeName(member.type)}</span>
                    </td>
                    <td>
                        <span class="badge bg-${getStatusColor(member.status)}">${getStatusName(member.status)}</span>
                    </td>
                    <td>
                        <span class="badge bg-info">${member.joinDate}</span>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" onclick="viewMemberDetails('${member.id}')" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning" onclick="openEditMemberModal('${member.id}')" title="Ch·ªânh s·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteMember('${member.id}')" title="X√≥a">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            renderMemberPagination();
            updateSelectedMemberCount();
        }

        function renderMemberPagination() {
            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
            const pagination = document.getElementById('memberPagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentMemberPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeMemberPage(${currentMemberPage - 1})">Tr∆∞·ªõc</a>
                </li>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentMemberPage - 2 && i <= currentMemberPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentMemberPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changeMemberPage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentMemberPage - 3 || i === currentMemberPage + 3) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${currentMemberPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeMemberPage(${currentMemberPage + 1})">Sau</a>
                </li>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        function changeMemberPage(page) {
            const totalPages = Math.ceil(filteredMembers.length / membersPerPage);
            if (page < 1 || page > totalPages) return;
            
            currentMemberPage = page;
            renderMembersTable();
        }

        function toggleSelectAllMembers() {
            const selectAll = document.getElementById('selectAllMembers');
            const checkboxes = document.querySelectorAll('.member-checkbox');
            const headerCheckbox = document.getElementById('memberHeaderCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            headerCheckbox.checked = selectAll.checked;
            updateSelectedMemberCount();
        }

        function updateSelectedMemberCount() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            document.getElementById('selectedMemberCount').textContent = selectedCheckboxes.length;
        }

        function getSelectedMemberIds() {
            const selectedCheckboxes = document.querySelectorAll('.member-checkbox:checked');
            return Array.from(selectedCheckboxes).map(checkbox => checkbox.value);
        }

        function bulkMemberEdit() {
            const selectedIds = getSelectedMemberIds();
            if (selectedIds.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt h·ªôi vi√™n!', 'warning');
                return;
            }
            
            showNotification(`ƒê√£ ch·ªçn ${selectedIds.length} h·ªôi vi√™n ƒë·ªÉ ch·ªânh s·ª≠a h√†ng lo·∫°t`, 'info');
            // TODO: Implement bulk edit functionality
        }

        function exportMembers() {
            if (filteredMembers.length === 0) {
                showNotification('Kh√¥ng c√≥ d·ªØ li·ªáu ƒë·ªÉ xu·∫•t!', 'warning');
                return;
            }

            const csvContent = [
                ['M√£ h·ªôi vi√™n', 'H·ªç v√† t√™n', 'Email', 'S·ªë ƒëi·ªán tho·∫°i', 'Lo·∫°i h·ªôi vi√™n', 'Tr·∫°ng th√°i', 'Ng√†y tham gia', 'S·ªë s√°ch ƒë√£ m∆∞·ª£n', 'S√°ch ƒë√£ tr·∫£', 'S√°ch qu√° h·∫°n', 'T·ªïng chi ti√™u'],
                ...filteredMembers.map(member => [
                    member.id,
                    member.fullName,
                    member.email,
                    member.phone,
                    getMemberTypeName(member.type),
                    getStatusName(member.status),
                    member.joinDate,
                    member.totalBooks,
                    member.returnedBooks,
                    member.overdueBooks,
                    member.totalSpent
                ])
            ].map(row => row.map(field => `"${field}"`).join(',')).join('\n');

            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `danh_sach_hoi_vien_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            showNotification('Xu·∫•t danh s√°ch h·ªôi vi√™n th√†nh c√¥ng!', 'success');
        }

        function updateTotalMembersCount() {
            document.getElementById('totalMembers').textContent = filteredMembers.length;
        }

        function updateTotalOrdersCount() {
            const totalOrdersElement = document.getElementById('totalOrders');
            if (totalOrdersElement) {
                totalOrdersElement.textContent = filteredOrders.length;
            }
        }

        function updateTotalStoriesCount() {
            const totalStoriesElement = document.getElementById('totalStories');
            if (totalStoriesElement) {
                totalStoriesElement.textContent = filteredStories.length;
            }
        }

        function updateTotalNewsCount() {
            const totalNewsElement = document.getElementById('totalNews');
            if (totalNewsElement) {
                totalNewsElement.textContent = filteredNews.length;
            }
        }

        function getMemberTypeColor(type) {
            const colors = {
                'regular': 'primary',
                'premium': 'success',
                'vip': 'warning',
                'student': 'info'
            };
            return colors[type] || 'secondary';
        }

        function getMemberTypeName(type) {
            const names = {
                'regular': 'H·ªôi vi√™n th∆∞·ªùng',
                'premium': 'H·ªôi vi√™n cao c·∫•p',
                'vip': 'H·ªôi vi√™n VIP',
                'student': 'H·ªôi vi√™n sinh vi√™n'
            };
            return names[type] || 'Kh√°c';
        }

        function getStatusColor(status) {
            const colors = {
                'active': 'success',
                'inactive': 'secondary',
                'pending': 'warning',
                'suspended': 'danger'
            };
            return colors[status] || 'secondary';
        }

        function getStatusName(status) {
            const names = {
                'active': 'ƒêang ho·∫°t ƒë·ªông',
                'inactive': 'Kh√¥ng ho·∫°t ƒë·ªông',
                'pending': 'Ch·ªù duy·ªát',
                'suspended': 'T·∫°m kh√≥a'
            };
            return names[status] || 'Kh√¥ng x√°c ƒë·ªãnh';
        }

        function isValidEmail(email) {
            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return emailRegex.test(email);
        }

        function sendBulkNotification() {
            // Implement bulk notification functionality
            console.log('Sending bulk notification...');
        }

        // Order Management Functions
        function exportOrders() {
            // Implement export orders functionality
            console.log('Exporting orders...');
        }

        function openBulkOrderUpdateModal() {
            // Implement open bulk order update modal functionality
            console.log('Opening bulk order update modal...');
        }

        function applyOrderFilters() {
            // Implement apply order filters functionality
            console.log('Applying order filters...');
        }

        function resetOrderFilters() {
            // Implement reset order filters functionality
            console.log('Resetting order filters...');
        }

        function updateOrderStatus() {
            // Implement update order status functionality
            console.log('Updating order status...');
        }

        function openEditOrderModal() {
            // Implement open edit order modal functionality
            console.log('Opening edit order modal...');
        }

        function saveOrderChanges() {
            // Implement save order changes functionality
            console.log('Saving order changes...');
        }

        // Order Management Functions
        let orders = [];
        let filteredOrders = [];
        let selectedOrders = [];
        let currentOrderPage = 1;
        const ordersPerPage = 10;

        // Initialize Order Management
        function initOrderManagement() {
            loadOrders();
            setupOrderEventListeners();
            updateOrderStatistics();
        }

        // Load Orders from Firebase
        async function loadOrders() {
            try {
                showLoading('ordersTableBody');
                
                // Load orders from Firebase
                const firebaseOrders = await loadOrdersFromFirebase();
                if (firebaseOrders.length > 0) {
                    orders = firebaseOrders;
                    filteredOrders = [...orders];
                    console.log('Orders loaded from Firebase:', firebaseOrders.length, 'items');
                } else {
                    orders = [];
                    filteredOrders = [];
                    console.log('No orders available from Firebase');
                }
                
                displayOrders();
                updateOrderStatistics();
                hideLoading('ordersTableBody');
            } catch (error) {
                console.error('Error loading orders:', error);
                orders = [];
                filteredOrders = [];
                displayOrders();
                updateOrderStatistics();
                hideLoading('ordersTableBody');
                showNotification('L·ªói khi t·∫£i danh s√°ch ƒë∆°n h√†ng', 'error');
            }
        }

        // Load orders from Firebase
        async function loadOrdersFromFirebase() {
            try {
                if (!window.firebase || !window.firebase.database) {
                    console.warn('Firebase not available, returning empty array');
                    return [];
                }
                
                const ordersRef = ref(window.firebase.database, 'orders');
                const snapshot = await get(ordersRef);
                
                if (snapshot.exists()) {
                    const ordersData = snapshot.val();
                    const ordersArray = Object.keys(ordersData).map(key => ({
                        id: key,
                        ...ordersData[key]
                    }));
                    console.log('Orders loaded from Firebase:', ordersArray.length, 'items');
                    return ordersArray;
                } else {
                    console.log('No orders found in Firebase');
                    return [];
                }
            } catch (error) {
                console.error('Error loading orders from Firebase:', error);
                return [];
            }
        }

        // Display Orders in Table
        function displayOrders() {
            const tbody = document.getElementById('ordersTableBody');
            const startIndex = (currentOrderPage - 1) * ordersPerPage;
            const endIndex = startIndex + ordersPerPage;
            const pageOrders = filteredOrders.slice(startIndex, endIndex);
            
            tbody.innerHTML = '';
            
            if (pageOrders.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="9" class="text-center py-4">
                            <div class="text-muted">
                                <i class="fas fa-inbox fa-3x mb-3"></i>
                                <p>Kh√¥ng c√≥ ƒë∆°n h√†ng n√†o</p>
                            </div>
                        </td>
                    </tr>
                `;
                return;
            }
            
            pageOrders.forEach(order => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <input type="checkbox" class="form-check-input order-checkbox" 
                               value="${order.id}" onchange="toggleOrderSelection('${order.id}')">
                    </td>
                    <td>
                        <strong class="text-primary">${order.id}</strong>
                    </td>
                    <td>
                        <div>
                            <div class="fw-bold">${order.customerName}</div>
                            <small class="text-muted">${order.customerEmail}</small>
                        </div>
                    </td>
                    <td>
                        <div class="text-truncate" style="max-width: 200px;" title="${order.items.map(item => item.productName).join(', ')}">
                            ${order.items.map(item => item.productName).join(', ')}
                        </div>
                    </td>
                    <td>
                        <span class="fw-bold text-success">${formatCurrency(order.totalAmount)}</span>
                    </td>
                    <td>
                        <span class="badge bg-info">${getPaymentMethodLabel(order.paymentMethod)}</span>
                    </td>
                    <td>
                        ${getOrderStatusBadge(order.status)}
                    </td>
                    <td>
                        <small>${formatDate(order.orderDate)}</small>
                    </td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" onclick="viewOrderDetails('${order.id}')" 
                                    title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning" onclick="editOrder('${order.id}')" 
                                    title="Ch·ªânh s·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-success" onclick="updateOrderStatus('${order.id}')" 
                                    title="C·∫≠p nh·∫≠t tr·∫°ng th√°i">
                                <i class="fas fa-check"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
            
            updateOrderPagination();
            updateSelectedOrderCount();
        }

        // Get Order Status Badge
        function getOrderStatusBadge(status) {
            const statusConfig = {
                'pending': { class: 'bg-warning', text: 'Ch·ªù x·ª≠ l√Ω', icon: 'clock' },
                'processing': { class: 'bg-info', text: 'ƒêang x·ª≠ l√Ω', icon: 'cog' },
                'shipping': { class: 'bg-primary', text: 'ƒêang giao', icon: 'truck' },
                'delivered': { class: 'bg-success', text: 'ƒê√£ giao', icon: 'check' },
                'completed': { class: 'bg-success', text: 'Ho√†n th√†nh', icon: 'check-circle' },
                'cancelled': { class: 'bg-danger', text: 'ƒê√£ h·ªßy', icon: 'times' },
                'returned': { class: 'bg-secondary', text: 'ƒê√£ tr·∫£', icon: 'undo' }
            };
            
            const config = statusConfig[status] || statusConfig['pending'];
            return `<span class="badge ${config.class}">
                        <i class="fas fa-${config.icon} me-1"></i>${config.text}
                    </span>`;
        }

        // Get Payment Method Label
        function getPaymentMethodLabel(method) {
            const labels = {
                'cash': 'Ti·ªÅn m·∫∑t',
                'bank_transfer': 'Chuy·ªÉn kho·∫£n',
                'credit_card': 'Th·∫ª t√≠n d·ª•ng',
                'vnpay': 'VNPay',
                'momo': 'MoMo'
            };
            return labels[method] || method;
        }

        // Update Order Statistics
        function updateOrderStatistics() {
            document.getElementById('totalOrdersCount').textContent = orders.length;
            document.getElementById('pendingOrdersCount').textContent = orders.filter(o => o.status === 'pending').length;
            document.getElementById('shippingOrdersCount').textContent = orders.filter(o => o.status === 'shipping').length;
            document.getElementById('completedOrdersCount').textContent = orders.filter(o => o.status === 'completed').length;
            document.getElementById('filteredOrdersCount').textContent = filteredOrders.length;
        }

        // Order Selection Functions
        function toggleOrderSelection(orderId) {
            const index = selectedOrders.indexOf(orderId);
            if (index > -1) {
                selectedOrders.splice(index, 1);
            } else {
                selectedOrders.push(orderId);
            }
            updateSelectedOrderCount();
            updateSelectAllCheckbox();
        }

        function toggleSelectAllOrders() {
            const checkboxes = document.querySelectorAll('.order-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllOrders');
            const headerCheckbox = document.getElementById('orderHeaderCheckbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAllCheckbox.checked;
                if (selectAllCheckbox.checked) {
                    if (!selectedOrders.includes(checkbox.value)) {
                        selectedOrders.push(checkbox.value);
                    }
                } else {
                    const index = selectedOrders.indexOf(checkbox.value);
                    if (index > -1) {
                        selectedOrders.splice(index, 1);
                    }
                }
            });
            
            headerCheckbox.checked = selectAllCheckbox.checked;
            updateSelectedOrderCount();
        }

        function updateSelectAllCheckbox() {
            const checkboxes = document.querySelectorAll('.order-checkbox');
            const selectAllCheckbox = document.getElementById('selectAllOrders');
            const headerCheckbox = document.getElementById('orderHeaderCheckbox');
            
            const allChecked = checkboxes.length > 0 && Array.from(checkboxes).every(cb => cb.checked);
            selectAllCheckbox.checked = allChecked;
            headerCheckbox.checked = allChecked;
        }

        function updateSelectedOrderCount() {
            document.getElementById('selectedOrderCount').textContent = selectedOrders.length;
        }

        // Order Filtering Functions
        function applyOrderFilters() {
            const searchTerm = document.getElementById('searchOrder').value.toLowerCase();
            const statusFilter = document.getElementById('orderStatusFilter').value;
            const dateFilter = document.getElementById('orderDateFilter').value;
            const paymentFilter = document.getElementById('orderPaymentFilter').value;
            
            filteredOrders = orders.filter(order => {
                // Search filter
                const matchesSearch = !searchTerm || 
                    order.id.toLowerCase().includes(searchTerm) ||
                    order.customerName.toLowerCase().includes(searchTerm) ||
                    order.customerEmail.toLowerCase().includes(searchTerm);
                
                // Status filter
                const matchesStatus = !statusFilter || order.status === statusFilter;
                
                // Date filter
                let matchesDate = true;
                if (dateFilter) {
                    const orderDate = new Date(order.orderDate);
                    const today = new Date();
                    
                    switch (dateFilter) {
                        case 'today':
                            matchesDate = orderDate.toDateString() === today.toDateString();
                            break;
                        case 'yesterday':
                            const yesterday = new Date(today);
                            yesterday.setDate(yesterday.getDate() - 1);
                            matchesDate = orderDate.toDateString() === yesterday.toDateString();
                            break;
                        case 'week':
                            const weekAgo = new Date(today);
                            weekAgo.setDate(weekAgo.getDate() - 7);
                            matchesDate = orderDate >= weekAgo;
                            break;
                        case 'month':
                            const monthAgo = new Date(today);
                            monthAgo.setMonth(monthAgo.getMonth() - 1);
                            matchesDate = orderDate >= monthAgo;
                            break;
                    }
                }
                
                // Payment filter
                const matchesPayment = !paymentFilter || order.paymentMethod === paymentFilter;
                
                return matchesSearch && matchesStatus && matchesDate && matchesPayment;
            });
            
            currentOrderPage = 1;
            displayOrders();
            updateOrderStatistics();
        }

        function resetOrderFilters() {
            document.getElementById('searchOrder').value = '';
            document.getElementById('orderStatusFilter').value = '';
            document.getElementById('orderDateFilter').value = '';
            document.getElementById('orderPaymentFilter').value = '';
            
            filteredOrders = [...orders];
            currentOrderPage = 1;
            displayOrders();
            updateOrderStatistics();
        }

        // Order Pagination
        function updateOrderPagination() {
            const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
            const pagination = document.getElementById('orderPagination');
            
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }
            
            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentOrderPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeOrderPage(${currentOrderPage - 1})">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentOrderPage - 2 && i <= currentOrderPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentOrderPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changeOrderPage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentOrderPage - 3 || i === currentOrderPage + 3) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${currentOrderPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeOrderPage(${currentOrderPage + 1})">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        function changeOrderPage(page) {
            const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
            if (page >= 1 && page <= totalPages) {
                currentOrderPage = page;
                displayOrders();
            }
        }

        // Order Details Functions
        function viewOrderDetails(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Populate customer info
            document.getElementById('customerInfo').innerHTML = `
                <div class="mb-2"><strong>T√™n:</strong> ${order.customerName}</div>
                <div class="mb-2"><strong>Email:</strong> ${order.customerEmail}</div>
                <div class="mb-2"><strong>S·ªë ƒëi·ªán tho·∫°i:</strong> ${order.customerPhone}</div>
                <div class="mb-2"><strong>ƒê·ªãa ch·ªâ:</strong> ${order.shippingAddress}</div>
            `;
            
            // Populate order info
            document.getElementById('orderInfo').innerHTML = `
                <div class="mb-2"><strong>M√£ ƒë∆°n h√†ng:</strong> ${order.id}</div>
                <div class="mb-2"><strong>Ng√†y ƒë·∫∑t:</strong> ${formatDate(order.orderDate)}</div>
                <div class="mb-2"><strong>Tr·∫°ng th√°i:</strong> ${getOrderStatusBadge(order.status)}</div>
                <div class="mb-2"><strong>Ph∆∞∆°ng th·ª©c TT:</strong> ${getPaymentMethodLabel(order.paymentMethod)}</div>
                <div class="mb-2"><strong>Tr·∫°ng th√°i TT:</strong> ${getPaymentStatusBadge(order.paymentStatus)}</div>
                <div class="mb-2"><strong>T·ªïng ti·ªÅn:</strong> <span class="text-success fw-bold">${formatCurrency(order.totalAmount)}</span></div>
            `;
            
            // Populate order items
            const itemsTbody = document.getElementById('orderItemsTableBody');
            itemsTbody.innerHTML = order.items.map(item => `
                <tr>
                    <td>${item.productName}</td>
                    <td>${formatCurrency(item.price)}</td>
                    <td>${item.quantity}</td>
                    <td>${formatCurrency(item.price * item.quantity)}</td>
                </tr>
            `).join('');
            
            // Populate shipping info
            document.getElementById('shippingInfo').innerHTML = `
                <div class="mb-2"><strong>Ph∆∞∆°ng th·ª©c:</strong> ${getShippingMethodLabel(order.shippingMethod)}</div>
                <div class="mb-2"><strong>ƒê·ªãa ch·ªâ:</strong> ${order.shippingAddress}</div>
                ${order.trackingNumber ? `<div class="mb-2"><strong>M√£ v·∫≠n ƒë∆°n:</strong> ${order.trackingNumber}</div>` : ''}
                ${order.estimatedDelivery ? `<div class="mb-2"><strong>Ng√†y giao d·ª± ki·∫øn:</strong> ${formatDate(order.estimatedDelivery)}</div>` : ''}
            `;
            
            // Populate payment info
            document.getElementById('paymentInfo').innerHTML = `
                <div class="mb-2"><strong>Ph∆∞∆°ng th·ª©c:</strong> ${getPaymentMethodLabel(order.paymentMethod)}</div>
                <div class="mb-2"><strong>Tr·∫°ng th√°i:</strong> ${getPaymentStatusBadge(order.paymentStatus)}</div>
                <div class="mb-2"><strong>S·ªë ti·ªÅn:</strong> ${formatCurrency(order.totalAmount)}</div>
            `;
            
            // Populate order history
            document.getElementById('orderHistory').innerHTML = order.history.map(entry => `
                <div class="border-start border-primary ps-3 mb-2">
                    <div class="d-flex justify-content-between">
                        <span class="fw-bold">${getOrderStatusLabel(entry.status)}</span>
                        <small class="text-muted">${formatDate(entry.date)}</small>
                    </div>
                    <div class="text-muted">${entry.note}</div>
                    <small class="text-muted">B·ªüi: ${entry.admin}</small>
                </div>
            `).join('');
            
            // Store current order for editing
            window.currentOrder = order;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('orderDetailsModal'));
            modal.show();
        }

        // Helper Functions
        function getPaymentStatusBadge(status) {
            const statusConfig = {
                'pending': { class: 'bg-warning', text: 'Ch·ªù thanh to√°n' },
                'paid': { class: 'bg-success', text: 'ƒê√£ thanh to√°n' },
                'failed': { class: 'bg-danger', text: 'Thanh to√°n th·∫•t b·∫°i' },
                'refunded': { class: 'bg-info', text: 'ƒê√£ ho√†n ti·ªÅn' }
            };
            
            const config = statusConfig[status] || statusConfig['pending'];
            return `<span class="badge ${config.class}">${config.text}</span>`;
        }

        function getShippingMethodLabel(method) {
            const labels = {
                'standard': 'Giao h√†ng ti√™u chu·∫©n',
                'express': 'Giao h√†ng nhanh',
                'pickup': 'Nh·∫≠n t·∫°i c·ª≠a h√†ng'
            };
            return labels[method] || method;
        }

        function getOrderStatusLabel(status) {
            const labels = {
                'pending': 'Ch·ªù x·ª≠ l√Ω',
                'processing': 'ƒêang x·ª≠ l√Ω',
                'shipping': 'ƒêang giao',
                'delivered': 'ƒê√£ giao',
                'completed': 'Ho√†n th√†nh',
                'cancelled': 'ƒê√£ h·ªßy',
                'returned': 'ƒê√£ tr·∫£'
            };
            return labels[status] || status;
        }

        // Setup Event Listeners
        function setupOrderEventListeners() {
            // Search input
            document.getElementById('searchOrder').addEventListener('input', debounce(applyOrderFilters, 300));
            
            // Filter selects
            document.getElementById('orderStatusFilter').addEventListener('change', applyOrderFilters);
            document.getElementById('orderDateFilter').addEventListener('change', applyOrderFilters);
            document.getElementById('orderPaymentFilter').addEventListener('change', applyOrderFilters);
            
            // Save order changes button
            document.getElementById('saveOrderChangesBtn').addEventListener('click', saveOrderChanges);
            
            // Bulk update button
            document.getElementById('confirmBulkUpdateBtn').addEventListener('click', confirmBulkUpdate);
            
            // Status update button
            document.getElementById('confirmStatusUpdateBtn').addEventListener('click', confirmStatusUpdate);
        }

        // Debounce function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Edit Order Functions
        function editOrder(orderId) {
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Populate edit form
            document.getElementById('editOrderStatus').value = order.status;
            document.getElementById('editOrderPaymentStatus').value = order.paymentStatus;
            document.getElementById('editOrderShippingMethod').value = order.shippingMethod;
            document.getElementById('editOrderTrackingNumber').value = order.trackingNumber || '';
            document.getElementById('editOrderEstimatedDelivery').value = order.estimatedDelivery ? formatDateForInput(order.estimatedDelivery) : '';
            document.getElementById('editOrderNotes').value = order.notes || '';
            
            // Store current order for editing
            window.currentOrder = order;
            
            // Close details modal and open edit modal
            const detailsModal = bootstrap.Modal.getInstance(document.getElementById('orderDetailsModal'));
            if (detailsModal) detailsModal.hide();
            
            const editModal = new bootstrap.Modal(document.getElementById('editOrderModal'));
            editModal.show();
        }

        function openEditOrderModal() {
            if (!window.currentOrder) return;
            editOrder(window.currentOrder.id);
        }

        function saveOrderChanges() {
            if (!window.currentOrder) return;
            
            const orderId = window.currentOrder.id;
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            // Get form values
            const newStatus = document.getElementById('editOrderStatus').value;
            const newPaymentStatus = document.getElementById('editOrderPaymentStatus').value;
            const newShippingMethod = document.getElementById('editOrderShippingMethod').value;
            const newTrackingNumber = document.getElementById('editOrderTrackingNumber').value;
            const newEstimatedDelivery = document.getElementById('editOrderEstimatedDelivery').value;
            const newNotes = document.getElementById('editOrderNotes').value;
            
            // Validate required fields
            if (!newStatus) {
                showNotification('Vui l√≤ng ch·ªçn tr·∫°ng th√°i ƒë∆°n h√†ng', 'error');
                return;
            }
            
            try {
                // Update order
                order.status = newStatus;
                order.paymentStatus = newPaymentStatus;
                order.shippingMethod = newShippingMethod;
                order.trackingNumber = newTrackingNumber;
                order.estimatedDelivery = newEstimatedDelivery ? new Date(newEstimatedDelivery) : null;
                order.notes = newNotes;
                
                // Add to history
                order.history.push({
                    date: new Date(),
                    status: newStatus,
                    note: `C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh: ${getOrderStatusLabel(newStatus)}`,
                    admin: 'Admin'
                });
                
                // Update in Firebase (replace with actual Firebase update)
                console.log('Updating order:', order);
                
                // Refresh display
                displayOrders();
                updateOrderStatistics();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('editOrderModal'));
                if (modal) modal.hide();
                
                showNotification('C·∫≠p nh·∫≠t ƒë∆°n h√†ng th√†nh c√¥ng!', 'success');
                
            } catch (error) {
                console.error('Error updating order:', error);
                showNotification('L·ªói khi c·∫≠p nh·∫≠t ƒë∆°n h√†ng', 'error');
            }
        }

        // Order Status Update Functions
        function updateOrderStatus(orderId = null) {
            const targetOrderId = orderId || (window.currentOrder ? window.currentOrder.id : null);
            if (!targetOrderId) return;
            
            const order = orders.find(o => o.id === targetOrderId);
            if (!order) return;
            
            // Set current status
            document.getElementById('orderStatusUpdate').value = order.status;
            document.getElementById('orderStatusNotes').value = '';
            document.getElementById('sendCustomerNotification').checked = true;
            
            // Store current order
            window.currentOrder = order;
            
            // Close other modals if open
            const detailsModal = bootstrap.Modal.getInstance(document.getElementById('orderDetailsModal'));
            if (detailsModal) detailsModal.hide();
            
            const editModal = bootstrap.Modal.getInstance(document.getElementById('editOrderModal'));
            if (editModal) editModal.hide();
            
            // Show status update modal
            const statusModal = new bootstrap.Modal(document.getElementById('orderStatusUpdateModal'));
            statusModal.show();
        }

        function confirmStatusUpdate() {
            if (!window.currentOrder) return;
            
            const orderId = window.currentOrder.id;
            const order = orders.find(o => o.id === orderId);
            if (!order) return;
            
            const newStatus = document.getElementById('orderStatusUpdate').value;
            const notes = document.getElementById('orderStatusNotes').value;
            const sendNotification = document.getElementById('sendCustomerNotification').checked;
            
            if (!newStatus) {
                showNotification('Vui l√≤ng ch·ªçn tr·∫°ng th√°i m·ªõi', 'error');
                return;
            }
            
            try {
                // Update order status
                order.status = newStatus;
                
                // Add to history
                order.history.push({
                    date: new Date(),
                    status: newStatus,
                    note: notes || `C·∫≠p nh·∫≠t tr·∫°ng th√°i th√†nh: ${getOrderStatusLabel(newStatus)}`,
                    admin: 'Admin'
                });
                
                // Update in Firebase (replace with actual Firebase update)
                console.log('Updating order status:', order);
                
                // Send customer notification if requested
                if (sendNotification) {
                    sendOrderStatusNotification(order, newStatus);
                }
                
                // Refresh display
                displayOrders();
                updateOrderStatistics();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('orderStatusUpdateModal'));
                if (modal) modal.hide();
                
                showNotification('C·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng th√†nh c√¥ng!', 'success');
                
            } catch (error) {
                console.error('Error updating order status:', error);
                showNotification('L·ªói khi c·∫≠p nh·∫≠t tr·∫°ng th√°i ƒë∆°n h√†ng', 'error');
            }
        }

        // Bulk Order Update Functions
        function openBulkOrderUpdateModal() {
            if (selectedOrders.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt ƒë∆°n h√†ng ƒë·ªÉ c·∫≠p nh·∫≠t', 'warning');
                return;
            }
            
            // Update selected count
            document.getElementById('selectedOrdersCount').textContent = selectedOrders.length;
            
            // Reset form
            document.getElementById('bulkOrderStatus').value = '';
            document.getElementById('bulkOrderNotes').value = '';
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('bulkOrderUpdateModal'));
            modal.show();
        }

        function confirmBulkUpdate() {
            if (selectedOrders.length === 0) return;
            
            const newStatus = document.getElementById('bulkOrderStatus').value;
            const notes = document.getElementById('bulkOrderNotes').value;
            
            if (!newStatus) {
                showNotification('Vui l√≤ng ch·ªçn tr·∫°ng th√°i m·ªõi', 'error');
                return;
            }
            
            try {
                let updatedCount = 0;
                
                // Update each selected order
                selectedOrders.forEach(orderId => {
                    const order = orders.find(o => o.id === orderId);
                    if (order) {
                        order.status = newStatus;
                        order.history.push({
                            date: new Date(),
                            status: newStatus,
                            note: notes || `C·∫≠p nh·∫≠t h√†ng lo·∫°t th√†nh: ${getOrderStatusLabel(newStatus)}`,
                            admin: 'Admin'
                        });
                        updatedCount++;
                    }
                });
                
                // Update in Firebase (replace with actual Firebase batch update)
                console.log('Bulk updating orders:', selectedOrders);
                
                // Clear selection
                selectedOrders = [];
                document.querySelectorAll('.order-checkbox').forEach(cb => cb.checked = false);
                document.getElementById('selectAllOrders').checked = false;
                document.getElementById('orderHeaderCheckbox').checked = false;
                
                // Refresh display
                displayOrders();
                updateOrderStatistics();
                updateSelectedOrderCount();
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('bulkOrderUpdateModal'));
                if (modal) modal.hide();
                
                showNotification(`C·∫≠p nh·∫≠t th√†nh c√¥ng ${updatedCount} ƒë∆°n h√†ng!`, 'success');
                
            } catch (error) {
                console.error('Error bulk updating orders:', error);
                showNotification('L·ªói khi c·∫≠p nh·∫≠t h√†ng lo·∫°t ƒë∆°n h√†ng', 'error');
            }
        }

        // Export Orders Function
        function exportOrders() {
            try {
                // Prepare data for export
                const exportData = filteredOrders.map(order => ({
                    'M√£ ƒë∆°n h√†ng': order.id,
                    'Kh√°ch h√†ng': order.customerName,
                    'Email': order.customerEmail,
                    'S·ªë ƒëi·ªán tho·∫°i': order.customerPhone,
                    'S·∫£n ph·∫©m': order.items.map(item => item.productName).join(', '),
                    'T·ªïng ti·ªÅn': order.totalAmount,
                    'Ph∆∞∆°ng th·ª©c TT': getPaymentMethodLabel(order.paymentMethod),
                    'Tr·∫°ng th√°i TT': getPaymentStatusBadge(order.paymentStatus).replace(/<[^>]*>/g, ''),
                    'Tr·∫°ng th√°i': getOrderStatusLabel(order.status),
                    'Ng√†y ƒë·∫∑t': formatDate(order.orderDate),
                    'ƒê·ªãa ch·ªâ giao h√†ng': order.shippingAddress,
                    'Ghi ch√∫': order.notes || ''
                }));
                
                // Convert to CSV
                const csvContent = convertToCSV(exportData);
                
                // Download file
                downloadCSV(csvContent, `don-hang-${formatDateForFilename(new Date())}.csv`);
                
                showNotification('Xu·∫•t b√°o c√°o th√†nh c√¥ng!', 'success');
                
            } catch (error) {
                console.error('Error exporting orders:', error);
                showNotification('L·ªói khi xu·∫•t b√°o c√°o', 'error');
            }
        }

        // Helper Functions for Export
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            data.forEach(row => {
                const values = headers.map(header => {
                    const value = row[header];
                    // Escape commas and quotes
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"'))) {
                        return `"${value.replace(/"/g, '""')}"`;
                    }
                    return value;
                });
                csvRows.push(values.join(','));
            });
            
            return csvRows.join('\n');
        }

        function downloadCSV(content, filename) {
            const blob = new Blob(['\ufeff' + content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', filename);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }

        function formatDateForFilename(date) {
            return date.toISOString().split('T')[0];
        }

        function formatDateForInput(date) {
            return date.toISOString().split('T')[0];
        }

        // Customer Notification Function
        function sendOrderStatusNotification(order, newStatus) {
            // This would integrate with your notification system
            // For now, just log the notification
            console.log(`Sending notification to customer ${order.customerEmail} about order ${order.id} status change to ${newStatus}`);
            
            // You could integrate with:
            // - Email service (SendGrid, Mailgun, etc.)
            // - SMS service (Twilio, etc.)
            // - Push notifications
            // - In-app notifications
        }

        // Initialize Order Management when page loads
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize order management if we're on the orders tab
            if (document.getElementById('orderManagementContent')) {
                initOrderManagement();
            }
        });

        // Render orders table
        function renderOrdersTable() {
            const tbody = document.getElementById('ordersTableBody');
            if (!tbody) {
                console.error('ordersTableBody not found');
                return;
            }
            
            const startIndex = (currentOrderPage - 1) * ordersPerPage;
            const endIndex = startIndex + ordersPerPage;
            const ordersToShow = filteredOrders.slice(startIndex, endIndex);
            
            if (ordersToShow.length === 0) {
                tbody.innerHTML = `
                    <tr>
                        <td colspan="10" class="text-center py-4">
                            <i class="fas fa-shopping-cart fa-3x text-muted mb-3"></i>
                            <p class="text-muted">Kh√¥ng t√¨m th·∫•y ƒë∆°n h√†ng n√†o</p>
                        </td>
                    </tr>
                `;
                const pagination = document.getElementById('orderPagination');
                if (pagination) pagination.innerHTML = '';
                return;
            }

            tbody.innerHTML = ordersToShow.map(order => `
                <tr>
                    <td>
                        <input type="checkbox" class="form-check-input order-checkbox" value="${order.id}" onchange="updateSelectedOrderCount()">
                    </td>
                    <td><strong>${order.id}</strong></td>
                    <td>
                        <div class="order-customer">
                            <div class="customer-name">${order.customerName}</div>
                            <div class="customer-email text-muted">${order.customerEmail}</div>
                            <div class="customer-phone text-muted">${order.customerPhone}</div>
                        </div>
                    </td>
                    <td>
                        <div class="order-items">
                            ${order.items.map(item => `
                                <div class="order-item">
                                    <span class="item-name">${item.productName}</span>
                                    <span class="item-quantity badge bg-secondary">x${item.quantity}</span>
                                </div>
                            `).join('')}
                        </div>
                    </td>
                    <td><strong>${formatPrice(order.totalAmount)}</strong></td>
                    <td>
                        <span class="badge bg-${getPaymentStatusColor(order.paymentStatus)}">
                            ${getPaymentStatusLabel(order.paymentStatus)}
                        </span>
                    </td>
                    <td>
                        <span class="badge bg-${getOrderStatusColor(order.status)}">
                            ${getOrderStatusLabel(order.status)}
                        </span>
                    </td>
                    <td>${formatDate(order.orderDate)}</td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-info" onclick="viewOrderDetails('${order.id}')" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning" onclick="editOrder('${order.id}')" title="Ch·ªânh s·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-primary" onclick="updateOrderStatus('${order.id}')" title="C·∫≠p nh·∫≠t tr·∫°ng th√°i">
                                <i class="fas fa-sync-alt"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            renderOrderPagination();
            updateSelectedOrderCount();
        }

        function renderOrderPagination() {
            const totalPages = Math.ceil(filteredOrders.length / ordersPerPage);
            const pagination = document.getElementById('orderPagination');
            
            if (!pagination || totalPages <= 1) {
                if (pagination) pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentOrderPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeOrderPage(${currentOrderPage - 1})">Tr∆∞·ªõc</a>
                </li>
            `;
            
            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentOrderPage - 2 && i <= currentOrderPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentOrderPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changeOrderPage(${i})">${i}</a>
                        </li>
                    `;
                } else if (i === currentOrderPage - 3 || i === currentOrderPage + 3) {
                    paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                }
            }
            
            // Next button
            paginationHTML += `
                <li class="page-item ${currentOrderPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeOrderPage(${currentOrderPage + 1})">Sau</a>
                </li>
            `;
            
            pagination.innerHTML = paginationHTML;
        }

        // ========================================
        // STORY MANAGEMENT FUNCTIONS
        // ========================================

        // Global variables for story management
        let currentStories = [];
        let filteredStories = [];
        let editingStoryId = null;
        let selectedStoryIds = [];

        // Load stories from Firebase
        async function loadStoriesFromFirebase() {
            try {
                if (!window.firebase || !window.firebase.database) {
                    console.warn('Firebase not available, returning empty array');
                    return [];
                }
                
                const storiesRef = ref(window.firebase.database, 'Stories');
                const snapshot = await get(storiesRef);
                
                if (snapshot.exists()) {
                    const storiesData = snapshot.val();
                    const storiesArray = Object.keys(storiesData).map(key => ({
                        id: key,
                        ...storiesData[key]
                    }));
                    console.log('Stories loaded from Firebase:', storiesArray.length, 'items');
                    return storiesArray;
                } else {
                    console.log('No stories found in Firebase');
                    return [];
                }
            } catch (error) {
                console.error('Error loading stories from Firebase:', error);
                return [];
            }
        }

        // Story Management Functions
        function showStoryManagement() {
            hideAllContent();
            document.getElementById('storyManagementContent').style.display = 'block';
            
            // Update sidebar active state
            document.querySelectorAll('#sidebar .nav-link').forEach(link => link.classList.remove('active'));
            document.querySelector('#sidebar .nav-link[onclick="showStoryManagement()"]').classList.add('active');
            
            // Initialize stories if not already done
            if (currentStories.length === 0) {
                console.log('No stories available');
                return;
            }
            renderStoriesTable();
            updateStoryStats();
        }

        function hideAllContent() {
            const contents = [
                'dashboardContent',
                'bookManagementContent',
                'memberManagementContent',
                'orderManagementContent',
                'storyManagementContent',
                'authorManagementContent',
                'newsManagementContent'
            ];
            
            contents.forEach(contentId => {
                const element = document.getElementById(contentId);
                if (element) {
                    element.style.display = 'none';
                }
            });
        }

        // Update active navigation link
        function updateActiveNavLink(activeSection) {
            // Remove active class from all nav links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            
            // Add active class to current section
            const activeLink = document.querySelector(`[onclick*="${activeSection}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }
        }

        function renderStoriesTable() {
            const tbody = document.getElementById('storiesTableBody');
            if (!tbody) return;

            tbody.innerHTML = '';
            
            filteredStories.forEach(story => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <div class="form-check">
                            <input class="form-check-input story-checkbox" type="checkbox" value="${story.id}" onchange="updateStorySelection()">
                        </div>
                    </td>
                    <td>
                        <div class="d-flex align-items-center">
                            <img src="${story.image}" alt="${story.title}" class="rounded me-2" style="width: 40px; height: 50px; object-fit: cover;">
                            <div>
                                <div class="fw-bold text-primary">${story.title}</div>
                                <small class="text-muted">ID: ${story.id}</small>
                            </div>
                        </div>
                    </td>
                    <td>${story.author}</td>
                    <td>
                        <span class="badge bg-primary">${getCategoryLabel(story.category)}</span>
                    </td>
                    <td>
                        <span class="badge ${getStatusBadgeClass(story.status)}">${getStatusLabel(story.status)}</span>
                    </td>
                    <td>${story.currentChapters}/${story.totalChapters || '?'}</td>
                    <td>
                        <div class="d-flex align-items-center">
                            ${generateStarRating(story.rating)}
                            <small class="text-muted ms-1">(${story.rating})</small>
                        </div>
                    </td>
                    <td>${formatNumber(story.totalViews)}</td>
                    <td>${formatDate(story.publishDate)}</td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button type="button" class="btn btn-outline-primary" onclick="viewStoryDetails('${story.id}')" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button type="button" class="btn btn-outline-warning" onclick="editStory('${story.id}')" title="Ch·ªânh s·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button type="button" class="btn btn-outline-danger" onclick="deleteStory('${story.id}')" title="X√≥a">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(row);
            });
        }

        function updateStoryStats() {
            const totalStories = currentStories.length;
            const ongoingStories = currentStories.filter(s => s.status === 'ongoing').length;
            const completedStories = currentStories.filter(s => s.status === 'completed').length;
            const totalChapters = currentStories.reduce((sum, s) => sum + s.currentChapters, 0);
            const totalViews = currentStories.reduce((sum, s) => sum + s.totalViews, 0);

            document.getElementById('totalStories').textContent = totalStories;
            document.getElementById('ongoingStories').textContent = ongoingStories;
            document.getElementById('completedStories').textContent = completedStories;
            document.getElementById('totalChapters').textContent = totalChapters;
            document.getElementById('totalViews').textContent = formatNumber(totalViews);
        }

        function getCategoryLabel(category) {
            const categories = {
                'tien-hiep': 'Ti√™n hi·ªáp',
                'kiem-hiep': 'Ki·∫øm hi·ªáp',
                'ngon-tinh': 'Ng√¥n t√¨nh',
                'truyen-teen': 'Truy·ªán teen',
                'truyen-kinh-di': 'Kinh d·ªã',
                'truyen-hai': 'H√†i h∆∞·ªõc',
                'truyen-doi': 'ƒê·ªùi th∆∞·ªùng',
                'khac': 'Kh√°c'
            };
            return categories[category] || category;
        }

        function getStatusLabel(status) {
            const statuses = {
                'ongoing': 'ƒêang c·∫≠p nh·∫≠t',
                'completed': 'Ho√†n th√†nh',
                'paused': 'T·∫°m d·ª´ng',
                'cancelled': 'ƒê√£ h·ªßy'
            };
            return statuses[status] || status;
        }

        function getStatusBadgeClass(status) {
            const classes = {
                'ongoing': 'bg-success',
                'completed': 'bg-primary',
                'paused': 'bg-warning',
                'cancelled': 'bg-danger'
            };
            return classes[status] || 'bg-secondary';
        }

        function generateStarRating(rating) {
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 !== 0;
            let stars = '';
            
            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star text-warning"></i>';
            }
            
            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt text-warning"></i>';
            }
            
            const emptyStars = 5 - Math.ceil(rating);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="fas fa-star text-muted"></i>';
            }
            
            return stars;
        }

        function formatNumber(num) {
            if (num >= 1000000) {
                return (num / 1000000).toFixed(1) + 'M';
            } else if (num >= 1000) {
                return (num / 1000).toFixed(1) + 'K';
            }
            return num.toString();
        }

        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const date = new Date(dateString);
            return date.toLocaleDateString('vi-VN');
        }

        // Story CRUD Operations
        function openAddStoryModal() {
            editingStoryId = null;
            document.getElementById('storyModalLabel').textContent = 'Th√™m truy·ªán m·ªõi';
            document.getElementById('storyForm').reset();
            document.getElementById('storyCurrentChapters').value = '0';
            document.getElementById('storyRating').value = '0';
            document.getElementById('storyLanguage').value = 'vietnamese';
            document.getElementById('storyIsAdult').value = 'false';
            
            const modal = new bootstrap.Modal(document.getElementById('storyModal'));
            modal.show();
        }

        function editStory(storyId) {
            const story = currentStories.find(s => s.id === storyId);
            if (!story) return;

            editingStoryId = storyId;
            document.getElementById('storyModalLabel').textContent = 'Ch·ªânh s·ª≠a truy·ªán';
            
            // Fill form with story data
            document.getElementById('storyTitle').value = story.title;
            document.getElementById('storyAuthor').value = story.author;
            document.getElementById('storyCategory').value = story.category;
            document.getElementById('storyStatus').value = story.status;
            document.getElementById('storyTotalChapters').value = story.totalChapters || '';
            document.getElementById('storyCurrentChapters').value = story.currentChapters;
            document.getElementById('storyRating').value = story.rating;
            document.getElementById('storyTags').value = story.tags;
            document.getElementById('storyLanguage').value = story.language;
            document.getElementById('storyDescription').value = story.description;
            document.getElementById('storySource').value = story.source || '';
            document.getElementById('storyPublishDate').value = story.publishDate || '';
            document.getElementById('storyUpdateFrequency').value = story.updateFrequency || '';
            document.getElementById('storyIsAdult').value = story.isAdult.toString();

            const modal = new bootstrap.Modal(document.getElementById('storyModal'));
            modal.show();
        }

        function saveStory() {
            const form = document.getElementById('storyForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const storyData = {
                title: document.getElementById('storyTitle').value,
                author: document.getElementById('storyAuthor').value,
                category: document.getElementById('storyCategory').value,
                status: document.getElementById('storyStatus').value,
                totalChapters: parseInt(document.getElementById('storyTotalChapters').value) || null,
                currentChapters: parseInt(document.getElementById('storyCurrentChapters').value) || 0,
                rating: parseFloat(document.getElementById('storyRating').value) || 0,
                tags: document.getElementById('storyTags').value,
                language: document.getElementById('storyLanguage').value,
                description: document.getElementById('storyDescription').value,
                source: document.getElementById('storySource').value,
                publishDate: document.getElementById('storyPublishDate').value,
                updateFrequency: document.getElementById('storyUpdateFrequency').value,
                isAdult: document.getElementById('storyIsAdult').value === 'true',
                totalViews: 0,
                completedChapters: parseInt(document.getElementById('storyCurrentChapters').value) || 0,
                pendingChapters: 0
            };

            if (editingStoryId) {
                // Update existing story
                const index = currentStories.findIndex(s => s.id === editingStoryId);
                if (index !== -1) {
                    storyData.id = editingStoryId;
                    storyData.image = currentStories[index].image;
                    storyData.totalViews = currentStories[index].totalViews;
                    currentStories[index] = storyData;
                    showNotification('C·∫≠p nh·∫≠t truy·ªán th√†nh c√¥ng!', 'success');
                }
            } else {
                // Add new story
                storyData.id = 'ST' + String(currentStories.length + 1).padStart(3, '0');
                storyData.image = 'images/books/placeholder.jpg';
                currentStories.push(storyData);
                showNotification('Th√™m truy·ªán th√†nh c√¥ng!', 'success');
            }

            // Update filtered stories and re-render
            filteredStories = [...currentStories];
            renderStoriesTable();
            updateStoryStats();

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('storyModal'));
            modal.hide();
        }

        function viewStoryDetails(storyId) {
            const story = currentStories.find(s => s.id === storyId);
            if (!story) return;

            // Fill modal with story details
            document.getElementById('storyDetailTitle').textContent = story.title;
            document.getElementById('storyDetailAuthor').textContent = story.author;
            document.getElementById('storyDetailCategory').textContent = getCategoryLabel(story.category);
            document.getElementById('storyDetailCategoryText').textContent = getCategoryLabel(story.category);
            document.getElementById('storyDetailStatus').textContent = getStatusLabel(story.status);
            document.getElementById('storyDetailStatusText').textContent = getStatusLabel(story.status);
            document.getElementById('storyDetailLanguage').textContent = story.language === 'vietnamese' ? 'Ti·∫øng Vi·ªát' : story.language;
            document.getElementById('storyDetailChapters').textContent = `${story.currentChapters}/${story.totalChapters || '?'}`;
            document.getElementById('storyDetailRating').textContent = story.rating + ' sao';
            document.getElementById('storyDetailReads').textContent = formatNumber(story.totalViews);
            document.getElementById('storyDetailPublishDate').textContent = formatDate(story.publishDate);
            document.getElementById('storyDetailDescription').textContent = story.description;
            document.getElementById('storyDetailTags').textContent = story.tags;
            document.getElementById('storyDetailSource').textContent = story.source || 'N/A';
            document.getElementById('storyDetailImage').src = story.image;

            // Update statistics
            document.getElementById('storyDetailTotalChapters').textContent = story.totalChapters || 0;
            document.getElementById('storyDetailCompletedChapters').textContent = story.currentChapters;
            document.getElementById('storyDetailPendingChapters').textContent = (story.totalChapters || 0) - story.currentChapters;
            document.getElementById('storyDetailTotalViews').textContent = formatNumber(story.totalViews);

            // Set badge classes
            const statusBadge = document.getElementById('storyDetailStatus');
            statusBadge.className = `badge fs-6 p-2 mb-2 ${getStatusBadgeClass(story.status)}`;

            const modal = new bootstrap.Modal(document.getElementById('storyDetailsModal'));
            modal.show();
        }

        function deleteStory(storyId) {
            const story = currentStories.find(s => s.id === storyId);
            if (!story) return;

            document.getElementById('deleteStoryTitle').textContent = story.title;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteStoryModal'));
            modal.show();
        }

        function confirmDeleteStory() {
            if (!editingStoryId) return;

            const index = currentStories.findIndex(s => s.id === editingStoryId);
            if (index !== -1) {
                currentStories.splice(index, 1);
                filteredStories = [...currentStories];
                renderStoriesTable();
                updateStoryStats();
                showNotification('X√≥a truy·ªán th√†nh c√¥ng!', 'success');
            }

            const modal = bootstrap.Modal.getInstance(document.getElementById('deleteStoryModal'));
            modal.hide();
        }

        // Story Search and Filter
        function searchStories() {
            const searchTerm = document.getElementById('searchStory').value.toLowerCase();
            filterStories(searchTerm);
        }

        function filterStories(searchTerm = '') {
            const categoryFilter = document.getElementById('storyCategoryFilter').value;
            const statusFilter = document.getElementById('storyStatusFilter').value;

            filteredStories = currentStories.filter(story => {
                const matchesSearch = !searchTerm || 
                    story.title.toLowerCase().includes(searchTerm) ||
                    story.author.toLowerCase().includes(searchTerm) ||
                    story.tags.toLowerCase().includes(searchTerm);

                const matchesCategory = !categoryFilter || story.category === categoryFilter;
                const matchesStatus = !statusFilter || story.status === statusFilter;

                return matchesSearch && matchesCategory && matchesStatus;
            });

            renderStoriesTable();
        }

        // Story Selection Management
        function updateStorySelection() {
            const checkboxes = document.querySelectorAll('.story-checkbox:checked');
            selectedStoryIds = Array.from(checkboxes).map(cb => cb.value);
            
            const selectedCount = document.getElementById('selectedStoriesCount');
            if (selectedCount) {
                selectedCount.textContent = selectedStoryIds.length;
            }
        }

        function toggleSelectAllStories() {
            const headerCheckbox = document.getElementById('selectAllStories');
            const storyCheckboxes = document.querySelectorAll('.story-checkbox');
            
            storyCheckboxes.forEach(checkbox => {
                checkbox.checked = headerCheckbox.checked;
            });
            
            updateStorySelection();
        }

        function openBulkStoryUpdateModal() {
            if (selectedStoryIds.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt truy·ªán!', 'warning');
                return;
            }

            document.getElementById('selectedStoriesCount').textContent = selectedStoryIds.length;
            
            const modal = new bootstrap.Modal(document.getElementById('bulkStoryUpdateModal'));
            modal.show();
        }

        function confirmBulkStoryUpdate() {
            const newStatus = document.getElementById('bulkStoryStatus').value;
            const newCategory = document.getElementById('bulkStoryCategory').value;
            const notes = document.getElementById('bulkStoryNotes').value;

            if (!newStatus && !newCategory) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt tr∆∞·ªùng ƒë·ªÉ c·∫≠p nh·∫≠t!', 'warning');
                return;
            }

            let updatedCount = 0;
            selectedStoryIds.forEach(storyId => {
                const story = currentStories.find(s => s.id === storyId);
                if (story) {
                    if (newStatus) story.status = newStatus;
                    if (newCategory) story.category = newCategory;
                    updatedCount++;
                }
            });

            if (updatedCount > 0) {
                filteredStories = [...currentStories];
                renderStoriesTable();
                updateStoryStats();
                showNotification(`ƒê√£ c·∫≠p nh·∫≠t ${updatedCount} truy·ªán th√†nh c√¥ng!`, 'success');
            }

            const modal = bootstrap.Modal.getInstance(document.getElementById('bulkStoryUpdateModal'));
            modal.hide();
        }

        function exportStories() {
            try {
                const exportData = filteredStories.map(story => ({
                    'M√£ truy·ªán': story.id,
                    'T√™n truy·ªán': story.title,
                    'T√°c gi·∫£': story.author,
                    'Th·ªÉ lo·∫°i': getCategoryLabel(story.category),
                    'Tr·∫°ng th√°i': getStatusLabel(story.status),
                    'S·ªë ch∆∞∆°ng hi·ªán t·∫°i': story.currentChapters,
                    'T·ªïng s·ªë ch∆∞∆°ng': story.totalChapters || 'N/A',
                    'ƒê√°nh gi√°': story.rating,
                    'L∆∞·ª£t xem': story.totalViews,
                    'Ng√¥n ng·ªØ': story.language === 'vietnamese' ? 'Ti·∫øng Vi·ªát' : story.language,
                    'Ng√†y b·∫Øt ƒë·∫ßu': formatDate(story.publishDate),
                    'Tags': story.tags,
                    'M√¥ t·∫£': story.description
                }));

                const csvContent = convertToCSV(exportData);
                downloadCSV(csvContent, `truyen-${formatDateForFilename(new Date())}.csv`);
                
                showNotification('Xu·∫•t b√°o c√°o truy·ªán th√†nh c√¥ng!', 'success');
            } catch (error) {
                console.error('Error exporting stories:', error);
                showNotification('L·ªói khi xu·∫•t b√°o c√°o truy·ªán', 'error');
            }
        }

        // Initialize story management event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Story form save button
            const saveStoryBtn = document.getElementById('saveStoryBtn');
            if (saveStoryBtn) {
                saveStoryBtn.addEventListener('click', saveStory);
            }

            // Story delete confirmation button
            const confirmDeleteStoryBtn = document.getElementById('confirmDeleteStoryBtn');
            if (confirmDeleteStoryBtn) {
                confirmDeleteStoryBtn.addEventListener('click', confirmDeleteStory);
            }

            // Bulk story update button
            const confirmBulkStoryUpdateBtn = document.getElementById('confirmBulkStoryUpdateBtn');
            if (confirmBulkStoryUpdateBtn) {
                confirmBulkStoryUpdateBtn.addEventListener('click', confirmBulkStoryUpdate);
            }

            // Edit story from details button
            const editStoryFromDetailsBtn = document.getElementById('editStoryFromDetailsBtn');
            if (editStoryFromDetailsBtn) {
                editStoryFromDetailsBtn.addEventListener('click', function() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('storyDetailsModal'));
                    modal.hide();
                    editStory(editingStoryId);
                });
            }
        });

        // Notification function for story management
        function showNotification(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        // ==================== NEWS MANAGEMENT FUNCTIONS ====================
        
        // Global variables for news management
        let currentNews = [];
        let filteredNews = [];
        let editingNewsId = null;
        let currentNewsPage = 1;
        const newsPerPage = 10;

        // Load news from Firebase
        async function loadNewsFromFirebase() {
            try {
                if (!window.firebase || !window.firebase.database) {
                    console.warn('Firebase not available, returning empty array');
                    return [];
                }
                
                const newsRef = ref(window.firebase.database, 'news');
                const snapshot = await get(newsRef);
                
                if (snapshot.exists()) {
                    const newsData = snapshot.val();
                    const newsArray = Object.keys(newsData).map(key => ({
                        id: key,
                        ...newsData[key]
                    }));
                    console.log('News loaded from Firebase:', newsArray.length, 'items');
                    return newsArray;
                } else {
                    console.log('No news found in Firebase');
                    return [];
                }
            } catch (error) {
                console.error('Error loading news from Firebase:', error);
                return [];
            }
        }

        // Initialize news management
        async function initNewsManagement() {
            try {
                // Try to load from Firebase first
                if (window.firebase && window.firebase.database) {
                    const firebaseNews = await loadNewsFromFirebase();
                    if (firebaseNews.length > 0) {
                        currentNews = firebaseNews;
                        console.log('News loaded from Firebase:', firebaseNews.length, 'items');
                                    } else {
                    // No news available from Firebase
                    currentNews = [];
                    console.log('No news available from Firebase');
                }
                } else {
                    // Firebase not available
                    currentNews = [];
                    console.log('Firebase not available for news');
                }
                
                filteredNews = [...currentNews];
                renderNewsTable();
                updateNewsStats();
            } catch (error) {
                console.error('Error initializing news management:', error);
                // Handle error gracefully
                currentNews = [];
                filteredNews = [];
                renderNewsTable();
                updateNewsStats();
            }
        }

        // Show news management content
        async function showNewsManagement() {
            hideAllContent();
            document.getElementById('newsManagementContent').style.display = 'block';
            updateActiveNavLink('news');
            
            if (currentNews.length === 0) {
                await initNewsManagement();
            }
        }

        // Render news table
        function renderNewsTable() {
            const tbody = document.getElementById('newsTableBody');
            if (!tbody) return;

            const startIndex = (currentNewsPage - 1) * newsPerPage;
            const endIndex = startIndex + newsPerPage;
            const pageNews = filteredNews.slice(startIndex, endIndex);

            tbody.innerHTML = pageNews.map(news => `
                <tr>
                    <td>
                        <input type="checkbox" class="form-check-input news-checkbox" value="${news.id}" onchange="updateSelectedNewsCount()">
                    </td>
                    <td><span class="badge bg-secondary">${news.id}</span></td>
                    <td>
                        <img src="${news.image}" alt="${news.title}" class="news-image" style="width: 50px; height: 40px; object-fit: cover; border-radius: 0.375rem;">
                    </td>
                    <td>
                        <div class="news-title">${news.title}</div>
                        <small class="text-muted">${news.content.substring(0, 100)}...</small>
                    </td>
                    <td><span class="badge bg-primary">${getNewsCategoryLabel(news.category)}</span></td>
                    <td>${news.author}</td>
                    <td><span class="badge ${getNewsStatusBadgeClass(news.status)}">${getNewsStatusLabel(news.status)}</span></td>
                    <td>${formatDate(news.publishDate)}</td>
                    <td>${formatNumber(news.views)}</td>
                    <td>
                        <div class="btn-group btn-group-sm" role="group">
                            <button class="btn btn-outline-primary" onclick="viewNewsDetails('${news.id}')" title="Xem chi ti·∫øt">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-warning" onclick="editNews('${news.id}')" title="Ch·ªânh s·ª≠a">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteNews('${news.id}')" title="X√≥a">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                </tr>
            `).join('');

            renderNewsPagination();
            updateFilteredNewsCount();
        }

        // Update news statistics
        function updateNewsStats() {
            document.getElementById('totalNewsCount').textContent = currentNews.length;
            document.getElementById('publishedNewsCount').textContent = currentNews.filter(n => n.status === 'published').length;
            document.getElementById('pendingNewsCount').textContent = currentNews.filter(n => n.status === 'draft' || n.status === 'pending').length;
            document.getElementById('totalNewsViews').textContent = formatNumber(currentNews.reduce((sum, n) => sum + n.views, 0));
        }

        // Get news category label
        function getNewsCategoryLabel(category) {
            const labels = {
                'tin-tuc': 'Tin t·ª©c',
                'su-kien': 'S·ª± ki·ªán',
                'khuyen-mai': 'Khuy·∫øn m√£i',
                'gioi-thieu': 'Gi·ªõi thi·ªáu',
                'huong-dan': 'H∆∞·ªõng d·∫´n',
                'khac': 'Kh√°c'
            };
            return labels[category] || category;
        }

        // Get news status label
        function getNewsStatusLabel(status) {
            const labels = {
                'published': 'ƒê√£ xu·∫•t b·∫£n',
                'draft': 'B·∫£n nh√°p',
                'pending': 'Ch·ªù duy·ªát',
                'archived': 'ƒê√£ l∆∞u tr·ªØ'
            };
            return labels[status] || status;
        }

        // Get news status badge class
        function getNewsStatusBadgeClass(status) {
            const classes = {
                'published': 'bg-success',
                'draft': 'bg-secondary',
                'pending': 'bg-warning',
                'archived': 'bg-dark'
            };
            return classes[status] || 'bg-secondary';
        }

        // Update filtered news count
        function updateFilteredNewsCount() {
            document.getElementById('filteredNewsCount').textContent = filteredNews.length;
        }

        // Render news pagination
        function renderNewsPagination() {
            const pagination = document.getElementById('newsPagination');
            if (!pagination) return;

            const totalPages = Math.ceil(filteredNews.length / newsPerPage);
            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let paginationHTML = '';
            
            // Previous button
            paginationHTML += `
                <li class="page-item ${currentNewsPage === 1 ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeNewsPage(${currentNewsPage - 1})">Tr∆∞·ªõc</a>
                </li>
            `;

            // Page numbers
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentNewsPage - 2 && i <= currentNewsPage + 2)) {
                    paginationHTML += `
                        <li class="page-item ${i === currentNewsPage ? 'active' : ''}">
                            <a class="page-link" href="#" onclick="changeNewsPage(${i})">${i}</a>
                        </li>
                    `;
                    } else if (i === currentNewsPage - 3 || i === currentNewsPage + 3) {
                        paginationHTML += '<li class="page-item disabled"><span class="page-link">...</span></li>';
                    }
                }

            // Next button
            paginationHTML += `
                <li class="page-item ${currentNewsPage === totalPages ? 'disabled' : ''}">
                    <a class="page-link" href="#" onclick="changeNewsPage(${currentNewsPage + 1})">Sau</a>
                </li>
            `;

            pagination.innerHTML = paginationHTML;
        }

        // Change news page
        function changeNewsPage(page) {
            if (page < 1 || page > Math.ceil(filteredNews.length / newsPerPage)) return;
            currentNewsPage = page;
            renderNewsTable();
        }

        // Apply news filters
        function applyNewsFilters() {
            const searchTerm = document.getElementById('searchNews').value.toLowerCase();
            const statusFilter = document.getElementById('newsStatusFilter').value;
            const categoryFilter = document.getElementById('newsCategoryFilter').value;
            const authorFilter = document.getElementById('newsAuthorFilter').value;

            filteredNews = currentNews.filter(news => {
                const matchesSearch = news.title.toLowerCase().includes(searchTerm) || 
                                    news.content.toLowerCase().includes(searchTerm);
                const matchesStatus = !statusFilter || news.status === statusFilter;
                const matchesCategory = !categoryFilter || news.category === categoryFilter;
                const matchesAuthor = !authorFilter || news.author === authorFilter;

                return matchesSearch && matchesStatus && matchesCategory && matchesAuthor;
            });

            currentNewsPage = 1;
            renderNewsTable();
        }

        // Reset news filters
        function resetNewsFilters() {
            document.getElementById('searchNews').value = '';
            document.getElementById('newsStatusFilter').value = '';
            document.getElementById('newsCategoryFilter').value = '';
            document.getElementById('newsAuthorFilter').value = '';

            filteredNews = [...currentNews];
            currentNewsPage = 1;
            renderNewsTable();
        }

        // Toggle select all news
        function toggleSelectAllNews() {
            const selectAll = document.getElementById('selectAllNews');
            const checkboxes = document.querySelectorAll('.news-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
            });
            
            updateSelectedNewsCount();
        }

        // Update selected news count
        function updateSelectedNewsCount() {
            const selectedCheckboxes = document.querySelectorAll('.news-checkbox:checked');
            document.getElementById('selectedNewsCount').textContent = selectedCheckboxes.length;
        }

        // Open add news modal
        function openAddNewsModal() {
            editingNewsId = null;
            document.getElementById('newsModalLabel').textContent = 'Th√™m tin t·ª©c m·ªõi';
            document.getElementById('newsForm').reset();
            
            const modal = new bootstrap.Modal(document.getElementById('newsModal'));
            modal.show();
        }

        // Edit news
        function editNews(newsId) {
            const news = currentNews.find(n => n.id === newsId);
            if (!news) return;

            editingNewsId = newsId;
            document.getElementById('newsModalLabel').textContent = 'Ch·ªânh s·ª≠a tin t·ª©c';
            
            // Fill form with news data
            document.getElementById('newsTitle').value = news.title;
            document.getElementById('newsCategory').value = news.category;
            document.getElementById('newsStatus').value = news.status;
            document.getElementById('newsAuthor').value = news.author;
            document.getElementById('newsContent').value = news.content;
            document.getElementById('newsContent').value = news.content;
            document.getElementById('newsTags').value = news.tags;
            document.getElementById('newsPublishDate').value = news.publishDate;
            document.getElementById('newsFeatured').checked = news.featured;

            const modal = new bootstrap.Modal(document.getElementById('newsModal'));
            modal.show();
        }

        // Save news
        async function saveNews() {
            const form = document.getElementById('newsForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            const newsData = {
                title: document.getElementById('newsTitle').value,
                category: document.getElementById('newsCategory').value,
                status: document.getElementById('newsStatus').value,
                author: document.getElementById('newsAuthor').value,
                content: document.getElementById('newsContent').value,
                tags: document.getElementById('newsTags').value,
                publishDate: document.getElementById('newsPublishDate').value,
                featured: document.getElementById('newsFeatured').checked,
                views: 0,
                image: 'images/blog/placeholder.jpg'
            };

            try {
                if (editingNewsId) {
                    // Update existing news
                    if (window.firebase && window.firebase.database) {
                        await updateNewsInFirebase(editingNewsId, newsData);
                        showNotification('C·∫≠p nh·∫≠t tin t·ª©c th√†nh c√¥ng!', 'success');
                    } else {
                        // Fallback to local update
                        const index = currentNews.findIndex(n => n.id === editingNewsId);
                        if (index !== -1) {
                            newsData.id = editingNewsId;
                            newsData.image = currentNews[index].image;
                            newsData.views = currentNews[index].views;
                            currentNews[index] = newsData;
                            showNotification('C·∫≠p nh·∫≠t tin t·ª©c th√†nh c√¥ng!', 'success');
                        }
                    }
                } else {
                    // Add new news
                    if (window.firebase && window.firebase.database) {
                        const newNewsId = await saveNewsToFirebase(newsData);
                        newsData.id = newNewsId;
                        currentNews.push(newsData);
                        showNotification('Th√™m tin t·ª©c th√†nh c√¥ng!', 'success');
                    } else {
                        // Fallback to local add
                        newsData.id = 'NEW' + String(currentNews.length + 1).padStart(3, '0');
                        currentNews.push(newsData);
                        showNotification('Th√™m tin t·ª©c th√†nh c√¥ng!', 'success');
                    }
                }

                // Update filtered news and re-render
                filteredNews = [...currentNews];
                renderNewsTable();
                updateNewsStats();

                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('addEditNewsModal'));
                modal.hide();

                // Reset form
                form.reset();
                editingNewsId = null;
                document.getElementById('addEditNewsModalLabel').textContent = 'Th√™m tin t·ª©c m·ªõi';
            } catch (error) {
                console.error('Error saving news:', error);
                showNotification('C√≥ l·ªói x·∫£y ra khi l∆∞u tin t·ª©c!', 'error');
            }
        }

        // View news details
        function viewNewsDetails(newsId) {
            const news = currentNews.find(n => n.id === newsId);
            if (!news) return;

            // Fill modal with news details
            document.getElementById('newsDetailTitle').textContent = news.title;
            document.getElementById('newsDetailCategory').textContent = getNewsCategoryLabel(news.category);
            document.getElementById('newsDetailAuthor').textContent = news.author;
            document.getElementById('newsDetailStatus').textContent = getNewsStatusLabel(news.status);
            document.getElementById('newsDetailPublishDate').textContent = formatDate(news.publishDate);
            document.getElementById('newsDetailViews').textContent = formatNumber(news.views);
            document.getElementById('newsDetailContent').textContent = news.content;
            document.getElementById('newsDetailTags').textContent = news.tags;
            document.getElementById('newsDetailImage').src = news.image;
            document.getElementById('newsDetailFeatured').textContent = news.featured ? 'C√≥' : 'Kh√¥ng';

            // Set badge classes
            const statusBadge = document.getElementById('newsDetailStatus');
            statusBadge.className = `badge fs-6 p-2 mb-2 ${getNewsStatusBadgeClass(news.status)}`;

            const modal = new bootstrap.Modal(document.getElementById('newsDetailsModal'));
            modal.show();
        }

        // Delete news
        function deleteNews(newsId) {
            const news = currentNews.find(n => n.id === newsId);
            if (!news) return;

            document.getElementById('deleteNewsTitle').textContent = news.title;
            editingNewsId = newsId;
            
            const modal = new bootstrap.Modal(document.getElementById('deleteNewsModal'));
            modal.show();
        }

        // Confirm delete news
        async function confirmDeleteNews() {
            if (!editingNewsId) return;

            try {
                if (window.firebase && window.firebase.database) {
                    // Delete from Firebase
                    await deleteNewsFromFirebase(editingNewsId);
                    showNotification('X√≥a tin t·ª©c th√†nh c√¥ng!', 'success');
                } else {
                    // Fallback to local delete
                    const index = currentNews.findIndex(n => n.id === editingNewsId);
                    if (index !== -1) {
                        currentNews.splice(index, 1);
                        showNotification('X√≥a tin t·ª©c th√†nh c√¥ng!', 'success');
                    }
                }

                // Update local arrays and UI
                filteredNews = [...currentNews];
                renderNewsTable();
                updateNewsStats();
            } catch (error) {
                console.error('Error deleting news:', error);
                showNotification('C√≥ l·ªói x·∫£y ra khi x√≥a tin t·ª©c!', 'error');
            }

            // Close modal
            const modal = bootstrap.Modal.getInstance(document.getElementById('deleteNewsModal'));
            modal.hide();
            editingNewsId = null;
        }

        // Export news
        function exportNews() {
            try {
                const exportData = filteredNews.map(news => ({
                    'M√£ tin t·ª©c': news.id,
                    'Ti√™u ƒë·ªÅ': news.title,
                    'Danh m·ª•c': getNewsCategoryLabel(news.category),
                    'T√°c gi·∫£': news.author,
                    'Tr·∫°ng th√°i': getNewsStatusLabel(news.status),
                    'Ng√†y ƒëƒÉng': formatDate(news.publishDate),
                    'L∆∞·ª£t xem': news.views,
                    'Tags': news.tags,
                    'N·ªïi b·∫≠t': news.featured ? 'C√≥' : 'Kh√¥ng',
                    'N·ªôi dung': news.content.substring(0, 200) + '...'
                }));

                const csvContent = convertToCSV(exportData);
                downloadCSV(csvContent, `tin-tuc-${formatDateForFilename(new Date())}.csv`);
                
                showNotification('Xu·∫•t b√°o c√°o tin t·ª©c th√†nh c√¥ng!', 'success');
            } catch (error) {
                console.error('Error exporting news:', error);
                showNotification('L·ªói khi xu·∫•t b√°o c√°o tin t·ª©c', 'error');
            }
        }

        // Open bulk news update modal
        function openBulkNewsUpdateModal() {
            const selectedCheckboxes = document.querySelectorAll('.news-checkbox:checked');
            if (selectedCheckboxes.length === 0) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt tin t·ª©c ƒë·ªÉ c·∫≠p nh·∫≠t', 'warning');
                return;
            }

            document.getElementById('selectedNewsCount').textContent = selectedCheckboxes.length;
            
            const modal = new bootstrap.Modal(document.getElementById('bulkNewsUpdateModal'));
            modal.show();
        }

        // Confirm bulk news update
        function confirmBulkNewsUpdate() {
            const newStatus = document.getElementById('bulkNewsStatus').value;
            const newCategory = document.getElementById('bulkNewsCategory').value;
            const notes = document.getElementById('bulkNewsNotes').value;

            if (!newStatus && !newCategory) {
                showNotification('Vui l√≤ng ch·ªçn √≠t nh·∫•t m·ªôt tr∆∞·ªùng ƒë·ªÉ c·∫≠p nh·∫≠t', 'warning');
                return;
            }

            let updatedCount = 0;
            const selectedCheckboxes = document.querySelectorAll('.news-checkbox:checked');
            
            selectedCheckboxes.forEach(checkbox => {
                const newsId = checkbox.value;
                const news = currentNews.find(n => n.id === newsId);
                if (news) {
                    if (newStatus) news.status = newStatus;
                    if (newCategory) news.category = newCategory;
                    updatedCount++;
                }
                });

            if (updatedCount > 0) {
                filteredNews = [...currentNews];
                renderNewsTable();
                updateNewsStats();
                showNotification(`ƒê√£ c·∫≠p nh·∫≠t ${updatedCount} tin t·ª©c th√†nh c√¥ng!`, 'success');
            }

            const modal = bootstrap.Modal.getInstance(document.getElementById('bulkNewsUpdateModal'));
            modal.hide();
        }

        // ==================== UTILITY FUNCTIONS ====================
        
        // Format date for display
        function formatDate(date) {
            if (!date) return 'N/A';
            const d = new Date(date);
            return d.toLocaleDateString('vi-VN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        // Format date for filename
        function formatDateForFilename(date) {
            const d = new Date(date);
            return d.toISOString().split('T')[0];
        }

        // Convert data to CSV
        function convertToCSV(data) {
            if (data.length === 0) return '';
            
            const headers = Object.keys(data[0]);
            const csvRows = [headers.join(',')];
            
            for (const row of data) {
                const values = headers.map(header => {
                    const value = row[header];
                    return `"${value}"`;
                });
                csvRows.push(values.join(','));
            }
            
            return csvRows.join('\n');
        }

        // Download CSV file
        function downloadCSV(csvContent, filename) {
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        // Show notification
        function showNotification(message, type = 'info') {
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'error' ? 'alert-danger' : 
                              type === 'warning' ? 'alert-warning' : 'alert-info';
            
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass} alert-dismissible fade show position-fixed`;
            notification.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            notification.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }

        // Initialize news management event listeners
        document.addEventListener('DOMContentLoaded', function() {
            // News form save button
            const saveNewsBtn = document.getElementById('saveNewsBtn');
            if (saveNewsBtn) {
                saveNewsBtn.addEventListener('click', saveNews);
            }

            // News delete confirmation button
            const confirmDeleteNewsBtn = document.getElementById('confirmDeleteNewsBtn');
            if (confirmDeleteNewsBtn) {
                confirmDeleteNewsBtn.addEventListener('click', confirmDeleteNews);
            }

            // Bulk news update button
            const confirmBulkNewsUpdateBtn = document.getElementById('confirmBulkNewsUpdateBtn');
            if (confirmBulkNewsUpdateBtn) {
                confirmBulkNewsUpdateBtn.addEventListener('click', confirmBulkNewsUpdate);
            }

            // Edit news from details button
            const editNewsFromDetailsBtn = document.getElementById('editNewsFromDetailsBtn');
            if (editNewsFromDetailsBtn) {
                editNewsFromDetailsBtn.addEventListener('click', function() {
                    const modal = bootstrap.Modal.getInstance(document.getElementById('newsDetailsModal'));
                    modal.hide();
                    editNews(editingNewsId);
                });
            }
        });

        // ==================== FIREBASE FUNCTIONS ====================
        
        // Sign out user
        async function signOutUser() {
            try {
                if (window.firebase && window.firebase.auth) {
                    await window.firebase.auth.signOut();
                    console.log('User signed out successfully');
                    window.location.href = 'auth.html';
                } else {
                    console.error('Firebase auth not available');
                    // Fallback redirect
                    window.location.href = 'auth.html';
                }
            } catch (error) {
                console.error('Error signing out:', error);
                // Fallback redirect
                window.location.href = 'auth.html';
            }
        }

        // Update user display information
        function updateUserDisplay(user) {
            const userDisplayName = document.getElementById('userDisplayName');
            const userProfileImage = document.getElementById('userProfileImage');
            
            if (userDisplayName) {
                // Use admin data if available, fallback to Firebase user data
                if (window.currentAdminUser) {
                    userDisplayName.textContent = window.currentAdminUser.displayName || window.currentAdminUser.profile?.fullName || 'Admin';
                } else {
                    userDisplayName.textContent = user.displayName || user.email || 'Admin';
                }
            }
            
            if (userProfileImage) {
                // Use admin profile image if available, fallback to Firebase user photo
                if (window.currentAdminUser?.photoURL) {
                    userProfileImage.src = window.currentAdminUser.photoURL;
                } else if (user.photoURL) {
                    userProfileImage.src = user.photoURL;
                }
            }
        }

        // Load user data from Firebase
        async function loadUserData(userId) {
            try {
                if (window.firebase && window.firebase.database) {
                    const userRef = window.firebase.database.ref(`users/${userId}`);
                    const snapshot = await window.firebase.database.get(userRef);
                    
                    if (snapshot.exists()) {
                        const userData = snapshot.val();
                        console.log('User data loaded:', userData);
                        
                        // Store admin user data globally
                        if (userData.role === 'admin' || userData.role === 'superAdmin') {
                            window.currentAdminUser = userData;
                        }
                        
                        // Update display with user data
                        const userDisplayName = document.getElementById('userDisplayName');
                        if (userDisplayName) {
                            userDisplayName.textContent = userData.displayName || userData.profile?.fullName || userData.email || 'Admin';
                        }
                        
                        // Update profile image if available
                        if (userData.photoURL) {
                            const userProfileImage = document.getElementById('userProfileImage');
                            if (userProfileImage) {
                                userProfileImage.src = userData.photoURL;
                            }
                        }
                        
                        // Show admin status
                        if (userData.role === 'admin' || userData.role === 'superAdmin') {
                            showAuthStatus(true, userData);
                        }
                    }
                }
            } catch (error) {
                console.error('Error loading user data:', error);
            }
        }

        // Initialize Firebase functionality when DOM is loaded
        document.addEventListener('DOMContentLoaded', function() {
            // Check if Firebase is available
            if (window.firebase && window.firebase.auth) {
                // Listen for auth state changes
                window.firebase.auth.onAuthStateChanged((user) => {
                    if (user) {
                        console.log('User authenticated:', user.email);
                        updateUserDisplay(user);
                        loadUserData(user.uid);
                    } else {
                        console.log('No user authenticated');
                        // Redirect to login if not on auth page
                        if (!window.location.pathname.includes('auth.html')) {
                            window.location.href = 'auth.html';
                        }
                    }
                });
            } else {
                console.warn('Firebase not available, running in demo mode');
            }
        });

        // ==================== FIREBASE DATA OPERATIONS ====================
        
        // Save news to Firebase
        async function saveNewsToFirebase(newsData) {
            try {
                if (window.firebase && window.firebase.database) {
                    const newsRef = window.firebase.database.ref('news');
                    const newNewsRef = await window.firebase.database.push(newsRef, {
                        ...newsData,
                        createdAt: Date.now(),
                        updatedAt: Date.now(),
                        createdBy: window.firebase.auth.currentUser?.uid || 'unknown'
                    });
                    console.log('News saved to Firebase with ID:', newNewsRef.key);
                    return newNewsRef.key;
                }
            } catch (error) {
                console.error('Error saving news to Firebase:', error);
                throw error;
            }
        }

        // Load news from Firebase
        async function loadNewsFromFirebase() {
            try {
                if (window.firebase && window.firebase.database) {
                    const newsRef = window.firebase.database.ref('news');
                    const snapshot = await window.firebase.database.get(newsRef);
                    
                    if (snapshot.exists()) {
                        const newsData = [];
                        snapshot.forEach((childSnapshot) => {
                            newsData.push({
                                id: childSnapshot.key,
                                ...childSnapshot.val()
                            });
                        });
                        console.log('News loaded from Firebase:', newsData.length, 'items');
                        return newsData;
                    } else {
                        console.log('No news data found in Firebase');
                        return [];
                    }
                }
            } catch (error) {
                console.error('Error loading news from Firebase:', error);
                return [];
            }
        }

        // Update news in Firebase
        async function updateNewsInFirebase(newsId, newsData) {
            try {
                if (window.firebase && window.firebase.database) {
                    const newsRef = window.firebase.database.ref(`news/${newsId}`);
                    await window.firebase.database.update(newsRef, {
                        ...newsData,
                        updatedAt: Date.now(),
                        updatedBy: window.firebase.auth.currentUser?.uid || 'unknown'
                    });
                    console.log('News updated in Firebase:', newsId);
                    return true;
                }
            } catch (error) {
                console.error('Error updating news in Firebase:', error);
                throw error;
            }
        }

        // Delete news from Firebase
        async function deleteNewsFromFirebase(newsId) {
            try {
                if (window.firebase && window.firebase.database) {
                    const newsRef = window.firebase.database.ref(`news/${newsId}`);
                    await window.firebase.database.remove(newsRef);
                    console.log('News deleted from Firebase:', newsId);
                    return true;
                }
            } catch (error) {
                console.error('Error deleting news from Firebase:', error);
                throw error;
            }
        }

        // Upload image to Firebase Storage
        async function uploadImageToFirebase(file, path) {
            try {
                if (window.firebase && window.firebase.storage) {
                    const storageRef = window.firebase.storage.ref(window.firebase.storage, path);
                    const snapshot = await window.firebase.storage.uploadBytes(storageRef, file);
                    const downloadURL = await window.firebase.storage.getDownloadURL(snapshot.ref);
                    console.log('Image uploaded to Firebase Storage:', downloadURL);
                    return downloadURL;
                }
            } catch (error) {
                console.error('Error uploading image to Firebase Storage:', error);
                throw error;
            }
        }

        // ==================== SECURITY AND UTILITY FUNCTIONS ====================
        
        // Check if user has admin privileges
        function hasAdminPrivileges() {
            return window.firebase && 
                   window.firebase.auth && 
                   window.firebase.auth.currentUser &&
                   window.currentAdminUser &&
                   (window.currentAdminUser.role === 'admin' || window.currentAdminUser.role === 'superAdmin');
        }

        // Check specific admin permission
        function hasPermission(permission) {
            if (!hasAdminPrivileges()) return false;
            
            if (window.currentAdminUser.role === 'superAdmin') return true;
            
            return window.currentAdminUser.permissions && 
                   window.currentAdminUser.permissions[permission] === true;
        }

        // Get admin role description
        function getAdminRoleDescription() {
            if (!window.currentAdminUser) return 'Unknown';
            
            const role = window.currentAdminUser.role;
            const descriptions = {
                'superAdmin': 'Super Administrator',
                'admin': 'Administrator',
                'moderator': 'Moderator'
            };
            
            return descriptions[role] || role;
        }

        // Show authentication status
        function showAuthStatus(isAuthenticated, user = null) {
            const statusDiv = document.createElement('div');
            statusDiv.className = `auth-status ${isAuthenticated ? 'authenticated' : 'unauthenticated'}`;
            
            if (isAuthenticated && user) {
                statusDiv.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-check-circle status-icon"></i>
                        <div>
                            <div class="status-text">ƒê√£ ƒëƒÉng nh·∫≠p</div>
                            <div class="status-details">${user.email}</div>
                        </div>
                    </div>
                `;
            } else {
                statusDiv.innerHTML = `
                    <div class="d-flex align-items-center">
                        <i class="fas fa-exclamation-triangle status-icon"></i>
                        <div>
                            <div class="status-text">Ch∆∞a ƒëƒÉng nh·∫≠p</div>
                            <div class="status-details">Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ti·∫øp t·ª•c</div>
                        </div>
                    </div>
                `;
            }

            // Remove existing status
            const existingStatus = document.querySelector('.auth-status');
            if (existingStatus) {
                existingStatus.remove();
            }

            // Add new status
            document.body.appendChild(statusDiv);

            // Auto-remove after 3 seconds
            setTimeout(() => {
                if (statusDiv.parentNode) {
                    statusDiv.remove();
                }
            }, 3000);
        }

        // Show loading overlay
        function showLoading(message = 'ƒêang t·∫£i...') {
            const overlay = document.createElement('div');
            overlay.className = 'loading-overlay';
            overlay.innerHTML = `
                <div class="text-center text-white">
                    <div class="loading-spinner mb-3"></div>
                    <div>${message}</div>
                </div>
            `;
            document.body.appendChild(overlay);
        }

        // Hide loading overlay
        function hideLoading() {
            const overlay = document.querySelector('.loading-overlay');
            if (overlay) {
                overlay.remove();
            }
        }

        // Enhanced error handling
        function handleFirebaseError(error, operation = 'operation') {
            console.error(`Firebase error during ${operation}:`, error);
            
            let userMessage = 'C√≥ l·ªói x·∫£y ra';
            
            if (error.code === 'permission-denied') {
                userMessage = 'B·∫°n kh√¥ng c√≥ quy·ªÅn th·ª±c hi·ªán thao t√°c n√†y';
            } else if (error.code === 'unavailable') {
                userMessage = 'D·ªãch v·ª• t·∫°m th·ªùi kh√¥ng kh·∫£ d·ª•ng, vui l√≤ng th·ª≠ l·∫°i sau';
            } else if (error.code === 'unauthenticated') {
                userMessage = 'Phi√™n ƒëƒÉng nh·∫≠p ƒë√£ h·∫øt h·∫°n, vui l√≤ng ƒëƒÉng nh·∫≠p l·∫°i';
                setTimeout(() => {
                    window.location.href = 'auth.html';
                }, 2000);
            }
            
            showNotification(userMessage, 'error');
        }
    </script>

    <!-- ==================== NEWS MANAGEMENT MODALS ==================== -->
    
    <!-- Add/Edit News Modal -->
    <div class="modal fade" id="addEditNewsModal" tabindex="-1" aria-labelledby="addEditNewsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="addEditNewsModalLabel">Th√™m tin t·ª©c m·ªõi</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="newsForm">
                        <div class="row">
                            <div class="col-md-8">
                                <div class="mb-3">
                                    <label for="newsTitle" class="form-label">Ti√™u ƒë·ªÅ tin t·ª©c <span class="text-danger">*</span></label>
                                    <input type="text" class="form-control" id="newsTitle" required>
                                </div>
                                <div class="mb-3">
                                    <label for="newsContent" class="form-label">N·ªôi dung <span class="text-danger">*</span></label>
                                    <textarea class="form-control" id="newsContent" rows="8" required></textarea>
                                </div>
                                <div class="mb-3">
                                    <label for="newsTags" class="form-label">Tags</label>
                                    <input type="text" class="form-control" id="newsTags" placeholder="Nh·∫≠p tags, ph√¢n c√°ch b·∫±ng d·∫•u ph·∫©y">
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="mb-3">
                                    <label for="newsCategory" class="form-label">Danh m·ª•c <span class="text-danger">*</span></label>
                                    <select class="form-select" id="newsCategory" required>
                                        <option value="">Ch·ªçn danh m·ª•c</option>
                                        <option value="tin-tuc">Tin t·ª©c</option>
                                        <option value="su-kien">S·ª± ki·ªán</option>
                                        <option value="goc-nhin">G√≥c nh√¨n</option>
                                        <option value="phong-van">Ph·ªèng v·∫•n</option>
                                        <option value="khac">Kh√°c</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="newsAuthor" class="form-label">T√°c gi·∫£ <span class="text-danger">*</span></label>
                                    <select class="form-select" id="newsAuthor" required>
                                        <option value="">Ch·ªçn t√°c gi·∫£</option>
                                        <option value="admin">Admin</option>
                                        <option value="editor">Bi√™n t·∫≠p vi√™n</option>
                                        <option value="reporter">Ph√≥ng vi√™n</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="newsStatus" class="form-label">Tr·∫°ng th√°i</label>
                                    <select class="form-select" id="newsStatus">
                                        <option value="draft">B·∫£n nh√°p</option>
                                        <option value="pending">Ch·ªù duy·ªát</option>
                                        <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
                                        <option value="archived">ƒê√£ l∆∞u tr·ªØ</option>
                                    </select>
                                </div>
                                <div class="mb-3">
                                    <label for="newsPublishDate" class="form-label">Ng√†y ƒëƒÉng</label>
                                    <input type="datetime-local" class="form-control" id="newsPublishDate">
                                </div>
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="newsFeatured">
                                        <label class="form-check-label" for="newsFeatured">
                                            Tin t·ª©c n·ªïi b·∫≠t
                                        </label>
                                    </div>
                                </div>
                                <div class="mb-3">
                                    <label for="newsImage" class="form-label">H√¨nh ·∫£nh</label>
                                    <input type="file" class="form-control" id="newsImage" accept="image/*">
                                    <div class="form-text">K√≠ch th∆∞·ªõc khuy·∫øn ngh·ªã: 800x600px</div>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="saveNewsBtn">L∆∞u tin t·ª©c</button>
                </div>
            </div>
        </div>
    </div>

    <!-- News Details Modal -->
    <div class="modal fade" id="newsDetailsModal" tabindex="-1" aria-labelledby="newsDetailsModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="newsDetailsModalLabel">Chi ti·∫øt tin t·ª©c</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-8">
                            <div class="mb-3">
                                <h4 id="detailNewsTitle"></h4>
                                <div class="text-muted mb-2">
                                    <small>
                                        <i class="fas fa-user me-1"></i>
                                        <span id="detailNewsAuthor"></span> | 
                                        <i class="fas fa-calendar me-1"></i>
                                        <span id="detailNewsDate"></span> | 
                                        <i class="fas fa-eye me-1"></i>
                                        <span id="detailNewsViews"></span> l∆∞·ª£t xem
                                    </small>
                                </div>
                                <div class="mb-3">
                                    <span class="badge bg-primary me-1" id="detailNewsCategory"></span>
                                    <span class="badge" id="detailNewsStatus"></span>
                                    <span class="badge bg-warning" id="detailNewsFeatured" style="display: none;">N·ªïi b·∫≠t</span>
                                </div>
                                <div id="detailNewsContent"></div>
                                <div class="mt-3" id="detailNewsTags"></div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <img id="detailNewsImage" class="img-fluid rounded" alt="H√¨nh ·∫£nh tin t·ª©c">
                            </div>
                            <div class="card">
                                <div class="card-header">
                                    <h6 class="mb-0">Th√¥ng tin chi ti·∫øt</h6>
                                </div>
                                <div class="card-body">
                                    <p><strong>M√£ tin t·ª©c:</strong> <span id="detailNewsId"></span></p>
                                    <p><strong>Danh m·ª•c:</strong> <span id="detailNewsCategoryText"></span></p>
                                    <p><strong>Tr·∫°ng th√°i:</strong> <span id="detailNewsStatusText"></span></p>
                                    <p><strong>Ng√†y t·∫°o:</strong> <span id="detailNewsCreatedDate"></span></p>
                                    <p><strong>Ng√†y c·∫≠p nh·∫≠t:</strong> <span id="detailNewsUpdatedDate"></span></p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                    <button type="button" class="btn btn-primary" id="editNewsFromDetailsBtn">
                        <i class="fas fa-edit"></i> Ch·ªânh s·ª≠a
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Delete News Confirmation Modal -->
    <div class="modal fade" id="deleteNewsModal" tabindex="-1" aria-labelledby="deleteNewsModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="deleteNewsModalLabel">X√°c nh·∫≠n x√≥a tin t·ª©c</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a tin t·ª©c n√†y kh√¥ng?</p>
                    <p class="text-danger"><strong>H√†nh ƒë·ªông n√†y kh√¥ng th·ªÉ ho√†n t√°c!</strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-danger" id="confirmDeleteNewsBtn">X√≥a tin t·ª©c</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bulk News Update Modal -->
    <div class="modal fade" id="bulkNewsUpdateModal" tabindex="-1" aria-labelledby="bulkNewsUpdateModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="bulkNewsUpdateModalLabel">C·∫≠p nh·∫≠t h√†ng lo·∫°t tin t·ª©c</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>B·∫°n ƒëang c·∫≠p nh·∫≠t <strong id="selectedNewsCount">0</strong> tin t·ª©c ƒë∆∞·ª£c ch·ªçn.</p>
                    
                    <div class="mb-3">
                        <label for="bulkNewsStatus" class="form-label">Tr·∫°ng th√°i m·ªõi</label>
                        <select class="form-select" id="bulkNewsStatus">
                            <option value="">Gi·ªØ nguy√™n</option>
                            <option value="draft">B·∫£n nh√°p</option>
                            <option value="pending">Ch·ªù duy·ªát</option>
                            <option value="published">ƒê√£ xu·∫•t b·∫£n</option>
                            <option value="archived">ƒê√£ l∆∞u tr·ªØ</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="bulkNewsCategory" class="form-label">Danh m·ª•c m·ªõi</label>
                        <select class="form-select" id="bulkNewsCategory">
                            <option value="">Gi·ªØ nguy√™n</option>
                            <option value="tin-tuc">Tin t·ª©c</option>
                            <option value="su-kien">S·ª± ki·ªán</option>
                            <option value="goc-nhin">G√≥c nh√¨n</option>
                            <option value="phong-van">Ph·ªèng v·∫•n</option>
                            <option value="khac">Kh√°c</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <label for="bulkNewsNotes" class="form-label">Ghi ch√∫</label>
                        <textarea class="form-control" id="bulkNewsNotes" rows="3" placeholder="Ghi ch√∫ v·ªÅ vi·ªác c·∫≠p nh·∫≠t h√†ng lo·∫°t..."></textarea>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">H·ªßy</button>
                    <button type="button" class="btn btn-primary" id="confirmBulkNewsUpdateBtn">C·∫≠p nh·∫≠t h√†ng lo·∫°t</button>
                </div>
            </div>
        </div>
    </div>

</body>
</html> 